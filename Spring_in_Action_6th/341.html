<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p341" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_341{left:87px;bottom:960px;letter-spacing:-0.13px;}
#t2_341{left:331px;bottom:961px;}
#t3_341{left:339px;bottom:962px;letter-spacing:-0.14px;}
#t4_341{left:379px;bottom:961px;letter-spacing:0.13px;}
#t5_341{left:406px;bottom:960px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t6_341{left:142px;bottom:917px;letter-spacing:0.12px;word-spacing:0.92px;}
#t7_341{left:142px;bottom:898px;letter-spacing:0.13px;word-spacing:1.77px;}
#t8_341{left:509px;bottom:898px;letter-spacing:0.22px;}
#t9_341{left:632px;bottom:898px;letter-spacing:0.13px;word-spacing:1.74px;}
#ta_341{left:142px;bottom:878px;letter-spacing:0.08px;}
#tb_341{left:178px;bottom:878px;letter-spacing:0.22px;}
#tc_341{left:302px;bottom:878px;letter-spacing:0.12px;word-spacing:1.81px;}
#td_341{left:142px;bottom:858px;letter-spacing:0.11px;word-spacing:1.15px;}
#te_341{left:306px;bottom:858px;letter-spacing:0.22px;}
#tf_341{left:397px;bottom:858px;letter-spacing:0.12px;word-spacing:1.15px;}
#tg_341{left:142px;bottom:838px;letter-spacing:0.11px;word-spacing:0.01px;}
#th_341{left:165px;bottom:818px;letter-spacing:-0.11px;word-spacing:0.1px;}
#ti_341{left:635px;bottom:819px;letter-spacing:-0.03px;}
#tj_341{left:142px;bottom:798px;letter-spacing:0.11px;word-spacing:0.64px;}
#tk_341{left:538px;bottom:799px;letter-spacing:0.22px;}
#tl_341{left:624px;bottom:798px;letter-spacing:0.11px;word-spacing:0.66px;}
#tm_341{left:142px;bottom:778px;letter-spacing:0.11px;word-spacing:1.43px;}
#tn_341{left:275px;bottom:779px;letter-spacing:0.22px;}
#to_341{left:367px;bottom:778px;letter-spacing:0.13px;word-spacing:1.4px;}
#tp_341{left:142px;bottom:759px;letter-spacing:0.12px;word-spacing:2.61px;}
#tq_341{left:341px;bottom:759px;letter-spacing:0.22px;}
#tr_341{left:450px;bottom:759px;letter-spacing:0.12px;word-spacing:2.68px;}
#ts_341{left:142px;bottom:739px;letter-spacing:0.12px;word-spacing:-0.03px;}
#tt_341{left:142px;bottom:709px;}
#tu_341{left:152px;bottom:710px;letter-spacing:-0.23px;}
#tv_341{left:211px;bottom:710px;letter-spacing:-0.23px;}
#tw_341{left:254px;bottom:710px;letter-spacing:-0.25px;}
#tx_341{left:142px;bottom:688px;letter-spacing:0.13px;word-spacing:3.5px;}
#ty_341{left:457px;bottom:688px;letter-spacing:0.22px;}
#tz_341{left:543px;bottom:688px;letter-spacing:0.15px;word-spacing:3.43px;}
#t10_341{left:672px;bottom:688px;letter-spacing:0.21px;}
#t11_341{left:142px;bottom:668px;letter-spacing:0.22px;}
#t12_341{left:224px;bottom:668px;letter-spacing:0.12px;word-spacing:-0.01px;}
#t13_341{left:142px;bottom:634px;letter-spacing:0.13px;}
#t14_341{left:142px;bottom:619px;letter-spacing:0.14px;}
#t15_341{left:157px;bottom:604px;letter-spacing:0.14px;}
#t16_341{left:157px;bottom:589px;letter-spacing:0.14px;}
#t17_341{left:172px;bottom:573px;letter-spacing:0.13px;}
#t18_341{left:157px;bottom:558px;}
#t19_341{left:157px;bottom:543px;letter-spacing:0.13px;word-spacing:0.01px;}
#t1a_341{left:142px;bottom:527px;}
#t1b_341{left:142px;bottom:487px;letter-spacing:0.13px;word-spacing:2.77px;}
#t1c_341{left:335px;bottom:488px;letter-spacing:0.24px;}
#t1d_341{left:365px;bottom:487px;letter-spacing:0.12px;word-spacing:2.81px;}
#t1e_341{left:679px;bottom:488px;letter-spacing:0.22px;}
#t1f_341{left:142px;bottom:468px;letter-spacing:0.11px;word-spacing:2.71px;}
#t1g_341{left:366px;bottom:468px;letter-spacing:0.22px;}
#t1h_341{left:451px;bottom:468px;letter-spacing:0.12px;word-spacing:2.72px;}
#t1i_341{left:529px;bottom:468px;letter-spacing:0.22px;}
#t1j_341{left:592px;bottom:468px;letter-spacing:0.13px;word-spacing:2.72px;}
#t1k_341{left:142px;bottom:448px;letter-spacing:0.13px;word-spacing:1.76px;}
#t1l_341{left:672px;bottom:448px;letter-spacing:0.21px;}
#t1m_341{left:142px;bottom:428px;letter-spacing:0.21px;}
#t1n_341{left:196px;bottom:428px;letter-spacing:0.12px;word-spacing:2.44px;}
#t1o_341{left:264px;bottom:428px;letter-spacing:0.22px;}
#t1p_341{left:349px;bottom:428px;letter-spacing:0.11px;word-spacing:2.44px;}
#t1q_341{left:446px;bottom:428px;letter-spacing:0.22px;}
#t1r_341{left:555px;bottom:428px;letter-spacing:0.13px;word-spacing:2.44px;}
#t1s_341{left:142px;bottom:408px;letter-spacing:0.11px;word-spacing:0.01px;}
#t1t_341{left:299px;bottom:408px;letter-spacing:0.22px;}
#t1u_341{left:381px;bottom:408px;letter-spacing:0.11px;word-spacing:-0.04px;}
#t1v_341{left:142px;bottom:375px;letter-spacing:0.13px;}
#t1w_341{left:142px;bottom:359px;letter-spacing:0.14px;}
#t1x_341{left:157px;bottom:344px;letter-spacing:0.14px;}
#t1y_341{left:142px;bottom:329px;}
#t1z_341{left:142px;bottom:289px;letter-spacing:0.27px;word-spacing:1.02px;}
#t20_341{left:142px;bottom:269px;letter-spacing:0.38px;}
#t21_341{left:230px;bottom:269px;letter-spacing:0.29px;word-spacing:4.15px;}
#t22_341{left:325px;bottom:269px;letter-spacing:0.39px;}
#t23_341{left:357px;bottom:269px;letter-spacing:0.29px;word-spacing:4.18px;}
#t24_341{left:142px;bottom:249px;letter-spacing:0.27px;word-spacing:0.41px;}
#t25_341{left:142px;bottom:229px;letter-spacing:0.26px;}
#t26_341{left:142px;bottom:200px;}
#t27_341{left:155px;bottom:201px;letter-spacing:-0.24px;}
#t28_341{left:201px;bottom:201px;letter-spacing:-0.25px;}
#t29_341{left:233px;bottom:200px;}
#t2a_341{left:243px;bottom:201px;}
#t2b_341{left:250px;bottom:200px;}
#t2c_341{left:256px;bottom:201px;letter-spacing:-0.25px;}
#t2d_341{left:282px;bottom:201px;letter-spacing:-0.24px;}
#t2e_341{left:142px;bottom:178px;letter-spacing:0.12px;word-spacing:1.01px;}
#t2f_341{left:521px;bottom:178px;letter-spacing:0.22px;}
#t2g_341{left:558px;bottom:178px;letter-spacing:0.14px;}
#t2h_341{left:588px;bottom:178px;letter-spacing:0.22px;}
#t2i_341{left:624px;bottom:178px;letter-spacing:0.11px;word-spacing:1.07px;}
#t2j_341{left:142px;bottom:158px;letter-spacing:0.12px;word-spacing:0.78px;}
#t2k_341{left:142px;bottom:138px;letter-spacing:0.1px;word-spacing:3.36px;}
#t2l_341{left:214px;bottom:139px;letter-spacing:0.22px;}
#t2m_341{left:300px;bottom:138px;letter-spacing:0.14px;}
#t2n_341{left:333px;bottom:139px;letter-spacing:0.21px;}
#t2o_341{left:380px;bottom:138px;letter-spacing:0.12px;word-spacing:3.35px;}
#t2p_341{left:142px;bottom:118px;letter-spacing:0.13px;}
#t2q_341{left:204px;bottom:119px;letter-spacing:0.22px;}
#t2r_341{left:319px;bottom:118px;letter-spacing:0.13px;word-spacing:1.9px;}
#t2s_341{left:142px;bottom:99px;letter-spacing:0.11px;word-spacing:-0.01px;}
#t2t_341{left:401px;bottom:99px;letter-spacing:0.22px;}
#t2u_341{left:507px;bottom:99px;letter-spacing:0.11px;word-spacing:0.01px;}

.s1_341{font-size:14px;font-family:NewBaskerville-Bold_h-a;color:#000;}
.s2_341{font-size:12px;font-family:FranklinGothic-Demi_ib4;color:#656565;}
.s3_341{font-size:10px;font-family:FranklinGothic-Demi_ib4;color:#656565;}
.s4_341{font-size:14px;font-family:NewBaskerville-BoldItalic_h-c;color:#656565;}
.s5_341{font-size:15px;font-family:NewBaskerville-Roman_ib3;color:#252525;}
.s6_341{font-size:14px;font-family:Courier_h-e;color:#252525;}
.s7_341{font-size:14px;font-family:FranklinGothic-Demi_ib4;color:#476B85;}
.s8_341{font-size:12px;font-family:FranklinGothic-Demi_ib4;color:#476B85;}
.s9_341{font-size:12px;font-family:Courier_h-e;color:#252525;}
.t.v0_341{transform:scaleX(0.907);}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts341" type="text/css" >

@font-face {
	font-family: Courier_h-e;
	src: url("fonts/Courier_h-e.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_ib4;
	src: url("fonts/FranklinGothic-Demi_ib4.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_h-c;
	src: url("fonts/NewBaskerville-BoldItalic_h-c.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_h-a;
	src: url("fonts/NewBaskerville-Bold_h-a.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_ib3;
	src: url("fonts/NewBaskerville-Roman_ib3.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg341Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg341" style="-webkit-user-select: none;"><object width="811" height="1017" data="341/341.svg" type="image/svg+xml" id="pdf341" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_341" class="t s1_341">314 </span><span id="t2_341" class="t s2_341">C</span><span id="t3_341" class="t s3_341">HAPTER </span><span id="t4_341" class="t s2_341">12 </span><span id="t5_341" class="t s4_341">Developing reactive APIs </span>
<span id="t6_341" class="t s5_341">model for defining a reactive WebFlux controller is no different than for a nonreac- </span>
<span id="t7_341" class="t s5_341">tive Spring MVC controller. Both are annotated with </span><span id="t8_341" class="t v0_341 s6_341">@RestController </span><span id="t9_341" class="t s5_341">and a high- </span>
<span id="ta_341" class="t s5_341">level </span><span id="tb_341" class="t v0_341 s6_341">@RequestMapping </span><span id="tc_341" class="t s5_341">at the class level. And both have request-handling functions </span>
<span id="td_341" class="t s5_341">that are annotated with </span><span id="te_341" class="t v0_341 s6_341">@GetMapping </span><span id="tf_341" class="t s5_341">at the method level. It’s truly a matter of what </span>
<span id="tg_341" class="t s5_341">type the handler methods return. </span>
<span id="th_341" class="t s5_341">Another important observation to make is that although you’re getting a </span><span id="ti_341" class="t v0_341 s6_341">Flux&lt;Taco&gt; </span>
<span id="tj_341" class="t s5_341">back from the repository, you can return it without calling </span><span id="tk_341" class="t v0_341 s6_341">subscribe()</span><span id="tl_341" class="t s5_341">. Indeed, the </span>
<span id="tm_341" class="t s5_341">framework will call </span><span id="tn_341" class="t v0_341 s6_341">subscribe() </span><span id="to_341" class="t s5_341">for you. This means that when a request for /api/ </span>
<span id="tp_341" class="t s5_341">tacos?recent is handled, the </span><span id="tq_341" class="t v0_341 s6_341">recentTacos() </span><span id="tr_341" class="t s5_341">method will be called and will return </span>
<span id="ts_341" class="t s5_341">before the data is even fetched from the database! </span>
<span id="tt_341" class="t s7_341">R</span><span id="tu_341" class="t s8_341">ETURNING </span><span id="tv_341" class="t s8_341">SINGLE </span><span id="tw_341" class="t s8_341">VALUES </span>
<span id="tx_341" class="t s5_341">As another example, consider the following </span><span id="ty_341" class="t v0_341 s6_341">tacoById() </span><span id="tz_341" class="t s5_341">method from the </span><span id="t10_341" class="t v0_341 s6_341">Taco- </span>
<span id="t11_341" class="t v0_341 s6_341">Controller </span><span id="t12_341" class="t s5_341">as it was written in chapter 7: </span>
<span id="t13_341" class="t s9_341">@GetMapping("/{id}") </span>
<span id="t14_341" class="t s9_341">public Taco tacoById(@PathVariable("id") Long id) { </span>
<span id="t15_341" class="t s9_341">Optional&lt;Taco&gt; optTaco = tacoRepo.findById(id); </span>
<span id="t16_341" class="t s9_341">if (optTaco.isPresent()) { </span>
<span id="t17_341" class="t s9_341">return optTaco.get(); </span>
<span id="t18_341" class="t s9_341">} </span>
<span id="t19_341" class="t s9_341">return null; </span>
<span id="t1a_341" class="t s9_341">} </span>
<span id="t1b_341" class="t s5_341">Here, this method handles </span><span id="t1c_341" class="t v0_341 s6_341">GET </span><span id="t1d_341" class="t s5_341">requests for /tacos/{id} and returns a single </span><span id="t1e_341" class="t v0_341 s6_341">Taco </span>
<span id="t1f_341" class="t s5_341">object. Because the repository’s </span><span id="t1g_341" class="t v0_341 s6_341">findById() </span><span id="t1h_341" class="t s5_341">returns an </span><span id="t1i_341" class="t v0_341 s6_341">Optional</span><span id="t1j_341" class="t s5_341">, you also had to </span>
<span id="t1k_341" class="t s5_341">write some clunky code to deal with that. But suppose for a minute that the </span><span id="t1l_341" class="t v0_341 s6_341">find- </span>
<span id="t1m_341" class="t v0_341 s6_341">ById() </span><span id="t1n_341" class="t s5_341">returns a </span><span id="t1o_341" class="t v0_341 s6_341">Mono&lt;Taco&gt; </span><span id="t1p_341" class="t s5_341">instead of an </span><span id="t1q_341" class="t v0_341 s6_341">Optional&lt;Taco&gt;</span><span id="t1r_341" class="t s5_341">. In that case, you can </span>
<span id="t1s_341" class="t s5_341">rewrite the controller’s </span><span id="t1t_341" class="t v0_341 s6_341">tacoById() </span><span id="t1u_341" class="t s5_341">to look like this: </span>
<span id="t1v_341" class="t s9_341">@GetMapping("/{id}") </span>
<span id="t1w_341" class="t s9_341">public Mono&lt;Taco&gt; tacoById(@PathVariable("id") Long id) { </span>
<span id="t1x_341" class="t s9_341">return tacoRepo.findById(id); </span>
<span id="t1y_341" class="t s9_341">} </span>
<span id="t1z_341" class="t s5_341">Wow! That’s a lot simpler. What’s more important, however, is that by returning a </span>
<span id="t20_341" class="t v0_341 s6_341">Mono&lt;Taco&gt; </span><span id="t21_341" class="t s5_341">instead of a </span><span id="t22_341" class="t v0_341 s6_341">Taco</span><span id="t23_341" class="t s5_341">, you’re enabling Spring WebFlux to handle the </span>
<span id="t24_341" class="t s5_341">response in a reactive manner. Consequently, your API will scale better in response </span>
<span id="t25_341" class="t s5_341">to heavy loads. </span>
<span id="t26_341" class="t s7_341">W</span><span id="t27_341" class="t s8_341">ORKING </span><span id="t28_341" class="t s8_341">WITH </span><span id="t29_341" class="t s7_341">R</span><span id="t2a_341" class="t s8_341">X</span><span id="t2b_341" class="t s7_341">J</span><span id="t2c_341" class="t s8_341">AVA </span><span id="t2d_341" class="t s8_341">TYPES </span>
<span id="t2e_341" class="t s5_341">It’s worth pointing out that although Reactor types like </span><span id="t2f_341" class="t v0_341 s6_341">Flux </span><span id="t2g_341" class="t s5_341">and </span><span id="t2h_341" class="t v0_341 s6_341">Mono </span><span id="t2i_341" class="t s5_341">are a natural </span>
<span id="t2j_341" class="t s5_341">choice when working with Spring WebFlux, you can also choose to work with RxJava </span>
<span id="t2k_341" class="t s5_341">types like </span><span id="t2l_341" class="t v0_341 s6_341">Observable </span><span id="t2m_341" class="t s5_341">and </span><span id="t2n_341" class="t v0_341 s6_341">Single</span><span id="t2o_341" class="t s5_341">. For example, suppose there’s a service sitting </span>
<span id="t2p_341" class="t s5_341">between </span><span id="t2q_341" class="t v0_341 s6_341">TacoController </span><span id="t2r_341" class="t s5_341">and the backend repository that deals in terms of RxJava </span>
<span id="t2s_341" class="t s5_341">types. In that case, you might write the </span><span id="t2t_341" class="t v0_341 s6_341">recentTacos() </span><span id="t2u_341" class="t s5_341">method like this: </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
