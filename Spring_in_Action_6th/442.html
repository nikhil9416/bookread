<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p442" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_442{left:703px;bottom:960px;letter-spacing:-0.13px;}
#t2_442{left:342px;bottom:961px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t3_442{left:215px;bottom:921px;letter-spacing:0.14px;}
#t4_442{left:171px;bottom:906px;}
#t5_442{left:156px;bottom:890px;}
#t6_442{left:156px;bottom:853px;letter-spacing:0.12px;word-spacing:0.2px;}
#t7_442{left:156px;bottom:833px;letter-spacing:0.1px;word-spacing:-0.15px;}
#t8_442{left:324px;bottom:834px;letter-spacing:0.22px;}
#t9_442{left:433px;bottom:833px;letter-spacing:0.11px;word-spacing:-0.16px;}
#ta_442{left:156px;bottom:814px;letter-spacing:0.12px;word-spacing:1.27px;}
#tb_442{left:156px;bottom:794px;letter-spacing:0.11px;word-spacing:0.79px;}
#tc_442{left:242px;bottom:794px;letter-spacing:0.22px;}
#td_442{left:279px;bottom:794px;letter-spacing:0.13px;word-spacing:0.8px;}
#te_442{left:156px;bottom:774px;letter-spacing:0.1px;word-spacing:-0.01px;}
#tf_442{left:655px;bottom:774px;letter-spacing:0.22px;}
#tg_442{left:686px;bottom:774px;letter-spacing:0.12px;word-spacing:-0.04px;}
#th_442{left:156px;bottom:754px;letter-spacing:0.1px;word-spacing:-0.01px;}
#ti_442{left:318px;bottom:754px;letter-spacing:0.19px;}
#tj_442{left:334px;bottom:754px;}
#tk_442{left:179px;bottom:734px;letter-spacing:0.11px;word-spacing:1.07px;}
#tl_442{left:156px;bottom:714px;letter-spacing:0.12px;word-spacing:0.99px;}
#tm_442{left:156px;bottom:694px;letter-spacing:0.13px;word-spacing:-0.49px;}
#tn_442{left:156px;bottom:675px;letter-spacing:0.12px;word-spacing:2.04px;}
#to_442{left:156px;bottom:655px;letter-spacing:0.1px;word-spacing:-0.04px;}
#tp_442{left:101px;bottom:620px;letter-spacing:-0.48px;}
#tq_442{left:156px;bottom:620px;letter-spacing:0.01px;word-spacing:0.03px;}
#tr_442{left:156px;bottom:595px;letter-spacing:0.13px;word-spacing:0.41px;}
#ts_442{left:156px;bottom:575px;letter-spacing:0.12px;word-spacing:2.3px;}
#tt_442{left:156px;bottom:555px;letter-spacing:0.13px;word-spacing:1.64px;}
#tu_442{left:156px;bottom:536px;letter-spacing:0.11px;word-spacing:0.02px;}
#tv_442{left:180px;bottom:516px;letter-spacing:-0.03px;word-spacing:1.15px;}
#tw_442{left:597px;bottom:516px;letter-spacing:-0.2px;}
#tx_442{left:156px;bottom:496px;letter-spacing:-0.11px;}
#ty_442{left:181px;bottom:496px;letter-spacing:-0.04px;word-spacing:0.66px;}
#tz_442{left:156px;bottom:476px;letter-spacing:-0.04px;word-spacing:0.41px;}
#t10_442{left:156px;bottom:456px;letter-spacing:-0.03px;word-spacing:-0.02px;}
#t11_442{left:178px;bottom:436px;letter-spacing:0.12px;word-spacing:-0.01px;}
#t12_442{left:156px;bottom:416px;letter-spacing:0.08px;}
#t13_442{left:189px;bottom:417px;letter-spacing:0.21px;}
#t14_442{left:291px;bottom:416px;letter-spacing:0.12px;word-spacing:0.39px;}
#t15_442{left:156px;bottom:397px;letter-spacing:0.09px;word-spacing:0.67px;}
#t16_442{left:252px;bottom:397px;letter-spacing:0.21px;}
#t17_442{left:358px;bottom:397px;letter-spacing:0.12px;word-spacing:0.67px;}
#t18_442{left:156px;bottom:377px;letter-spacing:0.12px;word-spacing:-0.03px;}
#t19_442{left:179px;bottom:357px;letter-spacing:0.12px;word-spacing:0.97px;}
#t1a_442{left:156px;bottom:337px;letter-spacing:0.12px;word-spacing:1.5px;}
#t1b_442{left:156px;bottom:317px;letter-spacing:0.13px;word-spacing:-0.36px;}
#t1c_442{left:156px;bottom:297px;letter-spacing:0.11px;word-spacing:1.71px;}
#t1d_442{left:472px;bottom:297px;letter-spacing:0.22px;}
#t1e_442{left:564px;bottom:297px;letter-spacing:0.12px;word-spacing:1.68px;}
#t1f_442{left:156px;bottom:277px;letter-spacing:0.13px;word-spacing:-0.05px;}
#t1g_442{left:327px;bottom:278px;letter-spacing:0.21px;}
#t1h_442{left:433px;bottom:277px;letter-spacing:0.11px;word-spacing:0.06px;}
#t1i_442{left:156px;bottom:215px;letter-spacing:-0.18px;word-spacing:0.03px;}
#t1j_442{left:156px;bottom:184px;letter-spacing:-0.18px;word-spacing:-0.06px;}
#t1k_442{left:156px;bottom:169px;letter-spacing:-0.18px;word-spacing:-0.06px;}
#t1l_442{left:156px;bottom:153px;letter-spacing:-0.18px;word-spacing:-0.06px;}
#t1m_442{left:156px;bottom:138px;letter-spacing:-0.18px;word-spacing:-0.06px;}
#t1n_442{left:156px;bottom:123px;letter-spacing:-0.18px;word-spacing:-0.06px;}
#t1o_442{left:156px;bottom:108px;letter-spacing:-0.18px;word-spacing:-0.06px;}
#t1p_442{left:174px;bottom:243px;letter-spacing:-0.12px;word-spacing:0.02px;}
#t1q_442{left:262px;bottom:243px;letter-spacing:0.22px;}
#t1r_442{left:361px;bottom:243px;letter-spacing:-0.12px;word-spacing:0.01px;}

.s1_442{font-size:14px;font-family:NewBaskerville-Bold_h-a;color:#000;}
.s2_442{font-size:14px;font-family:NewBaskerville-BoldItalic_h-c;color:#656565;}
.s3_442{font-size:12px;font-family:Courier_h-e;color:#252525;}
.s4_442{font-size:15px;font-family:NewBaskerville-Roman_ib3;color:#252525;}
.s5_442{font-size:14px;font-family:Courier_h-e;color:#252525;}
.s6_442{font-size:16px;font-family:FranklinGothic-DemiItal_ib5;color:#476B85;}
.s7_442{font-size:15px;font-family:NewBaskerville-Roman_ib3;color:#001CA6;}
.s8_442{font-size:14px;font-family:FranklinGothic-Demi_ib4;color:#FFF;}
.s9_442{font-size:14px;font-family:Courier-Bold_h-h;color:#FFF;}
.t.v0_442{transform:scaleX(0.907);}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts442" type="text/css" >

@font-face {
	font-family: Courier-Bold_h-h;
	src: url("fonts/Courier-Bold_h-h.woff") format("woff");
}

@font-face {
	font-family: Courier_h-e;
	src: url("fonts/Courier_h-e.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-DemiItal_ib5;
	src: url("fonts/FranklinGothic-DemiItal_ib5.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_ib4;
	src: url("fonts/FranklinGothic-Demi_ib4.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_h-c;
	src: url("fonts/NewBaskerville-BoldItalic_h-c.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_h-a;
	src: url("fonts/NewBaskerville-Bold_h-a.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_ib3;
	src: url("fonts/NewBaskerville-Roman_ib3.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg442Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg442" style="-webkit-user-select: none;"><object width="811" height="1017" data="442/442.svg" type="image/svg+xml" id="pdf442" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_442" class="t s1_442">415 </span><span id="t2_442" class="t s2_442">Customizing Actuator </span>
<span id="t3_442" class="t s3_442">.build(); </span>
<span id="t4_442" class="t s3_442">} </span>
<span id="t5_442" class="t s3_442">} </span>
<span id="t6_442" class="t s4_442">This crazy health indicator first checks what the current time is, and if it’s after noon, </span>
<span id="t7_442" class="t s4_442">returns a health status of </span><span id="t8_442" class="t v0_442 s5_442">OUT_OF_SERVICE</span><span id="t9_442" class="t s4_442">, with a few details explaining the reason for </span>
<span id="ta_442" class="t s4_442">that status. Even if it’s before lunch, there’s a 10% chance that the health indicator </span>
<span id="tb_442" class="t s4_442">will report a </span><span id="tc_442" class="t v0_442 s5_442">DOWN </span><span id="td_442" class="t s4_442">status, because it uses a random number to decide whether or not </span>
<span id="te_442" class="t s4_442">it’s up. If the random number is less than 0.1, the status will be reported as </span><span id="tf_442" class="t v0_442 s5_442">DOWN</span><span id="tg_442" class="t s4_442">. Oth- </span>
<span id="th_442" class="t s4_442">erwise, the status will be </span><span id="ti_442" class="t v0_442 s5_442">UP</span><span id="tj_442" class="t s4_442">. </span>
<span id="tk_442" class="t s4_442">Obviously, the health indicator in listing 15.5 isn’t going to be very useful in any </span>
<span id="tl_442" class="t s4_442">real-world applications. But imagine that instead of consulting the current time or a </span>
<span id="tm_442" class="t s4_442">random number, it were to make a remote call to some external system and determine </span>
<span id="tn_442" class="t s4_442">the status based on the response it receives. In that case, it would be a very useful </span>
<span id="to_442" class="t s4_442">health indicator. </span>
<span id="tp_442" class="t s6_442">15.3.3 </span><span id="tq_442" class="t s6_442">Registering custom metrics </span>
<span id="tr_442" class="t s4_442">In section 15.2.4, we looked at how you could navigate the /metrics endpoint to con- </span>
<span id="ts_442" class="t s4_442">sume various metrics published by Actuator, with a focus on metrics pertaining to </span>
<span id="tt_442" class="t s4_442">HTTP requests. The metrics provided by Actuator are very useful, but the /metrics </span>
<span id="tu_442" class="t s4_442">endpoint isn’t limited to only those built-in metrics. </span>
<span id="tv_442" class="t s4_442">Ultimately, Actuator metrics are implemented by Micrometer (</span><span id="tw_442" class="t s7_442">https://micrometer </span>
<span id="tx_442" class="t s7_442">.io/</span><span id="ty_442" class="t s4_442">), a vendor-neutral metrics facade that makes it possible for applications to publish </span>
<span id="tz_442" class="t s4_442">any metrics they want and to display them in the third-party monitoring system of their </span>
<span id="t10_442" class="t s4_442">choice, including support for Prometheus, Datadog, and New Relic, among others. </span>
<span id="t11_442" class="t s4_442">The most basic means of publishing metrics with Micrometer is through Microme- </span>
<span id="t12_442" class="t s4_442">ter’s </span><span id="t13_442" class="t v0_442 s5_442">MeterRegistry</span><span id="t14_442" class="t s4_442">. In a Spring Boot application, all you need to do to publish met- </span>
<span id="t15_442" class="t s4_442">rics is inject a </span><span id="t16_442" class="t v0_442 s5_442">MeterRegistry </span><span id="t17_442" class="t s4_442">wherever you may need to publish counters, timers, or </span>
<span id="t18_442" class="t s4_442">gauges that capture the metrics for your application. </span>
<span id="t19_442" class="t s4_442">As an example of publishing custom metrics, suppose you want to keep counters </span>
<span id="t1a_442" class="t s4_442">for the numbers of tacos that have been created with different ingredients. That is, </span>
<span id="t1b_442" class="t s4_442">you want to track how many tacos have been made with lettuce, ground beef, flour tor- </span>
<span id="t1c_442" class="t s4_442">tillas, or any of the available ingredients. The </span><span id="t1d_442" class="t v0_442 s5_442">TacoMetrics </span><span id="t1e_442" class="t s4_442">bean in the next listing </span>
<span id="t1f_442" class="t s4_442">shows how you might use </span><span id="t1g_442" class="t v0_442 s5_442">MeterRegistry </span><span id="t1h_442" class="t s4_442">to gather that information. </span>
<span id="t1i_442" class="t s3_442">package tacos.actuator; </span>
<span id="t1j_442" class="t s3_442">import java.util.List; </span>
<span id="t1k_442" class="t s3_442">import org.springframework.data.rest.core.event.AbstractRepositoryEventListener; </span>
<span id="t1l_442" class="t s3_442">import org.springframework.stereotype.Component; </span>
<span id="t1m_442" class="t s3_442">import io.micrometer.core.instrument.MeterRegistry; </span>
<span id="t1n_442" class="t s3_442">import tacos.Ingredient; </span>
<span id="t1o_442" class="t s3_442">import tacos.Taco; </span>
<span id="t1p_442" class="t s8_442">Listing 15.6 </span><span id="t1q_442" class="t s9_442">TacoMetrics </span><span id="t1r_442" class="t s8_442">registers metrics around taco ingredients </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
