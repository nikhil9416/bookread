<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p386" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_386{left:703px;bottom:960px;letter-spacing:-0.13px;}
#t2_386{left:261px;bottom:961px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t3_386{left:200px;bottom:921px;letter-spacing:0.13px;}
#t4_386{left:229px;bottom:906px;letter-spacing:0.14px;word-spacing:-0.05px;}
#t5_386{left:259px;bottom:890px;letter-spacing:0.13px;}
#t6_386{left:193px;bottom:875px;letter-spacing:0.12px;}
#t7_386{left:229px;bottom:860px;letter-spacing:0.14px;}
#t8_386{left:171px;bottom:844px;}
#t9_386{left:156px;bottom:814px;}
#ta_386{left:156px;bottom:777px;letter-spacing:-0.05px;word-spacing:-0.3px;}
#tb_386{left:156px;bottom:757px;letter-spacing:-0.05px;word-spacing:1.49px;}
#tc_386{left:516px;bottom:757px;letter-spacing:0.05px;}
#td_386{left:598px;bottom:757px;letter-spacing:-0.04px;word-spacing:1.49px;}
#te_386{left:156px;bottom:737px;letter-spacing:-0.03px;word-spacing:-0.3px;}
#tf_386{left:330px;bottom:737px;letter-spacing:0.05px;}
#tg_386{left:426px;bottom:737px;letter-spacing:-0.04px;word-spacing:-0.32px;}
#th_386{left:573px;bottom:737px;letter-spacing:0.05px;}
#ti_386{left:653px;bottom:737px;letter-spacing:-0.05px;word-spacing:-0.25px;}
#tj_386{left:156px;bottom:717px;letter-spacing:-0.03px;word-spacing:0.79px;}
#tk_386{left:534px;bottom:718px;letter-spacing:0.06px;}
#tl_386{left:615px;bottom:717px;letter-spacing:-0.02px;word-spacing:0.8px;}
#tm_386{left:156px;bottom:697px;letter-spacing:-0.05px;word-spacing:0.03px;}
#tn_386{left:266px;bottom:698px;letter-spacing:0.05px;}
#to_386{left:347px;bottom:697px;letter-spacing:-0.05px;word-spacing:-0.03px;}
#tp_386{left:179px;bottom:678px;letter-spacing:0.11px;word-spacing:0.76px;}
#tq_386{left:560px;bottom:678px;letter-spacing:0.22px;}
#tr_386{left:674px;bottom:678px;letter-spacing:0.12px;}
#ts_386{left:156px;bottom:658px;letter-spacing:0.1px;word-spacing:-0.08px;}
#tt_386{left:283px;bottom:658px;letter-spacing:0.22px;}
#tu_386{left:471px;bottom:658px;letter-spacing:0.12px;word-spacing:-0.07px;}
#tv_386{left:156px;bottom:638px;letter-spacing:0.11px;word-spacing:-0.02px;}
#tw_386{left:180px;bottom:618px;letter-spacing:0.11px;word-spacing:1.5px;}
#tx_386{left:425px;bottom:618px;letter-spacing:0.21px;}
#ty_386{left:524px;bottom:618px;letter-spacing:0.1px;word-spacing:1.52px;}
#tz_386{left:646px;bottom:618px;letter-spacing:0.22px;}
#t10_386{left:156px;bottom:598px;letter-spacing:0.11px;word-spacing:0.83px;}
#t11_386{left:260px;bottom:599px;letter-spacing:0.21px;}
#t12_386{left:335px;bottom:598px;letter-spacing:0.12px;word-spacing:0.8px;}
#t13_386{left:506px;bottom:599px;letter-spacing:0.21px;}
#t14_386{left:581px;bottom:598px;letter-spacing:0.12px;word-spacing:0.78px;}
#t15_386{left:678px;bottom:599px;letter-spacing:0.23px;}
#t16_386{left:156px;bottom:579px;letter-spacing:0.13px;}
#t17_386{left:195px;bottom:578px;letter-spacing:0.04px;word-spacing:0.67px;}
#t18_386{left:235px;bottom:579px;letter-spacing:0.22px;}
#t19_386{left:310px;bottom:578px;letter-spacing:0.13px;word-spacing:0.75px;}
#t1a_386{left:156px;bottom:558px;letter-spacing:0.13px;word-spacing:0.23px;}
#t1b_386{left:423px;bottom:559px;letter-spacing:0.21px;}
#t1c_386{left:521px;bottom:558px;letter-spacing:0.19px;}
#t1d_386{left:539px;bottom:559px;letter-spacing:0.22px;}
#t1e_386{left:638px;bottom:558px;letter-spacing:0.12px;word-spacing:0.23px;}
#t1f_386{left:156px;bottom:539px;letter-spacing:0.12px;word-spacing:0.32px;}
#t1g_386{left:329px;bottom:539px;letter-spacing:0.22px;}
#t1h_386{left:411px;bottom:539px;letter-spacing:0.1px;word-spacing:0.33px;}
#t1i_386{left:156px;bottom:519px;letter-spacing:0.12px;word-spacing:-0.01px;}
#t1j_386{left:178px;bottom:499px;letter-spacing:0.11px;}
#t1k_386{left:243px;bottom:499px;letter-spacing:0.22px;}
#t1l_386{left:364px;bottom:499px;letter-spacing:0.11px;word-spacing:-0.04px;}
#t1m_386{left:156px;bottom:436px;letter-spacing:0.14px;word-spacing:-0.09px;}
#t1n_386{left:156px;bottom:406px;letter-spacing:0.13px;}
#t1o_386{left:156px;bottom:390px;letter-spacing:0.13px;word-spacing:0.01px;}
#t1p_386{left:156px;bottom:375px;letter-spacing:0.14px;}
#t1q_386{left:156px;bottom:360px;letter-spacing:0.14px;}
#t1r_386{left:156px;bottom:329px;letter-spacing:0.14px;}
#t1s_386{left:156px;bottom:314px;letter-spacing:0.14px;}
#t1t_386{left:156px;bottom:299px;letter-spacing:0.13px;word-spacing:0.01px;}
#t1u_386{left:156px;bottom:283px;letter-spacing:0.14px;}
#t1v_386{left:156px;bottom:268px;letter-spacing:0.14px;}
#t1w_386{left:156px;bottom:237px;letter-spacing:0.13px;}
#t1x_386{left:156px;bottom:222px;letter-spacing:0.14px;word-spacing:-0.03px;}
#t1y_386{left:171px;bottom:192px;letter-spacing:0.13px;}
#t1z_386{left:171px;bottom:176px;letter-spacing:0.14px;}
#t20_386{left:171px;bottom:146px;letter-spacing:0.13px;}
#t21_386{left:171px;bottom:131px;letter-spacing:0.13px;word-spacing:0.01px;}
#t22_386{left:185px;bottom:115px;letter-spacing:0.13px;}
#t23_386{left:171px;bottom:100px;}
#t24_386{left:174px;bottom:464px;letter-spacing:-0.12px;word-spacing:0.02px;}
#t25_386{left:271px;bottom:464px;letter-spacing:-0.12px;word-spacing:0.01px;}
#t26_386{left:391px;bottom:464px;letter-spacing:0.22px;}

.s1_386{font-size:14px;font-family:NewBaskerville-Bold_h-a;color:#000;}
.s2_386{font-size:14px;font-family:NewBaskerville-BoldItalic_h-c;color:#656565;}
.s3_386{font-size:12px;font-family:Courier_h-e;color:#252525;}
.s4_386{font-size:15px;font-family:NewBaskerville-Roman_ib3;color:#252525;}
.s5_386{font-size:14px;font-family:Courier_h-e;color:#252525;}
.s6_386{font-size:14px;font-family:FranklinGothic-Demi_ib4;color:#FFF;}
.s7_386{font-size:14px;font-family:Courier-Bold_h-h;color:#FFF;}
.t.v0_386{transform:scaleX(0.907);}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts386" type="text/css" >

@font-face {
	font-family: Courier-Bold_h-h;
	src: url("fonts/Courier-Bold_h-h.woff") format("woff");
}

@font-face {
	font-family: Courier_h-e;
	src: url("fonts/Courier_h-e.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_ib4;
	src: url("fonts/FranklinGothic-Demi_ib4.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_h-c;
	src: url("fonts/NewBaskerville-BoldItalic_h-c.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_h-a;
	src: url("fonts/NewBaskerville-Bold_h-a.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_ib3;
	src: url("fonts/NewBaskerville-Roman_ib3.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg386Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg386" style="-webkit-user-select: none;"><object width="811" height="1017" data="386/386.svg" type="image/svg+xml" id="pdf386" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_386" class="t s1_386">359 </span><span id="t2_386" class="t s2_386">Persisting document data reactively with MongoDB </span>
<span id="t3_386" class="t s3_386">StepVerifier.create(ingredientRepo.findById("FLTO")) </span>
<span id="t4_386" class="t s3_386">.assertNext(ingredient -&gt; { </span>
<span id="t5_386" class="t s3_386">ingredient.equals(new Ingredient("FLTO", "Flour Tortilla", </span>
<span id="t6_386" class="t s3_386">Type.WRAP)); </span>
<span id="t7_386" class="t s3_386">}); </span>
<span id="t8_386" class="t s3_386">} </span>
<span id="t9_386" class="t s3_386">} </span>
<span id="ta_386" class="t s4_386">This test is similar to, but still slightly different from, the R2DBC-based repository test we </span>
<span id="tb_386" class="t s4_386">wrote earlier in this chapter. It starts by writing three </span><span id="tc_386" class="t v0_386 s5_386">Ingredient </span><span id="td_386" class="t s4_386">objects to the data- </span>
<span id="te_386" class="t s4_386">base. Then, it employs two </span><span id="tf_386" class="t v0_386 s5_386">StepVerifier </span><span id="tg_386" class="t s4_386">instances to verify that </span><span id="th_386" class="t v0_386 s5_386">Ingredient </span><span id="ti_386" class="t s4_386">objects can </span>
<span id="tj_386" class="t s4_386">be read through the repository, first as a collection of all </span><span id="tk_386" class="t v0_386 s5_386">Ingredient </span><span id="tl_386" class="t s4_386">objects and then </span>
<span id="tm_386" class="t s4_386">fetching a single </span><span id="tn_386" class="t v0_386 s5_386">Ingredient </span><span id="to_386" class="t s4_386">by its ID. </span>
<span id="tp_386" class="t s4_386">Also, just as with the R2DBC-based test from earlier, the </span><span id="tq_386" class="t v0_386 s5_386">@DataMongoTest </span><span id="tr_386" class="t s4_386">annota- </span>
<span id="ts_386" class="t s4_386">tion will seek out a </span><span id="tt_386" class="t v0_386 s5_386">@SpringBootConfiguration</span><span id="tu_386" class="t s4_386">-annotated class for creating the appli- </span>
<span id="tv_386" class="t s4_386">cation context. A test just like the one created earlier will work here, too. </span>
<span id="tw_386" class="t s4_386">What’s unique here is that the first </span><span id="tx_386" class="t v0_386 s5_386">StepVerifier </span><span id="ty_386" class="t s4_386">collects all of the </span><span id="tz_386" class="t v0_386 s5_386">Ingredient </span>
<span id="t10_386" class="t s4_386">objects into an </span><span id="t11_386" class="t v0_386 s5_386">ArrayList </span><span id="t12_386" class="t s4_386">and then asserts that the </span><span id="t13_386" class="t v0_386 s5_386">ArrayList </span><span id="t14_386" class="t s4_386">contains each </span><span id="t15_386" class="t v0_386 s5_386">Ingre- </span>
<span id="t16_386" class="t v0_386 s5_386">dient</span><span id="t17_386" class="t s4_386">. The </span><span id="t18_386" class="t v0_386 s5_386">findAll() </span><span id="t19_386" class="t s4_386">method doesn’t guarantee a consistent ordering of the result- </span>
<span id="t1a_386" class="t s4_386">ing documents, which makes the use of </span><span id="t1b_386" class="t v0_386 s5_386">assertNext() </span><span id="t1c_386" class="t s4_386">or </span><span id="t1d_386" class="t v0_386 s5_386">expectNext() </span><span id="t1e_386" class="t s4_386">prone to fail. </span>
<span id="t1f_386" class="t s4_386">By collecting all resulting </span><span id="t1g_386" class="t v0_386 s5_386">Ingredient </span><span id="t1h_386" class="t s4_386">objects into a list, we can assert that the list has </span>
<span id="t1i_386" class="t s4_386">all three objects, regardless of their order. </span>
<span id="t1j_386" class="t s4_386">A test for </span><span id="t1k_386" class="t v0_386 s5_386">OrderRepository </span><span id="t1l_386" class="t s4_386">looks quite similar, as shown here. </span>
<span id="t1m_386" class="t s3_386">package tacos.data; </span>
<span id="t1n_386" class="t s3_386">import org.junit.jupiter.api.BeforeEach; </span>
<span id="t1o_386" class="t s3_386">import org.junit.jupiter.api.Test; </span>
<span id="t1p_386" class="t s3_386">import org.springframework.beans.factory.annotation.Autowired; </span>
<span id="t1q_386" class="t s3_386">import org.springframework.boot.test.autoconfigure.data.mongo.DataMongoTest; </span>
<span id="t1r_386" class="t s3_386">import reactor.test.StepVerifier; </span>
<span id="t1s_386" class="t s3_386">import tacos.Ingredient; </span>
<span id="t1t_386" class="t s3_386">import tacos.Taco; </span>
<span id="t1u_386" class="t s3_386">import tacos.TacoOrder; </span>
<span id="t1v_386" class="t s3_386">import tacos.Ingredient.Type; </span>
<span id="t1w_386" class="t s3_386">@DataMongoTest </span>
<span id="t1x_386" class="t s3_386">public class OrderRepositoryTest { </span>
<span id="t1y_386" class="t s3_386">@Autowired </span>
<span id="t1z_386" class="t s3_386">OrderRepository orderRepo; </span>
<span id="t20_386" class="t s3_386">@BeforeEach </span>
<span id="t21_386" class="t s3_386">public void setup() { </span>
<span id="t22_386" class="t s3_386">orderRepo.deleteAll().subscribe(); </span>
<span id="t23_386" class="t s3_386">} </span>
<span id="t24_386" class="t s6_386">Listing 13.16 </span><span id="t25_386" class="t s6_386">Testing the Mongo </span><span id="t26_386" class="t s7_386">OrderRepository </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
