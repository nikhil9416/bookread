<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p323" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_323{left:57px;bottom:942px;letter-spacing:0.2px;}
#t2_323{left:326px;bottom:942px;letter-spacing:0.13px;}
#t3_323{left:379px;bottom:942px;letter-spacing:0.2px;}
#t4_323{left:395px;bottom:942px;letter-spacing:0.1px;word-spacing:2.12px;}
#t5_323{left:57px;bottom:893px;letter-spacing:-0.25px;}
#t6_323{left:73px;bottom:893px;}
#t7_323{left:78px;bottom:893px;}
#t8_323{left:86px;bottom:893px;}
#t9_323{left:90px;bottom:893px;}
#ta_323{left:115px;bottom:893px;letter-spacing:-0.16px;}
#tb_323{left:57px;bottom:865px;letter-spacing:0.04px;word-spacing:2.6px;}
#tc_323{left:57px;bottom:847px;letter-spacing:0.08px;word-spacing:2.67px;}
#td_323{left:240px;bottom:847px;letter-spacing:0.02px;word-spacing:2.74px;}
#te_323{left:392px;bottom:848px;letter-spacing:0.05px;}
#tf_323{left:430px;bottom:847px;letter-spacing:0.09px;word-spacing:2.58px;}
#tg_323{left:57px;bottom:829px;word-spacing:1.13px;}
#th_323{left:252px;bottom:830px;letter-spacing:0.05px;}
#ti_323{left:289px;bottom:829px;letter-spacing:0.08px;}
#tj_323{left:307px;bottom:829px;letter-spacing:0.1px;}
#tk_323{left:359px;bottom:829px;letter-spacing:0.03px;word-spacing:0.85px;}
#tl_323{left:57px;bottom:811px;letter-spacing:0.05px;word-spacing:0.48px;}
#tm_323{left:198px;bottom:811px;letter-spacing:0.07px;}
#tn_323{left:235px;bottom:811px;letter-spacing:0.1px;word-spacing:0.34px;}
#to_323{left:57px;bottom:792px;letter-spacing:0.1px;word-spacing:2.3px;}
#tp_323{left:230px;bottom:792px;letter-spacing:0.09px;}
#tq_323{left:250px;bottom:793px;letter-spacing:0.05px;}
#tr_323{left:352px;bottom:792px;letter-spacing:0.11px;word-spacing:2.54px;}
#ts_323{left:57px;bottom:774px;}
#tt_323{left:70px;bottom:775px;letter-spacing:0.05px;}
#tu_323{left:94px;bottom:774px;letter-spacing:0.55px;word-spacing:4.71px;}
#tv_323{left:130px;bottom:775px;letter-spacing:0.05px;}
#tw_323{left:160px;bottom:774px;letter-spacing:0.09px;}
#tx_323{left:195px;bottom:775px;letter-spacing:0.05px;}
#ty_323{left:273px;bottom:774px;letter-spacing:0.07px;word-spacing:1.97px;}
#tz_323{left:57px;bottom:756px;letter-spacing:-0.09px;}
#t10_323{left:127px;bottom:757px;letter-spacing:0.05px;}
#t11_323{left:166px;bottom:756px;letter-spacing:0.09px;}
#t12_323{left:202px;bottom:757px;letter-spacing:0.05px;}
#t13_323{left:280px;bottom:756px;letter-spacing:0.09px;word-spacing:2.72px;}
#t14_323{left:57px;bottom:737px;letter-spacing:0.08px;word-spacing:2.16px;}
#t15_323{left:57px;bottom:719px;letter-spacing:0.06px;}
#t16_323{left:72px;bottom:673px;letter-spacing:-0.25px;word-spacing:0.25px;}
#t17_323{left:72px;bottom:652px;letter-spacing:-0.24px;word-spacing:-0.14px;}
#t18_323{left:80px;bottom:602px;letter-spacing:0.08px;word-spacing:1.39px;}
#t19_323{left:528px;bottom:603px;letter-spacing:0.05px;}
#t1a_323{left:581px;bottom:602px;letter-spacing:0.14px;}
#t1b_323{left:57px;bottom:585px;letter-spacing:0.05px;}
#t1c_323{left:128px;bottom:584px;letter-spacing:0.01px;word-spacing:2.17px;}
#t1d_323{left:57px;bottom:566px;letter-spacing:0.09px;word-spacing:1.4px;}
#t1e_323{left:205px;bottom:567px;letter-spacing:0.05px;}
#t1f_323{left:257px;bottom:566px;letter-spacing:0.08px;word-spacing:0.7px;}
#t1g_323{left:57px;bottom:547px;letter-spacing:0.07px;word-spacing:1.16px;}
#t1h_323{left:308px;bottom:548px;letter-spacing:0.05px;}
#t1i_323{left:384px;bottom:547px;letter-spacing:0.02px;word-spacing:1.13px;}
#t1j_323{left:454px;bottom:547px;letter-spacing:0.07px;}
#t1k_323{left:474px;bottom:547px;letter-spacing:0.07px;word-spacing:0.93px;}
#t1l_323{left:57px;bottom:529px;letter-spacing:0.07px;word-spacing:0.88px;}
#t1m_323{left:57px;bottom:511px;letter-spacing:0.09px;word-spacing:0.14px;}
#t1n_323{left:190px;bottom:512px;letter-spacing:0.05px;}
#t1o_323{left:242px;bottom:511px;letter-spacing:0.04px;}
#t1p_323{left:260px;bottom:512px;letter-spacing:0.05px;}
#t1q_323{left:331px;bottom:511px;letter-spacing:0.08px;word-spacing:0.17px;}
#t1r_323{left:57px;bottom:494px;letter-spacing:0.05px;}
#t1s_323{left:95px;bottom:493px;letter-spacing:0.09px;word-spacing:2.17px;}
#t1t_323{left:57px;bottom:475px;letter-spacing:0.08px;word-spacing:0.67px;}
#t1u_323{left:80px;bottom:456px;letter-spacing:0.09px;word-spacing:1.92px;}
#t1v_323{left:57px;bottom:438px;letter-spacing:0.1px;word-spacing:0.37px;}
#t1w_323{left:307px;bottom:439px;letter-spacing:0.05px;}
#t1x_323{left:359px;bottom:438px;letter-spacing:0.09px;word-spacing:0.7px;}
#t1y_323{left:430px;bottom:439px;letter-spacing:0.05px;}
#t1z_323{left:506px;bottom:438px;letter-spacing:0.12px;word-spacing:0.47px;}
#t20_323{left:57px;bottom:420px;letter-spacing:0.09px;word-spacing:2.08px;}
#t21_323{left:57px;bottom:401px;letter-spacing:0.08px;}
#t22_323{left:80px;bottom:384px;letter-spacing:0.05px;}
#t23_323{left:188px;bottom:383px;letter-spacing:0.07px;word-spacing:0.58px;}
#t24_323{left:432px;bottom:384px;letter-spacing:0.05px;}
#t25_323{left:508px;bottom:383px;letter-spacing:0.1px;word-spacing:0.67px;}
#t26_323{left:57px;bottom:365px;letter-spacing:0.09px;word-spacing:0.41px;}
#t27_323{left:164px;bottom:366px;letter-spacing:0.05px;}
#t28_323{left:216px;bottom:365px;letter-spacing:0.07px;word-spacing:0.75px;}
#t29_323{left:57px;bottom:347px;letter-spacing:0.11px;word-spacing:0.71px;}
#t2a_323{left:534px;bottom:347px;}
#t2b_323{left:549px;bottom:347px;letter-spacing:-0.02px;word-spacing:0.81px;}
#t2c_323{left:57px;bottom:328px;letter-spacing:0.1px;word-spacing:1.46px;}
#t2d_323{left:279px;bottom:328px;}
#t2e_323{left:287px;bottom:327px;}
#t2f_323{left:296px;bottom:328px;letter-spacing:0.09px;word-spacing:1.56px;}
#t2g_323{left:398px;bottom:328px;}
#t2h_323{left:413px;bottom:328px;letter-spacing:0.05px;word-spacing:1.5px;}
#t2i_323{left:57px;bottom:310px;letter-spacing:0.12px;word-spacing:1.69px;}
#t2j_323{left:197px;bottom:310px;}
#t2k_323{left:206px;bottom:309px;}
#t2l_323{left:214px;bottom:310px;letter-spacing:-0.11px;word-spacing:3.84px;}
#t2m_323{left:329px;bottom:310px;}
#t2n_323{left:338px;bottom:309px;}
#t2o_323{left:351px;bottom:310px;letter-spacing:0.12px;word-spacing:1.62px;}
#t2p_323{left:528px;bottom:310px;}
#t2q_323{left:544px;bottom:310px;letter-spacing:0.15px;}
#t2r_323{left:57px;bottom:292px;letter-spacing:0.07px;word-spacing:1.84px;}
#t2s_323{left:116px;bottom:293px;letter-spacing:0.05px;}
#t2t_323{left:163px;bottom:292px;letter-spacing:0.06px;word-spacing:2.41px;}
#t2u_323{left:579px;bottom:292px;}
#t2v_323{left:595px;bottom:292px;letter-spacing:0.05px;}
#t2w_323{left:57px;bottom:274px;letter-spacing:0.06px;word-spacing:0.4px;}
#t2x_323{left:277px;bottom:274px;}
#t2y_323{left:286px;bottom:272px;}
#t2z_323{left:299px;bottom:274px;letter-spacing:0.06px;word-spacing:0.53px;}
#t30_323{left:57px;bottom:255px;letter-spacing:0.07px;}
#t31_323{left:104px;bottom:255px;}
#t32_323{left:113px;bottom:255px;letter-spacing:0.07px;word-spacing:1.01px;}
#t33_323{left:57px;bottom:237px;letter-spacing:0.08px;word-spacing:0.68px;}
#t34_323{left:57px;bottom:219px;letter-spacing:0.07px;word-spacing:0.65px;}

.s0_323{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s1_323{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_323{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s3_323{font-size:17px;font-family:TeXPalladioL-BoldOsF_aml;color:#000;}
.s4_323{font-size:17px;font-family:Palatino-Bold_amf;color:#000;}
.s5_323{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s6_323{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
.s7_323{font-size:15px;font-family:LucidaSans_amq;color:#000;}
.s8_323{font-size:12px;font-family:Palatino-Italic_amd;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts323" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: LucidaSans_amq;
	src: url("fonts/LucidaSans_amq.woff") format("woff");
}

@font-face {
	font-family: Palatino-Bold_amf;
	src: url("fonts/Palatino-Bold_amf.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-BoldOsF_aml;
	src: url("fonts/TeXPalladioL-BoldOsF_aml.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg323Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg323" style="-webkit-user-select: none;"><object width="662" height="1017" data="323/323.svg" type="image/svg+xml" id="pdf323" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_323" class="t s0_323">302 </span><span id="t2_323" class="t s1_323">Chapter </span><span id="t3_323" class="t s2_323">14</span><span id="t4_323" class="t s1_323">. Building Custom Synchronizers </span>
<span id="t5_323" class="t s3_323">14</span><span id="t6_323" class="t s4_323">.</span><span id="t7_323" class="t s3_323">2</span><span id="t8_323" class="t s4_323">.</span><span id="t9_323" class="t s3_323">4 </span><span id="ta_323" class="t s4_323" data-mappings='[[4,"fi"]]'>Notiﬁcation </span>
<span id="tb_323" class="t s5_323">So far, we’ve described half of what goes on in a condition wait: waiting. The </span>
<span id="tc_323" class="t s5_323" data-mappings='[[18,"fi"]]'>other half is notiﬁcation. </span><span id="td_323" class="t s5_323">In a bounded buffer, </span><span id="te_323" class="t s6_323">take </span><span id="tf_323" class="t s5_323">blocks if called when the </span>
<span id="tg_323" class="t s5_323">buffer is empty. In order for </span><span id="th_323" class="t s6_323">take </span><span id="ti_323" class="t s5_323">to </span><span id="tj_323" class="t s1_323">unblock </span><span id="tk_323" class="t s5_323">when the buffer becomes nonempty, </span>
<span id="tl_323" class="t s5_323">we must ensure that </span><span id="tm_323" class="t s1_323">every </span><span id="tn_323" class="t s5_323">code path in which the buffer could become nonempty </span>
<span id="to_323" class="t s5_323" data-mappings='[[15,"fi"]]'>performs a notiﬁcation. </span><span id="tp_323" class="t s5_323">In </span><span id="tq_323" class="t s6_323">BoundedBuffer</span><span id="tr_323" class="t s5_323">, there is only one such place—after </span>
<span id="ts_323" class="t s5_323">a </span><span id="tt_323" class="t s6_323">put</span><span id="tu_323" class="t s5_323">. So </span><span id="tv_323" class="t s6_323">put </span><span id="tw_323" class="t s5_323">calls </span><span id="tx_323" class="t s6_323">notifyAll </span><span id="ty_323" class="t s5_323">after successfully adding an object to the buffer. </span>
<span id="tz_323" class="t s5_323">Similarly, </span><span id="t10_323" class="t s6_323">take </span><span id="t11_323" class="t s5_323">calls </span><span id="t12_323" class="t s6_323">notifyAll </span><span id="t13_323" class="t s5_323">after removing an element to indicate that the </span>
<span id="t14_323" class="t s5_323">buffer may no longer be full, in case any threads are waiting on the “not full” </span>
<span id="t15_323" class="t s5_323">condition. </span>
<span id="t16_323" class="t s7_323">Whenever you wait on a condition, make sure that someone will perform </span>
<span id="t17_323" class="t s7_323" data-mappings='[[6,"fi"]]'>a notiﬁcation whenever the condition predicate becomes true. </span>
<span id="t18_323" class="t s5_323" data-mappings='[[18,"fi"]]'>There are two notiﬁcation methods in the condition queue API—</span><span id="t19_323" class="t s6_323">notify </span><span id="t1a_323" class="t s5_323">and </span>
<span id="t1b_323" class="t s6_323">notifyAll</span><span id="t1c_323" class="t s5_323">. To call either, you must hold the lock associated with the condition </span>
<span id="t1d_323" class="t s5_323">queue object. Calling </span><span id="t1e_323" class="t s6_323">notify </span><span id="t1f_323" class="t s5_323">causes the JVM to select one thread waiting on that </span>
<span id="t1g_323" class="t s5_323">condition queue to wake up; calling </span><span id="t1h_323" class="t s6_323">notifyAll </span><span id="t1i_323" class="t s5_323">wakes up </span><span id="t1j_323" class="t s1_323">all </span><span id="t1k_323" class="t s5_323">the threads waiting </span>
<span id="t1l_323" class="t s5_323">on that condition queue. Because you must hold the lock on the condition queue </span>
<span id="t1m_323" class="t s5_323">object when calling </span><span id="t1n_323" class="t s6_323">notify </span><span id="t1o_323" class="t s5_323">or </span><span id="t1p_323" class="t s6_323">notifyAll</span><span id="t1q_323" class="t s5_323">, and waiting threads cannot return from </span>
<span id="t1r_323" class="t s6_323">wait </span><span id="t1s_323" class="t s5_323">without reacquiring the lock, the notifying thread should release the lock </span>
<span id="t1t_323" class="t s5_323">quickly to ensure that the waiting threads are unblocked as soon as possible. </span>
<span id="t1u_323" class="t s5_323">Because multiple threads could be waiting on the same condition queue for </span>
<span id="t1v_323" class="t s5_323">different condition predicates, using </span><span id="t1w_323" class="t s6_323">notify </span><span id="t1x_323" class="t s5_323">instead of </span><span id="t1y_323" class="t s6_323">notifyAll </span><span id="t1z_323" class="t s5_323">can be danger- </span>
<span id="t20_323" class="t s5_323" data-mappings='[[34,"fi"]]'>ous, primarily because single notiﬁcation is prone to a problem akin to missed </span>
<span id="t21_323" class="t s5_323">signals. </span>
<span id="t22_323" class="t s6_323">BoundedBuffer </span><span id="t23_323" class="t s5_323">provides a good illustration of why </span><span id="t24_323" class="t s6_323">notifyAll </span><span id="t25_323" class="t s5_323">should be pre- </span>
<span id="t26_323" class="t s5_323">ferred to single </span><span id="t27_323" class="t s6_323">notify </span><span id="t28_323" class="t s5_323">in most cases. The condition queue is used for two differ- </span>
<span id="t29_323" class="t s5_323">ent condition predicates: “not full” and “not empty”. Suppose thread </span><span id="t2a_323" class="t s1_323">A </span><span id="t2b_323" class="t s5_323">waits on </span>
<span id="t2c_323" class="t s5_323">a condition queue for predicate </span><span id="t2d_323" class="t s1_323">P </span>
<span id="t2e_323" class="t s8_323">A </span>
<span id="t2f_323" class="t s5_323">, while thread </span><span id="t2g_323" class="t s1_323">B </span><span id="t2h_323" class="t s5_323">waits on the same condition </span>
<span id="t2i_323" class="t s5_323">queue for predicate </span><span id="t2j_323" class="t s1_323">P </span>
<span id="t2k_323" class="t s8_323">B </span>
<span id="t2l_323" class="t s5_323">. Now, suppose </span><span id="t2m_323" class="t s1_323">P </span>
<span id="t2n_323" class="t s8_323">B </span>
<span id="t2o_323" class="t s5_323">becomes true and thread </span><span id="t2p_323" class="t s1_323">C </span><span id="t2q_323" class="t s5_323">performs </span>
<span id="t2r_323" class="t s5_323">a single </span><span id="t2s_323" class="t s6_323">notify</span><span id="t2t_323" class="t s5_323">: the JVM will wake up one thread of its own choosing. If </span><span id="t2u_323" class="t s1_323">A </span><span id="t2v_323" class="t s5_323">is </span>
<span id="t2w_323" class="t s5_323">chosen, it will wake up, see that </span><span id="t2x_323" class="t s1_323">P </span>
<span id="t2y_323" class="t s8_323">A </span>
<span id="t2z_323" class="t s5_323">is not yet true, and go back to waiting. Mean- </span>
<span id="t30_323" class="t s5_323">while, </span><span id="t31_323" class="t s1_323">B</span><span id="t32_323" class="t s5_323">, which could now make progress, does not wake up. This is not exactly </span>
<span id="t33_323" class="t s5_323">a missed signal—it’s more of a “hijacked signal”—but the problem is the same: a </span>
<span id="t34_323" class="t s5_323">thread is waiting for a signal that has (or should have) already occurred. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
