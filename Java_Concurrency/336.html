<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p336" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_336{left:57px;bottom:942px;letter-spacing:0.2px;}
#t2_336{left:72px;bottom:942px;}
#t3_336{left:76px;bottom:942px;}
#t4_336{left:84px;bottom:942px;letter-spacing:0.09px;word-spacing:2.06px;}
#t5_336{left:584px;bottom:942px;letter-spacing:0.2px;}
#t6_336{left:57px;bottom:894px;letter-spacing:0.09px;word-spacing:4.95px;}
#t7_336{left:89px;bottom:876px;letter-spacing:0.09px;word-spacing:4.94px;}
#t8_336{left:89px;bottom:857px;letter-spacing:0.1px;word-spacing:4.7px;}
#t9_336{left:89px;bottom:839px;letter-spacing:0.05px;word-spacing:4.86px;}
#ta_336{left:120px;bottom:821px;letter-spacing:0.1px;word-spacing:4.86px;}
#tb_336{left:152px;bottom:803px;letter-spacing:0.09px;word-spacing:4.88px;}
#tc_336{left:152px;bottom:784px;letter-spacing:0.07px;word-spacing:5.2px;}
#td_336{left:120px;bottom:766px;}
#te_336{left:89px;bottom:748px;letter-spacing:0.07px;word-spacing:4.85px;}
#tf_336{left:120px;bottom:730px;letter-spacing:0.09px;}
#tg_336{left:120px;bottom:711px;letter-spacing:0.09px;word-spacing:4.98px;}
#th_336{left:89px;bottom:693px;}
#ti_336{left:89px;bottom:675px;letter-spacing:0.09px;word-spacing:4.98px;}
#tj_336{left:57px;bottom:657px;}
#tk_336{left:84px;bottom:627px;}
#tl_336{left:94px;bottom:627px;letter-spacing:0.15px;word-spacing:0.24px;}
#tm_336{left:157px;bottom:627px;}
#tn_336{left:160px;bottom:627px;letter-spacing:0.2px;}
#to_336{left:176px;bottom:627px;}
#tp_336{left:185px;bottom:628px;letter-spacing:0.05px;}
#tq_336{left:269px;bottom:627px;letter-spacing:0.09px;word-spacing:0.71px;}
#tr_336{left:472px;bottom:628px;letter-spacing:0.05px;}
#ts_336{left:574px;bottom:627px;}
#tt_336{left:57px;bottom:563px;letter-spacing:0.08px;word-spacing:1.93px;}
#tu_336{left:57px;bottom:544px;letter-spacing:0.07px;word-spacing:0.74px;}
#tv_336{left:80px;bottom:527px;letter-spacing:0.05px;}
#tw_336{left:190px;bottom:526px;letter-spacing:0.09px;word-spacing:2.42px;}
#tx_336{left:57px;bottom:508px;letter-spacing:0.05px;word-spacing:1.28px;}
#ty_336{left:292px;bottom:509px;letter-spacing:0.07px;}
#tz_336{left:433px;bottom:508px;letter-spacing:0.08px;word-spacing:1.22px;}
#t10_336{left:57px;bottom:490px;letter-spacing:0.06px;}
#t11_336{left:175px;bottom:490px;letter-spacing:0.1px;word-spacing:0.8px;}
#t12_336{left:57px;bottom:447px;letter-spacing:-0.25px;}
#t13_336{left:73px;bottom:447px;}
#t14_336{left:78px;bottom:447px;}
#t15_336{left:86px;bottom:447px;}
#t16_336{left:90px;bottom:447px;}
#t17_336{left:115px;bottom:448px;letter-spacing:-0.23px;}
#t18_336{left:199px;bottom:447px;letter-spacing:-0.19px;}
#t19_336{left:232px;bottom:448px;letter-spacing:-0.23px;}
#t1a_336{left:57px;bottom:420px;letter-spacing:0.05px;}
#t1b_336{left:134px;bottom:419px;letter-spacing:0.08px;word-spacing:1.33px;}
#t1c_336{left:57px;bottom:401px;letter-spacing:0.05px;word-spacing:0.76px;}
#t1d_336{left:199px;bottom:402px;letter-spacing:0.06px;}
#t1e_336{left:330px;bottom:401px;letter-spacing:0.08px;word-spacing:0.13px;}
#t1f_336{left:467px;bottom:401px;letter-spacing:0.2px;}
#t1g_336{left:482px;bottom:401px;}
#t1h_336{left:486px;bottom:401px;letter-spacing:0.2px;}
#t1i_336{left:502px;bottom:401px;letter-spacing:0.09px;}
#t1j_336{left:57px;bottom:383px;letter-spacing:0.1px;word-spacing:2.09px;}
#t1k_336{left:57px;bottom:365px;letter-spacing:0.11px;word-spacing:2.63px;}
#t1l_336{left:302px;bottom:365px;letter-spacing:0.11px;word-spacing:2.67px;}
#t1m_336{left:57px;bottom:346px;letter-spacing:0.1px;word-spacing:0.86px;}
#t1n_336{left:412px;bottom:347px;letter-spacing:0.07px;}
#t1o_336{left:554px;bottom:346px;letter-spacing:0.09px;word-spacing:2.01px;}
#t1p_336{left:57px;bottom:328px;letter-spacing:0.1px;word-spacing:1.93px;}
#t1q_336{left:57px;bottom:310px;letter-spacing:0.09px;word-spacing:2.27px;}
#t1r_336{left:457px;bottom:310px;letter-spacing:0.09px;word-spacing:2.24px;}
#t1s_336{left:57px;bottom:292px;letter-spacing:0.1px;word-spacing:1.14px;}
#t1t_336{left:177px;bottom:292px;letter-spacing:0.12px;}
#t1u_336{left:213px;bottom:292px;letter-spacing:0.1px;word-spacing:1.22px;}
#t1v_336{left:57px;bottom:273px;letter-spacing:0.08px;word-spacing:0.69px;}
#t1w_336{left:80px;bottom:255px;letter-spacing:0.11px;}
#t1x_336{left:109px;bottom:256px;letter-spacing:0.05px;}
#t1y_336{left:153px;bottom:255px;letter-spacing:0.11px;word-spacing:0.45px;}
#t1z_336{left:57px;bottom:238px;letter-spacing:0.08px;}
#t20_336{left:189px;bottom:237px;letter-spacing:0.1px;word-spacing:1px;}
#t21_336{left:57px;bottom:218px;letter-spacing:0.06px;word-spacing:3.14px;}
#t22_336{left:230px;bottom:219px;letter-spacing:0.07px;}
#t23_336{left:380px;bottom:218px;letter-spacing:0.07px;word-spacing:3.14px;}
#t24_336{left:57px;bottom:200px;letter-spacing:0.12px;word-spacing:0.41px;}
#t25_336{left:245px;bottom:200px;letter-spacing:0.2px;}
#t26_336{left:261px;bottom:200px;}
#t27_336{left:264px;bottom:200px;}
#t28_336{left:272px;bottom:200px;letter-spacing:0.03px;word-spacing:0.59px;}
#t29_336{left:57px;bottom:182px;letter-spacing:0.06px;word-spacing:0.75px;}
#t2a_336{left:559px;bottom:183px;letter-spacing:0.06px;}
#t2b_336{left:57px;bottom:165px;letter-spacing:0.05px;}
#t2c_336{left:149px;bottom:164px;letter-spacing:0.09px;word-spacing:1.05px;}
#t2d_336{left:57px;bottom:145px;letter-spacing:0.1px;word-spacing:2.81px;}
#t2e_336{left:334px;bottom:145px;letter-spacing:0.08px;word-spacing:2.86px;}
#t2f_336{left:479px;bottom:146px;letter-spacing:0.06px;}
#t2g_336{left:57px;bottom:127px;letter-spacing:0.07px;word-spacing:0.69px;}
#t2h_336{left:80px;bottom:110px;letter-spacing:0.05px;}
#t2i_336{left:195px;bottom:109px;letter-spacing:0.1px;word-spacing:-0.24px;}
#t2j_336{left:414px;bottom:110px;letter-spacing:0.05px;}
#t2k_336{left:485px;bottom:109px;letter-spacing:0.07px;word-spacing:0.97px;}
#t2l_336{left:57px;bottom:91px;letter-spacing:0.09px;word-spacing:2.08px;}
#t2m_336{left:330px;bottom:92px;letter-spacing:0.05px;}
#t2n_336{left:407px;bottom:91px;letter-spacing:0.1px;word-spacing:1.72px;}
#t2o_336{left:500px;bottom:92px;letter-spacing:0.05px;}
#t2p_336{left:555px;bottom:91px;letter-spacing:0.08px;word-spacing:1.98px;}
#t2q_336{left:57px;bottom:72px;letter-spacing:0.09px;word-spacing:0.09px;}

.s0_336{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s1_336{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_336{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s3_336{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
.s4_336{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s5_336{font-size:17px;font-family:TeXPalladioL-BoldOsF_aml;color:#000;}
.s6_336{font-size:17px;font-family:Palatino-Bold_amf;color:#000;}
.s7_336{font-size:15px;font-family:LucidaSansTypewriter-Bd_amr;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts336" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter-Bd_amr;
	src: url("fonts/LucidaSansTypewriter-Bd_amr.woff") format("woff");
}

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: Palatino-Bold_amf;
	src: url("fonts/Palatino-Bold_amf.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-BoldOsF_aml;
	src: url("fonts/TeXPalladioL-BoldOsF_aml.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg336Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg336" style="-webkit-user-select: none;"><object width="662" height="1017" data="336/336.svg" type="image/svg+xml" id="pdf336" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_336" class="t s0_336">14</span><span id="t2_336" class="t s1_336">.</span><span id="t3_336" class="t s0_336">6</span><span id="t4_336" class="t s1_336">. AQS in java.util.concurrent </span><span id="t5_336" class="t s2_336">315 </span>
<span id="t6_336" class="t s3_336">protected boolean tryAcquire(int ignored) { </span>
<span id="t7_336" class="t s3_336">final Thread current = Thread.currentThread(); </span>
<span id="t8_336" class="t s3_336">int c = getState(); </span>
<span id="t9_336" class="t s3_336">if (c == 0) { </span>
<span id="ta_336" class="t s3_336">if (compareAndSetState(0, 1)) { </span>
<span id="tb_336" class="t s3_336">owner = current; </span>
<span id="tc_336" class="t s3_336">return true; </span>
<span id="td_336" class="t s3_336">} </span>
<span id="te_336" class="t s3_336">} else if (current == owner) { </span>
<span id="tf_336" class="t s3_336">setState(c+1); </span>
<span id="tg_336" class="t s3_336">return true; </span>
<span id="th_336" class="t s3_336">} </span>
<span id="ti_336" class="t s3_336">return false; </span>
<span id="tj_336" class="t s3_336">} </span>
<span id="tk_336" class="t s4_336">L</span><span id="tl_336" class="t s2_336">isting 14</span><span id="tm_336" class="t s4_336">.</span><span id="tn_336" class="t s2_336">15</span><span id="to_336" class="t s4_336">. </span><span id="tp_336" class="t s3_336">tryAcquire </span><span id="tq_336" class="t s4_336">implementation from nonfair </span><span id="tr_336" class="t s3_336">ReentrantLock</span><span id="ts_336" class="t s4_336">. </span>
<span id="tt_336" class="t s4_336">owner of the lock, the acquisition count is incremented; if the current thread is </span>
<span id="tu_336" class="t s4_336">not the owner of the lock, the acquisition attempt fails. </span>
<span id="tv_336" class="t s3_336">ReentrantLock </span><span id="tw_336" class="t s4_336">also takes advantage of AQS’s built-in support for multiple </span>
<span id="tx_336" class="t s4_336">condition variables and wait sets. </span><span id="ty_336" class="t s3_336">Lock.newCondition </span><span id="tz_336" class="t s4_336">returns a new instance of </span>
<span id="t10_336" class="t s3_336">ConditionObject</span><span id="t11_336" class="t s4_336">, an inner class of AQS. </span>
<span id="t12_336" class="t s5_336">14</span><span id="t13_336" class="t s6_336">.</span><span id="t14_336" class="t s5_336">6</span><span id="t15_336" class="t s6_336">.</span><span id="t16_336" class="t s5_336">2 </span><span id="t17_336" class="t s7_336">Semaphore </span><span id="t18_336" class="t s6_336">and </span><span id="t19_336" class="t s7_336">CountDownLatch </span>
<span id="t1a_336" class="t s3_336">Semaphore </span><span id="t1b_336" class="t s4_336">uses the AQS synchronization state to hold the count of permits cur- </span>
<span id="t1c_336" class="t s4_336">rently available. The </span><span id="t1d_336" class="t s3_336">tryAcquireShared </span><span id="t1e_336" class="t s4_336">method (see Listing </span><span id="t1f_336" class="t s2_336">14</span><span id="t1g_336" class="t s4_336">.</span><span id="t1h_336" class="t s2_336">16</span><span id="t1i_336" class="t s4_336" data-mappings='[[2,"fi"]]'>) ﬁrst computes </span>
<span id="t1j_336" class="t s4_336">the number of permits remaining, and if there are not enough, returns a value </span>
<span id="t1k_336" class="t s4_336">indicating that the acquire failed. </span><span id="t1l_336" class="t s4_336" data-mappings='[[6,"fi"]]'>If sufﬁcient permits appear to be left, it at- </span>
<span id="t1m_336" class="t s4_336">tempts to atomically reduce the permit count using </span><span id="t1n_336" class="t s3_336">compareAndSetState</span><span id="t1o_336" class="t s4_336">. If that </span>
<span id="t1p_336" class="t s4_336">succeeds (meaning that the permit count had not changed since it last looked), </span>
<span id="t1q_336" class="t s4_336">it returns a value indicating that the acquire succeeded. </span><span id="t1r_336" class="t s4_336">The return value also </span>
<span id="t1s_336" class="t s4_336">encodes whether </span><span id="t1t_336" class="t s1_336">other </span><span id="t1u_336" class="t s4_336">shared acquisition attempts might succeed, in which case </span>
<span id="t1v_336" class="t s4_336">other waiting threads will also be unblocked. </span>
<span id="t1w_336" class="t s4_336">The </span><span id="t1x_336" class="t s3_336">while </span><span id="t1y_336" class="t s4_336">loop terminates either when there are not enough permits or when </span>
<span id="t1z_336" class="t s3_336">tryAcquireShared </span><span id="t20_336" class="t s4_336">can atomically update the permit count to reﬂect acquisition. </span>
<span id="t21_336" class="t s4_336">While any given call to </span><span id="t22_336" class="t s3_336">compareAndSetState </span><span id="t23_336" class="t s4_336">may fail due to contention with </span>
<span id="t24_336" class="t s4_336">another thread (see Section </span><span id="t25_336" class="t s2_336">15</span><span id="t26_336" class="t s4_336">.</span><span id="t27_336" class="t s2_336">3</span><span id="t28_336" class="t s4_336">), causing it to retry, one of these two termination </span>
<span id="t29_336" class="t s4_336">criteria will become true within a reasonable number of retries. Similarly, </span><span id="t2a_336" class="t s3_336">tryRe- </span>
<span id="t2b_336" class="t s3_336">leaseShared </span><span id="t2c_336" class="t s4_336">increases the permit count, potentially unblocking waiting threads, </span>
<span id="t2d_336" class="t s4_336">and retries until the update succeeds. </span><span id="t2e_336" class="t s4_336">The return value of </span><span id="t2f_336" class="t s3_336">tryReleaseShared </span>
<span id="t2g_336" class="t s4_336">indicates whether other threads might have been unblocked by the release. </span>
<span id="t2h_336" class="t s3_336">CountDownLatch </span><span id="t2i_336" class="t s4_336">uses AQS in a similar manner to </span><span id="t2j_336" class="t s3_336">Semaphore</span><span id="t2k_336" class="t s4_336">: the synchroniza- </span>
<span id="t2l_336" class="t s4_336">tion state holds the current count. The </span><span id="t2m_336" class="t s3_336">countDown </span><span id="t2n_336" class="t s4_336">method calls </span><span id="t2o_336" class="t s3_336">release</span><span id="t2p_336" class="t s4_336">, which </span>
<span id="t2q_336" class="t s4_336">causes the counter to be decremented and unblocks waiting threads if the counter </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
