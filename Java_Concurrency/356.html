<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p356" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_356{left:57px;bottom:942px;letter-spacing:0.2px;}
#t2_356{left:72px;bottom:942px;}
#t3_356{left:76px;bottom:942px;}
#t4_356{left:84px;bottom:942px;letter-spacing:0.11px;word-spacing:2.9px;}
#t5_356{left:584px;bottom:942px;letter-spacing:0.2px;}
#t6_356{left:57px;bottom:893px;letter-spacing:0.1px;word-spacing:2.64px;}
#t7_356{left:305px;bottom:893px;}
#t8_356{left:317px;bottom:893px;letter-spacing:0.11px;word-spacing:2.51px;}
#t9_356{left:57px;bottom:875px;letter-spacing:0.08px;word-spacing:2.19px;}
#ta_356{left:530px;bottom:875px;}
#tb_356{left:547px;bottom:875px;letter-spacing:0.08px;word-spacing:2.13px;}
#tc_356{left:57px;bottom:857px;letter-spacing:0.1px;word-spacing:1.59px;}
#td_356{left:57px;bottom:839px;letter-spacing:0.1px;word-spacing:1.17px;}
#te_356{left:510px;bottom:839px;}
#tf_356{left:520px;bottom:839px;word-spacing:2.51px;}
#tg_356{left:57px;bottom:820px;letter-spacing:0.1px;word-spacing:1.06px;}
#th_356{left:57px;bottom:802px;letter-spacing:0.07px;word-spacing:1.39px;}
#ti_356{left:419px;bottom:803px;letter-spacing:0.1px;}
#tj_356{left:496px;bottom:802px;letter-spacing:0.07px;word-spacing:2.24px;}
#tk_356{left:57px;bottom:784px;letter-spacing:0.08px;word-spacing:1.12px;}
#tl_356{left:57px;bottom:766px;letter-spacing:0.08px;word-spacing:0.75px;}
#tm_356{left:57px;bottom:724px;letter-spacing:-0.25px;}
#tn_356{left:73px;bottom:724px;}
#to_356{left:78px;bottom:724px;}
#tp_356{left:86px;bottom:724px;}
#tq_356{left:90px;bottom:724px;}
#tr_356{left:115px;bottom:724px;letter-spacing:-0.17px;word-spacing:0.64px;}
#ts_356{left:57px;bottom:696px;letter-spacing:0.07px;}
#tt_356{left:110px;bottom:696px;letter-spacing:0.2px;}
#tu_356{left:126px;bottom:696px;}
#tv_356{left:129px;bottom:696px;}
#tw_356{left:143px;bottom:696px;letter-spacing:0.07px;word-spacing:2.71px;}
#tx_356{left:378px;bottom:697px;letter-spacing:0.09px;}
#ty_356{left:544px;bottom:696px;letter-spacing:0.08px;word-spacing:3.49px;}
#tz_356{left:57px;bottom:678px;letter-spacing:0.1px;word-spacing:1.87px;}
#t10_356{left:538px;bottom:679px;letter-spacing:0.05px;}
#t11_356{left:575px;bottom:678px;letter-spacing:0.08px;}
#t12_356{left:57px;bottom:660px;letter-spacing:0.12px;word-spacing:1.02px;}
#t13_356{left:199px;bottom:661px;letter-spacing:0.09px;}
#t14_356{left:371px;bottom:660px;letter-spacing:0.09px;word-spacing:1.01px;}
#t15_356{left:57px;bottom:642px;letter-spacing:0.1px;word-spacing:2.51px;}
#t16_356{left:366px;bottom:642px;letter-spacing:0.1px;}
#t17_356{left:581px;bottom:642px;letter-spacing:0.19px;word-spacing:3.94px;}
#t18_356{left:57px;bottom:623px;letter-spacing:0.04px;word-spacing:0.84px;}
#t19_356{left:175px;bottom:623px;letter-spacing:0.2px;}
#t1a_356{left:190px;bottom:623px;}
#t1b_356{left:194px;bottom:623px;}
#t1c_356{left:202px;bottom:623px;}
#t1d_356{left:57px;bottom:588px;letter-spacing:0.08px;word-spacing:5.01px;}
#t1e_356{left:89px;bottom:570px;letter-spacing:0.07px;word-spacing:4.96px;}
#t1f_356{left:89px;bottom:552px;letter-spacing:0.08px;word-spacing:5.02px;}
#t1g_356{left:89px;bottom:515px;letter-spacing:0.1px;word-spacing:4.7px;}
#t1h_356{left:120px;bottom:497px;letter-spacing:0.1px;word-spacing:4.78px;}
#t1i_356{left:89px;bottom:479px;}
#t1j_356{left:57px;bottom:460px;}
#t1k_356{left:57px;bottom:424px;letter-spacing:0.09px;word-spacing:4.96px;}
#t1l_356{left:120px;bottom:406px;letter-spacing:0.11px;word-spacing:4.73px;}
#t1m_356{left:184px;bottom:387px;letter-spacing:0.11px;word-spacing:4.79px;}
#t1n_356{left:94px;bottom:358px;}
#t1o_356{left:103px;bottom:358px;letter-spacing:0.15px;word-spacing:0.24px;}
#t1p_356{left:166px;bottom:358px;}
#t1q_356{left:170px;bottom:358px;}
#t1r_356{left:178px;bottom:358px;letter-spacing:0.1px;word-spacing:0.74px;}
#t1s_356{left:398px;bottom:359px;letter-spacing:0.09px;}
#t1t_356{left:565px;bottom:358px;}
#t1u_356{left:80px;bottom:309px;letter-spacing:0.08px;word-spacing:1.69px;}
#t1v_356{left:396px;bottom:310px;letter-spacing:0.05px;}
#t1w_356{left:451px;bottom:309px;}
#t1x_356{left:462px;bottom:310px;letter-spacing:0.05px;}
#t1y_356{left:494px;bottom:309px;letter-spacing:0.12px;word-spacing:1.89px;}
#t1z_356{left:535px;bottom:310px;letter-spacing:0.05px;}
#t20_356{left:57px;bottom:291px;letter-spacing:0.07px;word-spacing:1.6px;}
#t21_356{left:57px;bottom:272px;letter-spacing:0.08px;word-spacing:2.49px;}
#t22_356{left:373px;bottom:272px;letter-spacing:0.06px;word-spacing:2.51px;}
#t23_356{left:57px;bottom:254px;letter-spacing:0.07px;word-spacing:1.91px;}
#t24_356{left:310px;bottom:255px;letter-spacing:0.05px;}
#t25_356{left:396px;bottom:254px;letter-spacing:0.11px;word-spacing:1.76px;}
#t26_356{left:57px;bottom:236px;letter-spacing:0.1px;word-spacing:0.96px;}
#t27_356{left:57px;bottom:218px;letter-spacing:0.1px;word-spacing:2.47px;}
#t28_356{left:57px;bottom:199px;letter-spacing:0.11px;word-spacing:0.98px;}
#t29_356{left:57px;bottom:181px;letter-spacing:0.09px;word-spacing:-0.08px;}
#t2a_356{left:57px;bottom:163px;letter-spacing:0.1px;word-spacing:1.62px;}
#t2b_356{left:217px;bottom:164px;letter-spacing:0.05px;}
#t2c_356{left:325px;bottom:163px;letter-spacing:0.11px;word-spacing:1.49px;}
#t2d_356{left:57px;bottom:145px;letter-spacing:0.09px;word-spacing:0.67px;}
#t2e_356{left:80px;bottom:126px;letter-spacing:0.1px;}
#t2f_356{left:100px;bottom:127px;letter-spacing:0.08px;}
#t2g_356{left:266px;bottom:126px;letter-spacing:0.11px;word-spacing:2.57px;}
#t2h_356{left:383px;bottom:127px;letter-spacing:0.05px;}
#t2i_356{left:421px;bottom:126px;letter-spacing:0.08px;word-spacing:2.26px;}
#t2j_356{left:490px;bottom:127px;letter-spacing:0.05px;}
#t2k_356{left:528px;bottom:126px;letter-spacing:0.13px;word-spacing:1.88px;}
#t2l_356{left:57px;bottom:108px;letter-spacing:0.07px;word-spacing:1.15px;}
#t2m_356{left:125px;bottom:109px;letter-spacing:0.05px;}
#t2n_356{left:233px;bottom:108px;letter-spacing:0.07px;word-spacing:1.13px;}
#t2o_356{left:308px;bottom:109px;letter-spacing:0.05px;}
#t2p_356{left:395px;bottom:108px;letter-spacing:0.08px;word-spacing:1.6px;}
#t2q_356{left:57px;bottom:90px;letter-spacing:0.1px;word-spacing:1.25px;}
#t2r_356{left:57px;bottom:72px;letter-spacing:0.08px;word-spacing:1.36px;}
#t2s_356{left:511px;bottom:72px;letter-spacing:0.06px;}
#t2t_356{left:57px;bottom:54px;letter-spacing:0.05px;}
#t2u_356{left:93px;bottom:53px;letter-spacing:0.13px;word-spacing:-0.17px;}
#t2v_356{left:150px;bottom:54px;letter-spacing:0.05px;}
#t2w_356{left:186px;bottom:53px;letter-spacing:0.09px;word-spacing:0.01px;}

.s0_356{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s1_356{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_356{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s3_356{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s4_356{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
.s5_356{font-size:17px;font-family:TeXPalladioL-BoldOsF_aml;color:#000;}
.s6_356{font-size:17px;font-family:Palatino-Bold_amf;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts356" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: Palatino-Bold_amf;
	src: url("fonts/Palatino-Bold_amf.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-BoldOsF_aml;
	src: url("fonts/TeXPalladioL-BoldOsF_aml.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg356Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg356" style="-webkit-user-select: none;"><object width="662" height="1017" data="356/356.svg" type="image/svg+xml" id="pdf356" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_356" class="t s0_356">15</span><span id="t2_356" class="t s1_356">.</span><span id="t3_356" class="t s0_356">4</span><span id="t4_356" class="t s1_356">. Nonblocking algorithms </span><span id="t5_356" class="t s2_356">335 </span>
<span id="t6_356" class="t s3_356">taken effect; the second CAS (step </span><span id="t7_356" class="t s1_356">D</span><span id="t8_356" class="t s3_356">) is considered “cleanup”, since it can be </span>
<span id="t9_356" class="t s3_356">performed either by the inserting thread or by any other thread. If </span><span id="ta_356" class="t s1_356">D </span><span id="tb_356" class="t s3_356">fails, the </span>
<span id="tc_356" class="t s3_356">inserting thread returns anyway rather than retrying the CAS, because no retry </span>
<span id="td_356" class="t s3_356" data-mappings='[[37,"fi"]]'>is needed—another thread has already ﬁnished the job in its step </span><span id="te_356" class="t s1_356">B</span><span id="tf_356" class="t s3_356">! This works </span>
<span id="tg_356" class="t s3_356" data-mappings='[[70,"fi"]]'>because before any thread tries to link a new node into the queue, it ﬁrst checks </span>
<span id="th_356" class="t s3_356">to see if the queue needs cleaning up by checking if </span><span id="ti_356" class="t s4_356">tail.next </span><span id="tj_356" class="t s3_356">is non-null. If it </span>
<span id="tk_356" class="t s3_356" data-mappings='[[33,"fi"]]'>is, it advances the tail pointer ﬁrst (perhaps multiple times) until the queue is in </span>
<span id="tl_356" class="t s3_356">the quiescent state. </span>
<span id="tm_356" class="t s5_356">15</span><span id="tn_356" class="t s6_356">.</span><span id="to_356" class="t s5_356">4</span><span id="tp_356" class="t s6_356">.</span><span id="tq_356" class="t s5_356">3 </span><span id="tr_356" class="t s6_356" data-mappings='[[7,"fi"]]'>Atomic ﬁeld updaters </span>
<span id="ts_356" class="t s3_356">Listing </span><span id="tt_356" class="t s2_356">15</span><span id="tu_356" class="t s3_356">.</span><span id="tv_356" class="t s2_356">7 </span><span id="tw_356" class="t s3_356">illustrates the algorithm used by </span><span id="tx_356" class="t s4_356">ConcurrentLinkedQueue</span><span id="ty_356" class="t s3_356">, but the </span>
<span id="tz_356" class="t s3_356">actual implementation is a bit different. Instead of representing each </span><span id="t10_356" class="t s4_356">Node </span><span id="t11_356" class="t s3_356">with </span>
<span id="t12_356" class="t s3_356">an atomic reference, </span><span id="t13_356" class="t s4_356">ConcurrentLinkedQueue </span><span id="t14_356" class="t s3_356">uses an ordinary volatile reference </span>
<span id="t15_356" class="t s3_356">and updates it through the reﬂection-based </span><span id="t16_356" class="t s4_356">AtomicReferenceFieldUpdater</span><span id="t17_356" class="t s3_356">, as </span>
<span id="t18_356" class="t s3_356">shown in Listing </span><span id="t19_356" class="t s2_356">15</span><span id="t1a_356" class="t s3_356">.</span><span id="t1b_356" class="t s2_356">8</span><span id="t1c_356" class="t s3_356">. </span>
<span id="t1d_356" class="t s4_356">private class Node&lt;E&gt; { </span>
<span id="t1e_356" class="t s4_356">private final E item; </span>
<span id="t1f_356" class="t s4_356">private volatile Node&lt;E&gt; next; </span>
<span id="t1g_356" class="t s4_356">public Node(E item) { </span>
<span id="t1h_356" class="t s4_356">this.item = item; </span>
<span id="t1i_356" class="t s4_356">} </span>
<span id="t1j_356" class="t s4_356">} </span>
<span id="t1k_356" class="t s4_356">private static AtomicReferenceFieldUpdater&lt;Node, Node&gt; nextUpdater </span>
<span id="t1l_356" class="t s4_356">= AtomicReferenceFieldUpdater.newUpdater( </span>
<span id="t1m_356" class="t s4_356">Node.class, Node.class, "next"); </span>
<span id="t1n_356" class="t s3_356">L</span><span id="t1o_356" class="t s2_356">isting 15</span><span id="t1p_356" class="t s3_356">.</span><span id="t1q_356" class="t s2_356">8</span><span id="t1r_356" class="t s3_356" data-mappings='[[15,"fi"]]'>. Using atomic ﬁeld updaters in </span><span id="t1s_356" class="t s4_356">ConcurrentLinkedQueue </span><span id="t1t_356" class="t s3_356">. </span>
<span id="t1u_356" class="t s3_356" data-mappings='[[11,"fi"]]'>The atomic ﬁeld updater classes (available in </span><span id="t1v_356" class="t s4_356">Integer</span><span id="t1w_356" class="t s3_356">, </span><span id="t1x_356" class="t s4_356">Long</span><span id="t1y_356" class="t s3_356">, and </span><span id="t1z_356" class="t s4_356">Reference </span>
<span id="t20_356" class="t s3_356" data-mappings='[[69,"fi"]]'>versions) represent a reﬂection-based “view” of an existing volatile ﬁeld so that </span>
<span id="t21_356" class="t s3_356" data-mappings='[[37,"fi"]]'>CAS can be used on existing volatile ﬁelds. </span><span id="t22_356" class="t s3_356">The updater classes have no con- </span>
<span id="t23_356" class="t s3_356">structors; to create one, you call the </span><span id="t24_356" class="t s4_356">newUpdater </span><span id="t25_356" class="t s3_356">factory method, specifying the </span>
<span id="t26_356" class="t s3_356" data-mappings='[[10,"fi"],[25,"fi"],[69,"fi"]]'>class and ﬁeld name. The ﬁeld updater classes are not tied to a speciﬁc instance; </span>
<span id="t27_356" class="t s3_356" data-mappings='[[37,"fi"]]'>one can be used to update the target ﬁeld for any instance of the target class. </span>
<span id="t28_356" class="t s3_356">The atomicity guarantees for the updater classes are weaker than for the regular </span>
<span id="t29_356" class="t s3_356" data-mappings='[[64,"fi"]]'>atomic classes because you cannot guarantee that the underlying ﬁelds will not be </span>
<span id="t2a_356" class="t s3_356" data-mappings='[[4,"fi"]]'>modiﬁed directly—the </span><span id="t2b_356" class="t s4_356">compareAndSet </span><span id="t2c_356" class="t s3_356">and arithmetic methods guarantee atom- </span>
<span id="t2d_356" class="t s3_356" data-mappings='[[58,"fi"]]'>icity only with respect to other threads using the atomic ﬁeld updater methods. </span>
<span id="t2e_356" class="t s3_356">In </span><span id="t2f_356" class="t s4_356">ConcurrentLinkedQueue</span><span id="t2g_356" class="t s3_356">, updates to the </span><span id="t2h_356" class="t s4_356">next </span><span id="t2i_356" class="t s3_356" data-mappings='[[0,"fi"]]'>ﬁeld of a </span><span id="t2j_356" class="t s4_356">Node </span><span id="t2k_356" class="t s3_356">are applied </span>
<span id="t2l_356" class="t s3_356">using the </span><span id="t2m_356" class="t s4_356">compareAndSet </span><span id="t2n_356" class="t s3_356">method of </span><span id="t2o_356" class="t s4_356">nextUpdater</span><span id="t2p_356" class="t s3_356">. This somewhat circuitous ap- </span>
<span id="t2q_356" class="t s3_356">proach is used entirely for performance reasons. For frequently allocated, short- </span>
<span id="t2r_356" class="t s3_356">lived objects like queue link nodes, eliminating the creation of an </span><span id="t2s_356" class="t s4_356">AtomicRefer- </span>
<span id="t2t_356" class="t s4_356">ence </span><span id="t2u_356" class="t s3_356">for each </span><span id="t2v_356" class="t s4_356">Node </span><span id="t2w_356" class="t s3_356" data-mappings='[[8,"fi"]]'>is signiﬁcant enough to reduce the cost of insertion operations. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
