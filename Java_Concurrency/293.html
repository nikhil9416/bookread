<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p293" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_293{left:57px;bottom:942px;letter-spacing:0.2px;}
#t2_293{left:340px;bottom:942px;letter-spacing:0.13px;}
#t3_293{left:394px;bottom:942px;letter-spacing:0.2px;}
#t4_293{left:409px;bottom:942px;word-spacing:2.35px;}
#t5_293{left:95px;bottom:893px;letter-spacing:0.13px;word-spacing:0.12px;}
#t6_293{left:148px;bottom:894px;letter-spacing:0.05px;}
#t7_293{left:232px;bottom:893px;letter-spacing:0.1px;word-spacing:0.02px;}
#t8_293{left:95px;bottom:875px;letter-spacing:0.07px;word-spacing:1.08px;}
#t9_293{left:95px;bottom:857px;letter-spacing:0.06px;word-spacing:0.78px;}
#ta_293{left:57px;bottom:827px;letter-spacing:0.08px;}
#tb_293{left:125px;bottom:827px;letter-spacing:0.05px;}
#tc_293{left:204px;bottom:827px;}
#td_293{left:216px;bottom:827px;letter-spacing:0.05px;}
#te_293{left:272px;bottom:827px;letter-spacing:0.1px;}
#tf_293{left:360px;bottom:827px;letter-spacing:0.05px;}
#tg_293{left:432px;bottom:827px;letter-spacing:0.12px;word-spacing:4.3px;}
#th_293{left:582px;bottom:827px;letter-spacing:0.05px;}
#ti_293{left:95px;bottom:808px;letter-spacing:-0.01px;word-spacing:0.83px;}
#tj_293{left:467px;bottom:809px;letter-spacing:0.05px;}
#tk_293{left:551px;bottom:808px;letter-spacing:0.09px;}
#tl_293{left:95px;bottom:790px;letter-spacing:0.1px;word-spacing:0.63px;}
#tm_293{left:357px;bottom:791px;letter-spacing:0.05px;}
#tn_293{left:451px;bottom:790px;}
#to_293{left:57px;bottom:759px;letter-spacing:0.15px;word-spacing:0.06px;}
#tp_293{left:181px;bottom:759px;letter-spacing:0.09px;word-spacing:2.87px;}
#tq_293{left:530px;bottom:759px;letter-spacing:0.2px;}
#tr_293{left:546px;bottom:759px;letter-spacing:0.1px;word-spacing:2.47px;}
#ts_293{left:95px;bottom:741px;letter-spacing:0.08px;word-spacing:0.96px;}
#tt_293{left:95px;bottom:723px;letter-spacing:0.09px;}
#tu_293{left:155px;bottom:723px;letter-spacing:0.09px;word-spacing:2.62px;}
#tv_293{left:504px;bottom:724px;letter-spacing:0.05px;}
#tw_293{left:566px;bottom:723px;letter-spacing:0.08px;}
#tx_293{left:95px;bottom:705px;letter-spacing:0.08px;word-spacing:0.65px;}
#ty_293{left:504px;bottom:706px;letter-spacing:0.05px;}
#tz_293{left:575px;bottom:705px;}
#t10_293{left:57px;bottom:674px;letter-spacing:0.18px;}
#t11_293{left:107px;bottom:675px;letter-spacing:0.05px;}
#t12_293{left:207px;bottom:674px;letter-spacing:0.13px;}
#t13_293{left:257px;bottom:674px;letter-spacing:0.1px;word-spacing:1.21px;}
#t14_293{left:351px;bottom:675px;letter-spacing:0.05px;}
#t15_293{left:451px;bottom:674px;letter-spacing:0.03px;word-spacing:1.22px;}
#t16_293{left:95px;bottom:656px;letter-spacing:0.06px;word-spacing:2.92px;}
#t17_293{left:95px;bottom:638px;letter-spacing:0.07px;word-spacing:2.24px;}
#t18_293{left:95px;bottom:620px;letter-spacing:0.02px;word-spacing:0.83px;}
#t19_293{left:57px;bottom:589px;letter-spacing:0.15px;word-spacing:-0.04px;}
#t1a_293{left:239px;bottom:589px;letter-spacing:0.1px;word-spacing:1.92px;}
#t1b_293{left:95px;bottom:571px;letter-spacing:0.08px;word-spacing:1.52px;}
#t1c_293{left:531px;bottom:571px;letter-spacing:0.2px;}
#t1d_293{left:547px;bottom:571px;}
#t1e_293{left:551px;bottom:571px;}
#t1f_293{left:558px;bottom:571px;}
#t1g_293{left:562px;bottom:571px;}
#t1h_293{left:570px;bottom:571px;letter-spacing:0.09px;word-spacing:1.02px;}
#t1i_293{left:95px;bottom:552px;letter-spacing:0.08px;word-spacing:1.83px;}
#t1j_293{left:95px;bottom:534px;letter-spacing:0.04px;}
#t1k_293{left:57px;bottom:504px;letter-spacing:0.1px;word-spacing:0.53px;}
#t1l_293{left:318px;bottom:504px;letter-spacing:0.09px;word-spacing:1.11px;}
#t1m_293{left:95px;bottom:486px;letter-spacing:0.09px;word-spacing:0.7px;}
#t1n_293{left:490px;bottom:486px;letter-spacing:0.05px;}
#t1o_293{left:527px;bottom:486px;letter-spacing:0.12px;word-spacing:0.24px;}
#t1p_293{left:95px;bottom:467px;letter-spacing:0.04px;word-spacing:0.68px;}
#t1q_293{left:57px;bottom:437px;letter-spacing:0.12px;word-spacing:0.26px;}
#t1r_293{left:196px;bottom:437px;letter-spacing:0.11px;}
#t1s_293{left:226px;bottom:438px;letter-spacing:0.05px;}
#t1t_293{left:278px;bottom:437px;letter-spacing:0.14px;}
#t1u_293{left:308px;bottom:438px;letter-spacing:0.05px;}
#t1v_293{left:384px;bottom:437px;letter-spacing:0.09px;word-spacing:0.49px;}
#t1w_293{left:95px;bottom:419px;letter-spacing:0.02px;word-spacing:0.8px;}
#t1x_293{left:95px;bottom:400px;letter-spacing:0.08px;word-spacing:0.18px;}
#t1y_293{left:95px;bottom:382px;letter-spacing:0.1px;word-spacing:0.86px;}
#t1z_293{left:559px;bottom:383px;letter-spacing:0.06px;}
#t20_293{left:95px;bottom:365px;letter-spacing:0.05px;}
#t21_293{left:155px;bottom:364px;letter-spacing:0.1px;word-spacing:0.19px;}
#t22_293{left:259px;bottom:365px;letter-spacing:0.05px;}
#t23_293{left:311px;bottom:364px;letter-spacing:0.04px;}
#t24_293{left:329px;bottom:365px;letter-spacing:0.05px;}
#t25_293{left:405px;bottom:364px;letter-spacing:0.1px;word-spacing:0.22px;}
#t26_293{left:95px;bottom:345px;letter-spacing:0.07px;word-spacing:0.79px;}
#t27_293{left:344px;bottom:345px;letter-spacing:0.2px;}
#t28_293{left:360px;bottom:345px;letter-spacing:0.11px;}
#t29_293{left:57px;bottom:315px;letter-spacing:0.1px;word-spacing:0.45px;}
#t2a_293{left:219px;bottom:315px;letter-spacing:0.07px;word-spacing:-0.18px;}
#t2b_293{left:465px;bottom:316px;letter-spacing:0.05px;}
#t2c_293{left:557px;bottom:315px;letter-spacing:0.04px;}
#t2d_293{left:574px;bottom:316px;letter-spacing:0.06px;}
#t2e_293{left:95px;bottom:298px;letter-spacing:0.05px;}
#t2f_293{left:197px;bottom:297px;letter-spacing:0.09px;word-spacing:2.2px;}
#t2g_293{left:95px;bottom:279px;letter-spacing:0.11px;word-spacing:0.9px;}
#t2h_293{left:415px;bottom:279px;letter-spacing:0.2px;}
#t2i_293{left:431px;bottom:279px;letter-spacing:0.11px;word-spacing:2.44px;}
#t2j_293{left:500px;bottom:279px;letter-spacing:0.05px;}
#t2k_293{left:592px;bottom:279px;letter-spacing:0.04px;}
#t2l_293{left:95px;bottom:261px;letter-spacing:0.06px;}
#t2m_293{left:220px;bottom:260px;letter-spacing:0.07px;word-spacing:2.32px;}
#t2n_293{left:95px;bottom:242px;letter-spacing:0.06px;word-spacing:0.68px;}
#t2o_293{left:57px;bottom:212px;letter-spacing:0.13px;word-spacing:0.48px;}
#t2p_293{left:131px;bottom:213px;letter-spacing:0.05px;}
#t2q_293{left:167px;bottom:212px;letter-spacing:0.2px;}
#t2r_293{left:198px;bottom:213px;letter-spacing:0.05px;}
#t2s_293{left:269px;bottom:212px;}
#t2t_293{left:281px;bottom:212px;letter-spacing:0.1px;word-spacing:0.94px;}
#t2u_293{left:338px;bottom:213px;letter-spacing:0.05px;}
#t2v_293{left:375px;bottom:212px;letter-spacing:0.09px;word-spacing:0.9px;}
#t2w_293{left:559px;bottom:213px;letter-spacing:0.06px;}
#t2x_293{left:95px;bottom:194px;letter-spacing:0.05px;}
#t2y_293{left:157px;bottom:193px;letter-spacing:0.09px;word-spacing:1.98px;}
#t2z_293{left:440px;bottom:194px;letter-spacing:0.05px;}
#t30_293{left:558px;bottom:193px;letter-spacing:0.1px;}
#t31_293{left:95px;bottom:175px;letter-spacing:0.04px;}
#t32_293{left:113px;bottom:176px;letter-spacing:0.05px;}
#t33_293{left:157px;bottom:175px;letter-spacing:0.05px;word-spacing:0.72px;}
#t34_293{left:95px;bottom:157px;word-spacing:0.92px;}
#t35_293{left:161px;bottom:158px;letter-spacing:0.1px;}
#t36_293{left:388px;bottom:157px;letter-spacing:0.07px;word-spacing:0.72px;}
#t37_293{left:57px;bottom:126px;letter-spacing:0.13px;word-spacing:0.38px;}
#t38_293{left:356px;bottom:126px;letter-spacing:0.1px;}
#t39_293{left:415px;bottom:127px;letter-spacing:0.05px;}
#t3a_293{left:520px;bottom:126px;letter-spacing:0.08px;}
#t3b_293{left:561px;bottom:126px;letter-spacing:0.09px;word-spacing:6.03px;}
#t3c_293{left:95px;bottom:108px;letter-spacing:0.08px;word-spacing:1.76px;}
#t3d_293{left:95px;bottom:90px;letter-spacing:0.08px;word-spacing:2.52px;}
#t3e_293{left:498px;bottom:91px;letter-spacing:0.05px;}
#t3f_293{left:592px;bottom:90px;letter-spacing:0.04px;}
#t3g_293{left:95px;bottom:72px;letter-spacing:0.06px;}
#t3h_293{left:219px;bottom:72px;letter-spacing:0.06px;word-spacing:0.75px;}

.s0_293{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s1_293{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_293{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s3_293{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s4_293{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
.s5_293{font-size:15px;font-family:Palatino-Bold_amf;color:#000;}
.s6_293{font-size:13px;font-family:LucidaSansTypewriter-Bd_amr;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts293" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter-Bd_amr;
	src: url("fonts/LucidaSansTypewriter-Bd_amr.woff") format("woff");
}

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: Palatino-Bold_amf;
	src: url("fonts/Palatino-Bold_amf.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg293Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg293" style="-webkit-user-select: none;"><object width="662" height="1017" data="293/293.svg" type="image/svg+xml" id="pdf293" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_293" class="t s0_293">272 </span><span id="t2_293" class="t s1_293">Chapter </span><span id="t3_293" class="t s2_293">12</span><span id="t4_293" class="t s1_293">. Testing Concurrent Programs </span>
<span id="t5_293" class="t s3_293">such as </span><span id="t6_293" class="t s4_293">@GuardedBy </span><span id="t7_293" class="t s3_293">are standardized, auditing tools could interpret annota- </span>
<span id="t8_293" class="t s3_293">tions rather than having to guess at the relationship between variables and </span>
<span id="t9_293" class="t s3_293">locks, thus improving the quality of analysis. </span>
<span id="ta_293" class="t s5_293">Invoking </span><span id="tb_293" class="t s6_293">Thread.run</span><span id="tc_293" class="t s5_293">. </span><span id="td_293" class="t s4_293">Thread </span><span id="te_293" class="t s3_293">implements </span><span id="tf_293" class="t s4_293">Runnable </span><span id="tg_293" class="t s3_293">and therefore has a </span><span id="th_293" class="t s4_293">run </span>
<span id="ti_293" class="t s3_293">method. However, it is almost always a mistake to call </span><span id="tj_293" class="t s4_293">Thread.run </span><span id="tk_293" class="t s3_293">directly; </span>
<span id="tl_293" class="t s3_293">usually the programmer meant to call </span><span id="tm_293" class="t s4_293">Thread.start</span><span id="tn_293" class="t s3_293">. </span>
<span id="to_293" class="t s5_293">Unreleased lock. </span><span id="tp_293" class="t s3_293">Unlike intrinsic locks, explicit locks (see Chapter </span><span id="tq_293" class="t s0_293">13</span><span id="tr_293" class="t s3_293">) are not </span>
<span id="ts_293" class="t s3_293">automatically released when control exits the scope in which they were ac- </span>
<span id="tt_293" class="t s3_293">quired. </span><span id="tu_293" class="t s3_293">The standard idiom is to release the lock from a </span><span id="tv_293" class="t s4_293">finally </span><span id="tw_293" class="t s3_293">block; </span>
<span id="tx_293" class="t s3_293">otherwise the lock can remain unreleased in the event of an </span><span id="ty_293" class="t s4_293">Exception</span><span id="tz_293" class="t s3_293">. </span>
<span id="t10_293" class="t s5_293">Empty </span><span id="t11_293" class="t s6_293">synchronized </span><span id="t12_293" class="t s5_293">block. </span><span id="t13_293" class="t s3_293">While empty </span><span id="t14_293" class="t s4_293">synchronized </span><span id="t15_293" class="t s3_293">blocks do have seman- </span>
<span id="t16_293" class="t s3_293">tics under the Java Memory Model, they are frequently used incorrectly, </span>
<span id="t17_293" class="t s3_293">and there are usually better solutions to whatever problem the developer </span>
<span id="t18_293" class="t s3_293">was trying to solve. </span>
<span id="t19_293" class="t s5_293">Double-checked locking. </span><span id="t1a_293" class="t s3_293">Double-checked locking is a broken idiom for reduc- </span>
<span id="t1b_293" class="t s3_293">ing synchronization overhead in lazy initialization (see Section </span><span id="t1c_293" class="t s0_293">16</span><span id="t1d_293" class="t s3_293">.</span><span id="t1e_293" class="t s0_293">2</span><span id="t1f_293" class="t s3_293">.</span><span id="t1g_293" class="t s0_293">4</span><span id="t1h_293" class="t s3_293">) that </span>
<span id="t1i_293" class="t s3_293" data-mappings='[[34,"fi"]]'>involves reading a shared mutable ﬁeld without appropriate synchroniza- </span>
<span id="t1j_293" class="t s3_293">tion. </span>
<span id="t1k_293" class="t s5_293">Starting a thread from a constructor. </span><span id="t1l_293" class="t s3_293">Starting a thread from a constructor intro- </span>
<span id="t1m_293" class="t s3_293">duces the risk of subclassing problems, and can allow the </span><span id="t1n_293" class="t s4_293">this </span><span id="t1o_293" class="t s3_293">reference to </span>
<span id="t1p_293" class="t s3_293">escape the constructor. </span>
<span id="t1q_293" class="t s5_293" data-mappings='[[4,"fi"]]'>Notiﬁcation errors. </span><span id="t1r_293" class="t s3_293">The </span><span id="t1s_293" class="t s4_293">notify </span><span id="t1t_293" class="t s3_293">and </span><span id="t1u_293" class="t s4_293">notifyAll </span><span id="t1v_293" class="t s3_293">methods indicate that an object’s </span>
<span id="t1w_293" class="t s3_293">state may have changed in a way that would unblock threads that are wait- </span>
<span id="t1x_293" class="t s3_293">ing on the associated condition queue. These methods should be called only </span>
<span id="t1y_293" class="t s3_293">when the state associated with the condition queue has changed. A </span><span id="t1z_293" class="t s4_293">synch- </span>
<span id="t20_293" class="t s4_293">ronized </span><span id="t21_293" class="t s3_293">block that calls </span><span id="t22_293" class="t s4_293">notify </span><span id="t23_293" class="t s3_293">or </span><span id="t24_293" class="t s4_293">notifyAll </span><span id="t25_293" class="t s3_293">but does not modify any state </span>
<span id="t26_293" class="t s3_293">is likely to be an error. (See Chapter </span><span id="t27_293" class="t s0_293">14</span><span id="t28_293" class="t s3_293">.) </span>
<span id="t29_293" class="t s5_293">Condition wait errors. </span><span id="t2a_293" class="t s3_293">When waiting on a condition queue, </span><span id="t2b_293" class="t s4_293">Object.wait </span><span id="t2c_293" class="t s3_293">or </span><span id="t2d_293" class="t s4_293">Con- </span>
<span id="t2e_293" class="t s4_293">dition.await </span><span id="t2f_293" class="t s3_293">should be called in a loop, with the appropriate lock held, </span>
<span id="t2g_293" class="t s3_293">after testing some state predicate (see Chapter </span><span id="t2h_293" class="t s0_293">14</span><span id="t2i_293" class="t s3_293">). Calling </span><span id="t2j_293" class="t s4_293">Object.wait </span><span id="t2k_293" class="t s3_293">or </span>
<span id="t2l_293" class="t s4_293">Condition.await </span><span id="t2m_293" class="t s3_293">without the lock held, not in a loop, or without testing </span>
<span id="t2n_293" class="t s3_293">some state predicate is almost certainly an error. </span>
<span id="t2o_293" class="t s5_293">Misuse of </span><span id="t2p_293" class="t s6_293">Lock </span><span id="t2q_293" class="t s5_293">and </span><span id="t2r_293" class="t s6_293">Condition</span><span id="t2s_293" class="t s5_293">. </span><span id="t2t_293" class="t s3_293">Using a </span><span id="t2u_293" class="t s4_293">Lock </span><span id="t2v_293" class="t s3_293">as the lock argument for a </span><span id="t2w_293" class="t s4_293">synch- </span>
<span id="t2x_293" class="t s4_293">ronized </span><span id="t2y_293" class="t s3_293">block is likely to be a typo, as is calling </span><span id="t2z_293" class="t s4_293">Condition.wait </span><span id="t30_293" class="t s3_293">instead </span>
<span id="t31_293" class="t s3_293">of </span><span id="t32_293" class="t s4_293">await </span><span id="t33_293" class="t s3_293">(though the latter would likely be caught in testing, since it would </span>
<span id="t34_293" class="t s3_293">throw an </span><span id="t35_293" class="t s4_293">IllegalMonitorStateException </span><span id="t36_293" class="t s3_293" data-mappings='[[4,"fi"]]'>the ﬁrst time it was called). </span>
<span id="t37_293" class="t s5_293">Sleeping or waiting while holding a lock. </span><span id="t38_293" class="t s3_293">Calling </span><span id="t39_293" class="t s4_293">Thread.sleep </span><span id="t3a_293" class="t s3_293">with </span><span id="t3b_293" class="t s3_293">a lock </span>
<span id="t3c_293" class="t s3_293">held can prevent other threads from making progress for a long time and </span>
<span id="t3d_293" class="t s3_293">is therefore a potentially serious liveness hazard. Calling </span><span id="t3e_293" class="t s4_293">Object.wait </span><span id="t3f_293" class="t s3_293">or </span>
<span id="t3g_293" class="t s4_293">Condition.await </span><span id="t3h_293" class="t s3_293">with two locks held poses a similar hazard. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
