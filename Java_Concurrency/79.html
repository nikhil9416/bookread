<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p79" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_79{left:57px;bottom:942px;letter-spacing:0.2px;}
#t2_79{left:412px;bottom:942px;letter-spacing:0.13px;}
#t3_79{left:466px;bottom:942px;}
#t4_79{left:473px;bottom:942px;letter-spacing:0.1px;word-spacing:2.96px;}
#t5_79{left:57px;bottom:893px;}
#t6_79{left:71px;bottom:894px;letter-spacing:0.05px;}
#t7_79{left:126px;bottom:893px;letter-spacing:0.07px;word-spacing:3.3px;}
#t8_79{left:407px;bottom:894px;letter-spacing:0.05px;}
#t9_79{left:469px;bottom:893px;letter-spacing:0.09px;word-spacing:2.74px;}
#ta_79{left:57px;bottom:876px;letter-spacing:0.1px;}
#tb_79{left:133px;bottom:875px;letter-spacing:0.06px;word-spacing:0.73px;}
#tc_79{left:395px;bottom:876px;letter-spacing:0.05px;}
#td_79{left:451px;bottom:875px;letter-spacing:0.08px;word-spacing:0.7px;}
#te_79{left:57px;bottom:857px;letter-spacing:0.08px;word-spacing:2.1px;}
#tf_79{left:363px;bottom:858px;letter-spacing:0.05px;}
#tg_79{left:424px;bottom:857px;letter-spacing:0.09px;word-spacing:1.68px;}
#th_79{left:57px;bottom:840px;letter-spacing:0.1px;}
#ti_79{left:135px;bottom:839px;letter-spacing:0.09px;word-spacing:2.13px;}
#tj_79{left:57px;bottom:820px;letter-spacing:0.07px;}
#tk_79{left:80px;bottom:802px;letter-spacing:0.06px;word-spacing:1.5px;}
#tl_79{left:57px;bottom:784px;letter-spacing:0.05px;word-spacing:1.05px;}
#tm_79{left:57px;bottom:766px;letter-spacing:0.08px;word-spacing:0.15px;}
#tn_79{left:57px;bottom:747px;letter-spacing:0.05px;word-spacing:0.64px;}
#to_79{left:57px;bottom:729px;letter-spacing:0.1px;word-spacing:2.34px;}
#tp_79{left:57px;bottom:711px;letter-spacing:0.1px;word-spacing:3px;}
#tq_79{left:57px;bottom:693px;letter-spacing:0.05px;}
#tr_79{left:80px;bottom:674px;letter-spacing:0.09px;word-spacing:0.25px;}
#ts_79{left:57px;bottom:656px;letter-spacing:0.05px;word-spacing:0.14px;}
#tt_79{left:57px;bottom:638px;letter-spacing:0.08px;word-spacing:0.8px;}
#tu_79{left:57px;bottom:620px;letter-spacing:0.07px;word-spacing:1.63px;}
#tv_79{left:57px;bottom:601px;letter-spacing:0.04px;word-spacing:0.71px;}
#tw_79{left:57px;bottom:583px;letter-spacing:0.06px;word-spacing:0.67px;}
#tx_79{left:57px;bottom:565px;letter-spacing:0.08px;word-spacing:1.12px;}
#ty_79{left:57px;bottom:546px;letter-spacing:0.09px;word-spacing:1.34px;}
#tz_79{left:57px;bottom:528px;letter-spacing:0.12px;word-spacing:0.55px;}
#t10_79{left:80px;bottom:510px;letter-spacing:0.08px;word-spacing:1.01px;}
#t11_79{left:57px;bottom:492px;letter-spacing:0.07px;word-spacing:2.32px;}
#t12_79{left:57px;bottom:473px;letter-spacing:0.09px;word-spacing:2.29px;}
#t13_79{left:283px;bottom:473px;letter-spacing:0.11px;word-spacing:2.14px;}
#t14_79{left:389px;bottom:474px;letter-spacing:0.05px;}
#t15_79{left:507px;bottom:473px;letter-spacing:0.11px;word-spacing:2.31px;}
#t16_79{left:57px;bottom:455px;letter-spacing:0.06px;word-spacing:2.5px;}
#t17_79{left:168px;bottom:456px;letter-spacing:0.05px;}
#t18_79{left:286px;bottom:455px;letter-spacing:0.05px;word-spacing:2.46px;}
#t19_79{left:365px;bottom:456px;letter-spacing:0.05px;}
#t1a_79{left:389px;bottom:455px;letter-spacing:0.11px;word-spacing:2.38px;}
#t1b_79{left:57px;bottom:437px;letter-spacing:0.08px;word-spacing:2.51px;}
#t1c_79{left:57px;bottom:419px;letter-spacing:0.05px;}
#t1d_79{left:159px;bottom:419px;letter-spacing:0.14px;}
#t1e_79{left:190px;bottom:419px;letter-spacing:0.05px;}
#t1f_79{left:285px;bottom:419px;}
#t1g_79{left:300px;bottom:419px;letter-spacing:0.12px;}
#t1h_79{left:331px;bottom:419px;letter-spacing:0.05px;}
#t1i_79{left:449px;bottom:419px;letter-spacing:0.07px;word-spacing:2.34px;}
#t1j_79{left:57px;bottom:400px;letter-spacing:0.11px;word-spacing:1.17px;}
#t1k_79{left:57px;bottom:382px;letter-spacing:0.06px;word-spacing:2.6px;}
#t1l_79{left:208px;bottom:382px;letter-spacing:0.11px;word-spacing:2.45px;}
#t1m_79{left:574px;bottom:383px;letter-spacing:0.05px;}
#t1n_79{left:57px;bottom:365px;letter-spacing:0.05px;}
#t1o_79{left:134px;bottom:364px;letter-spacing:0.14px;}
#t1p_79{left:166px;bottom:365px;letter-spacing:0.05px;}
#t1q_79{left:261px;bottom:364px;letter-spacing:0.03px;word-spacing:2.32px;}
#t1r_79{left:57px;bottom:345px;letter-spacing:0.07px;}
#t1s_79{left:97px;bottom:345px;letter-spacing:0.08px;word-spacing:1.6px;}
#t1t_79{left:267px;bottom:346px;letter-spacing:0.05px;}
#t1u_79{left:377px;bottom:345px;letter-spacing:0.05px;word-spacing:2.24px;}
#t1v_79{left:57px;bottom:327px;letter-spacing:0.09px;word-spacing:0.88px;}
#t1w_79{left:57px;bottom:309px;letter-spacing:0.1px;word-spacing:2.21px;}
#t1x_79{left:205px;bottom:309px;letter-spacing:0.09px;word-spacing:2.23px;}
#t1y_79{left:57px;bottom:291px;letter-spacing:0.08px;word-spacing:1.17px;}
#t1z_79{left:57px;bottom:272px;letter-spacing:0.06px;word-spacing:2.18px;}
#t20_79{left:57px;bottom:254px;letter-spacing:0.04px;word-spacing:0.7px;}
#t21_79{left:183px;bottom:261px;}
#t22_79{left:57px;bottom:209px;}
#t23_79{left:66px;bottom:209px;}
#t24_79{left:71px;bottom:209px;}
#t25_79{left:98px;bottom:209px;letter-spacing:0.14px;word-spacing:0.79px;}
#t26_79{left:57px;bottom:177px;letter-spacing:0.08px;word-spacing:1.33px;}
#t27_79{left:57px;bottom:158px;letter-spacing:0.06px;word-spacing:1.9px;}
#t28_79{left:57px;bottom:140px;letter-spacing:0.09px;word-spacing:0.5px;}
#t29_79{left:57px;bottom:113px;}
#t2a_79{left:63px;bottom:113px;}
#t2b_79{left:74px;bottom:113px;word-spacing:0.46px;}
#t2c_79{left:168px;bottom:113px;letter-spacing:-0.2px;}
#t2d_79{left:242px;bottom:113px;letter-spacing:0.06px;word-spacing:0.58px;}
#t2e_79{left:57px;bottom:98px;letter-spacing:0.06px;word-spacing:0.84px;}
#t2f_79{left:555px;bottom:99px;letter-spacing:-0.21px;}
#t2g_79{left:57px;bottom:84px;letter-spacing:-0.2px;}
#t2h_79{left:87px;bottom:84px;letter-spacing:0.07px;word-spacing:1.93px;}
#t2i_79{left:57px;bottom:69px;word-spacing:0.71px;}
#t2j_79{left:57px;bottom:55px;letter-spacing:0.07px;word-spacing:0.57px;}

.s0_79{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s1_79{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_79{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s3_79{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s4_79{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
.s5_79{font-size:12px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s6_79{font-size:18px;font-family:TeXPalladioL-BoldOsF_aml;color:#000;}
.s7_79{font-size:18px;font-family:Palatino-Bold_amf;color:#000;}
.s8_79{font-size:12px;font-family:Palatino-Roman_ame;color:#000;}
.s9_79{font-size:11px;font-family:LucidaSansTypewriter_amm;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts79" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: Palatino-Bold_amf;
	src: url("fonts/Palatino-Bold_amf.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-BoldOsF_aml;
	src: url("fonts/TeXPalladioL-BoldOsF_aml.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg79Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg79" style="-webkit-user-select: none;"><object width="662" height="1017" data="79/79.svg" type="image/svg+xml" id="pdf79" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_79" class="t s0_79">58 </span><span id="t2_79" class="t s1_79">Chapter </span><span id="t3_79" class="t s2_79">4</span><span id="t4_79" class="t s1_79">. Composing Objects </span>
<span id="t5_79" class="t s3_79">a </span><span id="t6_79" class="t s4_79">HashMap</span><span id="t7_79" class="t s3_79">, you are creating multiple objects: the </span><span id="t8_79" class="t s4_79">HashMap </span><span id="t9_79" class="t s3_79">object, a number of </span>
<span id="ta_79" class="t s4_79">Map.Entry </span><span id="tb_79" class="t s3_79">objects used by the implementation of </span><span id="tc_79" class="t s4_79">HashMap</span><span id="td_79" class="t s3_79">, and perhaps other in- </span>
<span id="te_79" class="t s3_79">ternal objects as well. The logical state of a </span><span id="tf_79" class="t s4_79">HashMap </span><span id="tg_79" class="t s3_79">includes the state of all its </span>
<span id="th_79" class="t s4_79">Map.Entry </span><span id="ti_79" class="t s3_79">and internal objects, even though they are implemented as separate </span>
<span id="tj_79" class="t s3_79">objects. </span>
<span id="tk_79" class="t s3_79">For better or worse, garbage collection lets us avoid thinking carefully about </span>
<span id="tl_79" class="t s3_79">ownership. When passing an object to a method in C++, you have to think fairly </span>
<span id="tm_79" class="t s3_79">carefully about whether you are transferring ownership, engaging in a short-term </span>
<span id="tn_79" class="t s3_79">loan, or envisioning long-term joint ownership. In Java, all these same ownership </span>
<span id="to_79" class="t s3_79">models are possible, but the garbage collector reduces the cost of many of the </span>
<span id="tp_79" class="t s3_79">common errors in reference sharing, enabling less-than-precise thinking about </span>
<span id="tq_79" class="t s3_79">ownership. </span>
<span id="tr_79" class="t s3_79">In many cases, ownership and encapsulation go together—the object encapsu- </span>
<span id="ts_79" class="t s3_79">lates the state it owns and owns the state it encapsulates. It is the owner of a given </span>
<span id="tt_79" class="t s3_79">state variable that gets to decide on the locking protocol used to maintain the in- </span>
<span id="tu_79" class="t s3_79">tegrity of that variable’s state. Ownership implies control, but once you publish </span>
<span id="tv_79" class="t s3_79">a reference to a mutable object, you no longer have exclusive control; at best, you </span>
<span id="tw_79" class="t s3_79">might have “shared ownership”. A class usually does not own the objects passed </span>
<span id="tx_79" class="t s3_79">to its methods or constructors, unless the method is designed to explicitly trans- </span>
<span id="ty_79" class="t s3_79">fer ownership of objects passed in (such as the synchronized collection wrapper </span>
<span id="tz_79" class="t s3_79">factory methods). </span>
<span id="t10_79" class="t s3_79">Collection classes often exhibit a form of “split ownership”, in which the col- </span>
<span id="t11_79" class="t s3_79">lection owns the state of the collection infrastructure, but client code owns the </span>
<span id="t12_79" class="t s3_79">objects stored in the collection. </span><span id="t13_79" class="t s3_79">An example is </span><span id="t14_79" class="t s4_79">ServletContext </span><span id="t15_79" class="t s3_79">from the serv- </span>
<span id="t16_79" class="t s3_79">let framework. </span><span id="t17_79" class="t s4_79">ServletContext </span><span id="t18_79" class="t s3_79">provides a </span><span id="t19_79" class="t s4_79">Map</span><span id="t1a_79" class="t s3_79">-like object container service to </span>
<span id="t1b_79" class="t s3_79">servlets where they can register and retrieve application objects by name with </span>
<span id="t1c_79" class="t s4_79">setAttribute </span><span id="t1d_79" class="t s3_79">and </span><span id="t1e_79" class="t s4_79">getAttribute</span><span id="t1f_79" class="t s3_79">. </span><span id="t1g_79" class="t s3_79">The </span><span id="t1h_79" class="t s4_79">ServletContext </span><span id="t1i_79" class="t s3_79">object implemented by </span>
<span id="t1j_79" class="t s3_79">the servlet container must be thread-safe, because it will necessarily be accessed </span>
<span id="t1k_79" class="t s3_79">by multiple threads. </span><span id="t1l_79" class="t s3_79">Servlets need not use synchronization when calling </span><span id="t1m_79" class="t s4_79">set- </span>
<span id="t1n_79" class="t s4_79">Attribute </span><span id="t1o_79" class="t s3_79">and </span><span id="t1p_79" class="t s4_79">getAttribute</span><span id="t1q_79" class="t s3_79">, but they may have to use synchronization when </span>
<span id="t1r_79" class="t s1_79">using </span><span id="t1s_79" class="t s3_79">the objects stored in the </span><span id="t1t_79" class="t s4_79">ServletContext</span><span id="t1u_79" class="t s3_79">. These objects are owned by the </span>
<span id="t1v_79" class="t s3_79">application; they are being stored for safekeeping by the servlet container on the </span>
<span id="t1w_79" class="t s3_79">application’s behalf. </span><span id="t1x_79" class="t s3_79">Like all shared objects, they must be shared safely; in or- </span>
<span id="t1y_79" class="t s3_79">der to prevent interference from multiple threads accessing the same object con- </span>
<span id="t1z_79" class="t s3_79">currently, they should either be thread-safe, effectively immutable, or explicitly </span>
<span id="t20_79" class="t s3_79">guarded by a lock. </span>
<span id="t21_79" class="t s5_79">1 </span>
<span id="t22_79" class="t s6_79">4</span><span id="t23_79" class="t s7_79">.</span><span id="t24_79" class="t s6_79">2 </span><span id="t25_79" class="t s7_79" data-mappings='[[12,"fi"]]'>Instance conﬁnement </span>
<span id="t26_79" class="t s3_79">If an object is not thread-safe, several techniques can still let it be used safely in </span>
<span id="t27_79" class="t s3_79">a multithreaded program. You can ensure that it is only accessed from a single </span>
<span id="t28_79" class="t s3_79" data-mappings='[[18,"fi"]]'>thread (thread conﬁnement), or that all access to it is properly guarded by a lock. </span>
<span id="t29_79" class="t s5_79">1</span><span id="t2a_79" class="t s8_79">. </span><span id="t2b_79" class="t s8_79">Interestingly, the </span><span id="t2c_79" class="t s9_79">HttpSession </span><span id="t2d_79" class="t s8_79">object, which performs a similar function in the servlet framework, </span>
<span id="t2e_79" class="t s8_79">may have stricter requirements. Because the servlet container may access the objects in the </span><span id="t2f_79" class="t s9_79">HttpSes- </span>
<span id="t2g_79" class="t s9_79">sion </span><span id="t2h_79" class="t s8_79">so they can be serialized for replication or passivation, they must be thread-safe because the </span>
<span id="t2i_79" class="t s8_79">container will be accessing them as well as the web application. (We say “may have” since replication </span>
<span id="t2j_79" class="t s8_79" data-mappings='[[47,"fi"]]'>and passivation is outside of the servlet speciﬁcation but is a common feature of servlet containers.) </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
