<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p96" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_96{left:57px;bottom:942px;}
#t2_96{left:65px;bottom:942px;}
#t3_96{left:68px;bottom:942px;}
#t4_96{left:76px;bottom:942px;letter-spacing:0.1px;word-spacing:1.94px;}
#t5_96{left:591px;bottom:942px;letter-spacing:0.2px;}
#t6_96{left:80px;bottom:893px;letter-spacing:0.11px;word-spacing:1.69px;}
#t7_96{left:165px;bottom:894px;letter-spacing:0.05px;}
#t8_96{left:260px;bottom:893px;}
#t9_96{left:271px;bottom:894px;letter-spacing:0.05px;}
#ta_96{left:334px;bottom:893px;letter-spacing:0.12px;word-spacing:1.75px;}
#tb_96{left:579px;bottom:893px;letter-spacing:0.1px;}
#tc_96{left:57px;bottom:875px;letter-spacing:0.1px;word-spacing:-0.09px;}
#td_96{left:179px;bottom:875px;letter-spacing:0.09px;word-spacing:0.54px;}
#te_96{left:57px;bottom:857px;letter-spacing:0.09px;word-spacing:2.23px;}
#tf_96{left:210px;bottom:857px;letter-spacing:0.08px;word-spacing:2.29px;}
#tg_96{left:57px;bottom:839px;letter-spacing:0.09px;word-spacing:2.37px;}
#th_96{left:57px;bottom:820px;letter-spacing:0.03px;word-spacing:2.02px;}
#ti_96{left:57px;bottom:802px;letter-spacing:0.03px;word-spacing:0.8px;}
#tj_96{left:80px;bottom:784px;letter-spacing:0.08px;word-spacing:0.75px;}
#tk_96{left:57px;bottom:766px;letter-spacing:0.12px;word-spacing:-0.04px;}
#tl_96{left:153px;bottom:767px;letter-spacing:0.05px;}
#tm_96{left:216px;bottom:766px;letter-spacing:0.07px;word-spacing:0.2px;}
#tn_96{left:57px;bottom:747px;letter-spacing:0.08px;word-spacing:-0.03px;}
#to_96{left:57px;bottom:729px;letter-spacing:0.1px;word-spacing:0.88px;}
#tp_96{left:57px;bottom:711px;letter-spacing:0.09px;word-spacing:0.21px;}
#tq_96{left:57px;bottom:693px;letter-spacing:0.07px;word-spacing:0.82px;}
#tr_96{left:57px;bottom:674px;letter-spacing:0.09px;word-spacing:0.6px;}
#ts_96{left:80px;bottom:656px;letter-spacing:0.09px;word-spacing:1.46px;}
#tt_96{left:57px;bottom:638px;letter-spacing:0.11px;word-spacing:2.23px;}
#tu_96{left:57px;bottom:620px;letter-spacing:0.07px;word-spacing:2.49px;}
#tv_96{left:57px;bottom:601px;letter-spacing:0.07px;word-spacing:1.3px;}
#tw_96{left:57px;bottom:583px;letter-spacing:0.05px;word-spacing:1.28px;}
#tx_96{left:57px;bottom:565px;letter-spacing:0.14px;word-spacing:1.06px;}
#ty_96{left:157px;bottom:565px;}
#tz_96{left:165px;bottom:565px;}
#t10_96{left:168px;bottom:565px;}
#t11_96{left:176px;bottom:565px;letter-spacing:0.07px;word-spacing:1.23px;}
#t12_96{left:57px;bottom:546px;letter-spacing:0.05px;word-spacing:1.98px;}
#t13_96{left:57px;bottom:528px;letter-spacing:0.1px;word-spacing:-0.02px;}
#t14_96{left:226px;bottom:529px;letter-spacing:0.05px;}
#t15_96{left:309px;bottom:528px;letter-spacing:0.06px;word-spacing:0.31px;}
#t16_96{left:57px;bottom:510px;letter-spacing:0.06px;word-spacing:0.75px;}
#t17_96{left:57px;bottom:492px;letter-spacing:0.06px;word-spacing:0.83px;}
#t18_96{left:80px;bottom:473px;letter-spacing:0.09px;word-spacing:1.59px;}
#t19_96{left:57px;bottom:455px;letter-spacing:0.11px;word-spacing:2.32px;}
#t1a_96{left:347px;bottom:455px;letter-spacing:0.01px;word-spacing:2.48px;}
#t1b_96{left:57px;bottom:437px;letter-spacing:0.06px;word-spacing:1.34px;}
#t1c_96{left:508px;bottom:444px;}
#t1d_96{left:522px;bottom:437px;letter-spacing:0.1px;word-spacing:1.32px;}
#t1e_96{left:57px;bottom:419px;letter-spacing:0.03px;word-spacing:0.68px;}
#t1f_96{left:57px;bottom:400px;letter-spacing:0.1px;word-spacing:0.87px;}
#t1g_96{left:57px;bottom:382px;letter-spacing:0.1px;}
#t1h_96{left:80px;bottom:364px;letter-spacing:0.08px;word-spacing:0.68px;}
#t1i_96{left:57px;bottom:345px;letter-spacing:0.04px;word-spacing:1.19px;}
#t1j_96{left:57px;bottom:327px;letter-spacing:0.09px;word-spacing:-0.04px;}
#t1k_96{left:57px;bottom:309px;letter-spacing:0.09px;word-spacing:0.07px;}
#t1l_96{left:57px;bottom:291px;letter-spacing:0.04px;word-spacing:1.67px;}
#t1m_96{left:565px;bottom:291px;letter-spacing:0.07px;}
#t1n_96{left:585px;bottom:291px;letter-spacing:0.07px;}
#t1o_96{left:57px;bottom:272px;letter-spacing:0.08px;word-spacing:2.03px;}
#t1p_96{left:57px;bottom:254px;letter-spacing:0.03px;word-spacing:0.95px;}
#t1q_96{left:80px;bottom:236px;letter-spacing:0.04px;word-spacing:2.17px;}
#t1r_96{left:57px;bottom:218px;letter-spacing:0.12px;word-spacing:1.66px;}
#t1s_96{left:495px;bottom:219px;letter-spacing:0.06px;}
#t1t_96{left:57px;bottom:200px;letter-spacing:0.05px;}
#t1u_96{left:166px;bottom:199px;letter-spacing:0.07px;word-spacing:1.35px;}
#t1v_96{left:57px;bottom:181px;letter-spacing:0.14px;}
#t1w_96{left:90px;bottom:181px;}
#t1x_96{left:98px;bottom:181px;}
#t1y_96{left:102px;bottom:181px;}
#t1z_96{left:109px;bottom:181px;letter-spacing:0.11px;word-spacing:1.54px;}
#t20_96{left:57px;bottom:163px;letter-spacing:0.08px;word-spacing:1.77px;}
#t21_96{left:57px;bottom:145px;letter-spacing:0.08px;word-spacing:2.89px;}
#t22_96{left:57px;bottom:126px;letter-spacing:0.09px;word-spacing:0.62px;}
#t23_96{left:80px;bottom:108px;letter-spacing:0.1px;word-spacing:3.01px;}
#t24_96{left:213px;bottom:109px;letter-spacing:0.06px;}
#t25_96{left:348px;bottom:108px;letter-spacing:0.03px;word-spacing:3.1px;}
#t26_96{left:57px;bottom:90px;letter-spacing:0.08px;word-spacing:2.48px;}
#t27_96{left:339px;bottom:90px;letter-spacing:0.09px;word-spacing:2.68px;}
#t28_96{left:57px;bottom:58px;}
#t29_96{left:63px;bottom:58px;}
#t2a_96{left:74px;bottom:58px;word-spacing:0.68px;}

.s0_96{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s1_96{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_96{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s3_96{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s4_96{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
.s5_96{font-size:12px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s6_96{font-size:12px;font-family:Palatino-Roman_ame;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts96" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg96Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg96" style="-webkit-user-select: none;"><object width="662" height="1017" data="96/96.svg" type="image/svg+xml" id="pdf96" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_96" class="t s0_96">4</span><span id="t2_96" class="t s1_96">.</span><span id="t3_96" class="t s0_96">5</span><span id="t4_96" class="t s1_96">. Documenting synchronization policies </span><span id="t5_96" class="t s2_96">75 </span>
<span id="t6_96" class="t s3_96">Each use of </span><span id="t7_96" class="t s4_96">synchronized</span><span id="t8_96" class="t s3_96">, </span><span id="t9_96" class="t s4_96">volatile</span><span id="ta_96" class="t s3_96">, or any thread-safe class reﬂects a </span><span id="tb_96" class="t s1_96">syn- </span>
<span id="tc_96" class="t s1_96">chronization policy </span><span id="td_96" class="t s3_96" data-mappings='[[2,"fi"]]'>deﬁning a strategy for ensuring the integrity of data in the face </span>
<span id="te_96" class="t s3_96">of concurrent access. </span><span id="tf_96" class="t s3_96">That policy is an element of your program’s design, and </span>
<span id="tg_96" class="t s3_96">should be documented. Of course, the best time to document design decisions </span>
<span id="th_96" class="t s3_96">is at design time. Weeks or months later, the details may be a blur—so write it </span>
<span id="ti_96" class="t s3_96">down before you forget. </span>
<span id="tj_96" class="t s3_96">Crafting a synchronization policy requires a number of decisions: which vari- </span>
<span id="tk_96" class="t s3_96">ables to make </span><span id="tl_96" class="t s4_96">volatile</span><span id="tm_96" class="t s3_96">, which variables to guard with locks, which lock(s) guard </span>
<span id="tn_96" class="t s3_96" data-mappings='[[57,"fi"]]'>which variables, which variables to make immutable or conﬁne to a thread, which </span>
<span id="to_96" class="t s3_96">operations must be atomic, etc. Some of these are strictly implementation details </span>
<span id="tp_96" class="t s3_96">and should be documented for the sake of future maintainers, but some affect the </span>
<span id="tq_96" class="t s3_96">publicly observable locking behavior of your class and should be documented as </span>
<span id="tr_96" class="t s3_96" data-mappings='[[17,"fi"]]'>part of its speciﬁcation. </span>
<span id="ts_96" class="t s3_96">At the very least, document the thread safety guarantees made by a class. Is </span>
<span id="tt_96" class="t s3_96" data-mappings='[[76,"fi"]]'>it thread-safe? Does it make callbacks with a lock held? Are there any speciﬁc </span>
<span id="tu_96" class="t s3_96">locks that affect its behavior? Don’t force clients to make risky guesses. If you </span>
<span id="tv_96" class="t s3_96" data-mappings='[[63,"fi"]]'>don’t want to commit to supporting client-side locking, that’s ﬁne, but say so. If </span>
<span id="tw_96" class="t s3_96">you want clients to be able to create new atomic operations on your class, as we </span>
<span id="tx_96" class="t s3_96">did in Section </span><span id="ty_96" class="t s2_96">4</span><span id="tz_96" class="t s3_96">.</span><span id="t10_96" class="t s2_96">4</span><span id="t11_96" class="t s3_96">, you need to document which locks they should acquire to do </span>
<span id="t12_96" class="t s3_96">so safely. If you use locks to guard state, document this for future maintainers, </span>
<span id="t13_96" class="t s3_96">because it’s so easy—the </span><span id="t14_96" class="t s4_96">@GuardedBy </span><span id="t15_96" class="t s3_96">annotation will do the trick. If you use more </span>
<span id="t16_96" class="t s3_96">subtle means to maintain thread safety, document them because they may not be </span>
<span id="t17_96" class="t s3_96">obvious to maintainers. </span>
<span id="t18_96" class="t s3_96">The current state of affairs in thread safety documentation, even in the plat- </span>
<span id="t19_96" class="t s3_96">form library classes, is not encouraging. </span><span id="t1a_96" class="t s3_96">How many times have you looked at </span>
<span id="t1b_96" class="t s3_96">the Javadoc for a class and wondered whether it was thread-safe? </span>
<span id="t1c_96" class="t s5_96">8 </span>
<span id="t1d_96" class="t s3_96">Most classes </span>
<span id="t1e_96" class="t s3_96" data-mappings='[[40,"fi"],[67,"fi"]]'>don’t offer any clue either way. Many ofﬁcial Java technology speciﬁcations, such </span>
<span id="t1f_96" class="t s3_96">as servlets and JDBC, woefully underdocument their thread safety promises and </span>
<span id="t1g_96" class="t s3_96">requirements. </span>
<span id="t1h_96" class="t s3_96">While prudence suggests that we not assume behaviors that aren’t part of the </span>
<span id="t1i_96" class="t s3_96" data-mappings='[[5,"fi"]]'>speciﬁcation, we have work to get done, and we are often faced with a choice of </span>
<span id="t1j_96" class="t s3_96">bad assumptions. Should we assume an object is thread-safe because it seems that </span>
<span id="t1k_96" class="t s3_96">it ought to be? Should we assume that access to an object can be made thread-safe </span>
<span id="t1l_96" class="t s3_96" data-mappings='[[22,"fi"]]'>by acquiring its lock ﬁrst? (This risky technique works only if we control </span><span id="t1m_96" class="t s1_96">all </span><span id="t1n_96" class="t s3_96">the </span>
<span id="t1o_96" class="t s3_96">code that accesses that object; otherwise, it provides only the illusion of thread </span>
<span id="t1p_96" class="t s3_96">safety.) Neither choice is very satisfying. </span>
<span id="t1q_96" class="t s3_96">To make matters worse, our intuition may often be wrong on which classes </span>
<span id="t1r_96" class="t s3_96">are “probably thread-safe” and which are not. As an example, </span><span id="t1s_96" class="t s4_96">java.text.Sim- </span>
<span id="t1t_96" class="t s4_96">pleDateFormat </span><span id="t1u_96" class="t s3_96">isn’t thread-safe, but the Javadoc neglected to mention this until </span>
<span id="t1v_96" class="t s3_96">JDK </span><span id="t1w_96" class="t s2_96">1</span><span id="t1x_96" class="t s3_96">.</span><span id="t1y_96" class="t s2_96">4</span><span id="t1z_96" class="t s3_96">. That this particular class isn’t thread-safe comes as a surprise to many </span>
<span id="t20_96" class="t s3_96">developers. How many programs mistakenly create a shared instance of a non- </span>
<span id="t21_96" class="t s3_96">thread-safe object and used it from multiple threads, unaware that this might </span>
<span id="t22_96" class="t s3_96">cause erroneous results under heavy load? </span>
<span id="t23_96" class="t s3_96">The problem with </span><span id="t24_96" class="t s4_96">SimpleDateFormat </span><span id="t25_96" class="t s3_96">could be avoided by not assuming a </span>
<span id="t26_96" class="t s3_96">class is thread-safe if it doesn’t say so. </span><span id="t27_96" class="t s3_96">On the other hand, it is impossible to </span>
<span id="t28_96" class="t s5_96">8</span><span id="t29_96" class="t s6_96">. </span><span id="t2a_96" class="t s6_96">If you’ve never wondered this, we admire your optimism. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
