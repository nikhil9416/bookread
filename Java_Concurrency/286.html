<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p286" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_286{left:57px;bottom:942px;letter-spacing:0.2px;}
#t2_286{left:72px;bottom:942px;}
#t3_286{left:76px;bottom:942px;}
#t4_286{left:84px;bottom:942px;letter-spacing:-0.01px;word-spacing:2.29px;}
#t5_286{left:584px;bottom:942px;letter-spacing:0.2px;}
#t6_286{left:59px;bottom:761px;letter-spacing:0.14px;}
#t7_286{left:46px;bottom:743px;letter-spacing:0.11px;word-spacing:0.15px;}
#t8_286{left:157px;bottom:616px;}
#t9_286{left:212px;bottom:616px;}
#ta_286{left:267px;bottom:616px;}
#tb_286{left:322px;bottom:616px;}
#tc_286{left:377px;bottom:616px;}
#td_286{left:428px;bottom:616px;letter-spacing:0.21px;}
#te_286{left:136px;bottom:642px;}
#tf_286{left:128px;bottom:697px;letter-spacing:0.21px;}
#tg_286{left:120px;bottom:752px;letter-spacing:0.21px;}
#th_286{left:120px;bottom:807px;letter-spacing:0.21px;}
#ti_286{left:120px;bottom:862px;letter-spacing:0.21px;}
#tj_286{left:299px;bottom:699px;letter-spacing:0.14px;}
#tk_286{left:460px;bottom:616px;letter-spacing:0.17px;}
#tl_286{left:507px;bottom:616px;letter-spacing:0.17px;}
#tm_286{left:553px;bottom:616px;letter-spacing:0.17px;}
#tn_286{left:498px;bottom:699px;letter-spacing:0.16px;}
#to_286{left:284px;bottom:598px;letter-spacing:0.06px;word-spacing:0.19px;}
#tp_286{left:57px;bottom:571px;}
#tq_286{left:65px;bottom:571px;letter-spacing:0.14px;word-spacing:3.73px;}
#tr_286{left:127px;bottom:571px;}
#ts_286{left:131px;bottom:571px;}
#tt_286{left:139px;bottom:571px;}
#tu_286{left:157px;bottom:571px;letter-spacing:0.09px;word-spacing:3.88px;}
#tv_286{left:385px;bottom:572px;letter-spacing:0.06px;}
#tw_286{left:520px;bottom:571px;letter-spacing:0.12px;word-spacing:3.62px;}
#tx_286{left:57px;bottom:553px;letter-spacing:0.11px;word-spacing:0.56px;}
#ty_286{left:80px;bottom:492px;letter-spacing:0.11px;}
#tz_286{left:127px;bottom:492px;letter-spacing:0.2px;}
#t10_286{left:142px;bottom:492px;}
#t11_286{left:146px;bottom:492px;}
#t12_286{left:157px;bottom:492px;letter-spacing:0.05px;word-spacing:-0.07px;}
#t13_286{left:503px;bottom:493px;letter-spacing:0.05px;}
#t14_286{left:57px;bottom:475px;letter-spacing:0.05px;}
#t15_286{left:92px;bottom:474px;letter-spacing:0.08px;word-spacing:-0.19px;}
#t16_286{left:236px;bottom:474px;letter-spacing:0.2px;}
#t17_286{left:270px;bottom:474px;letter-spacing:0.1px;word-spacing:-0.19px;}
#t18_286{left:383px;bottom:474px;letter-spacing:0.2px;}
#t19_286{left:410px;bottom:474px;letter-spacing:0.1px;word-spacing:-0.3px;}
#t1a_286{left:57px;bottom:456px;letter-spacing:0.2px;}
#t1b_286{left:93px;bottom:456px;letter-spacing:0.12px;word-spacing:2.19px;}
#t1c_286{left:57px;bottom:438px;letter-spacing:0.2px;}
#t1d_286{left:72px;bottom:438px;}
#t1e_286{left:76px;bottom:438px;}
#t1f_286{left:89px;bottom:438px;letter-spacing:0.09px;word-spacing:2.25px;}
#t1g_286{left:57px;bottom:420px;letter-spacing:0.1px;word-spacing:2.11px;}
#t1h_286{left:382px;bottom:420px;letter-spacing:0.2px;}
#t1i_286{left:410px;bottom:420px;letter-spacing:0.08px;}
#t1j_286{left:430px;bottom:420px;}
#t1k_286{left:437px;bottom:420px;}
#t1l_286{left:441px;bottom:420px;letter-spacing:0.2px;}
#t1m_286{left:470px;bottom:420px;letter-spacing:0.01px;word-spacing:2.4px;}
#t1n_286{left:57px;bottom:401px;letter-spacing:0.05px;word-spacing:0.86px;}
#t1o_286{left:57px;bottom:383px;letter-spacing:0.07px;word-spacing:0.68px;}
#t1p_286{left:249px;bottom:384px;letter-spacing:0.05px;}
#t1q_286{left:357px;bottom:383px;letter-spacing:0.07px;word-spacing:0.7px;}
#t1r_286{left:57px;bottom:365px;letter-spacing:0.12px;word-spacing:1.31px;}
#t1s_286{left:176px;bottom:365px;letter-spacing:0.2px;}
#t1t_286{left:191px;bottom:365px;}
#t1u_286{left:195px;bottom:365px;}
#t1v_286{left:207px;bottom:365px;letter-spacing:0.07px;word-spacing:0.73px;}
#t1w_286{left:57px;bottom:346px;letter-spacing:0.08px;word-spacing:2.34px;}
#t1x_286{left:190px;bottom:346px;letter-spacing:0.2px;}
#t1y_286{left:206px;bottom:346px;}
#t1z_286{left:210px;bottom:346px;letter-spacing:0.2px;}
#t20_286{left:238px;bottom:346px;letter-spacing:0.08px;}
#t21_286{left:257px;bottom:346px;letter-spacing:0.2px;}
#t22_286{left:273px;bottom:346px;}
#t23_286{left:277px;bottom:346px;letter-spacing:0.2px;}
#t24_286{left:305px;bottom:346px;letter-spacing:0.11px;word-spacing:2.24px;}
#t25_286{left:57px;bottom:328px;letter-spacing:0.08px;word-spacing:2.03px;}
#t26_286{left:57px;bottom:310px;letter-spacing:0.06px;word-spacing:0.73px;}
#t27_286{left:80px;bottom:292px;letter-spacing:0.05px;word-spacing:0.68px;}
#t28_286{left:57px;bottom:273px;letter-spacing:0.06px;word-spacing:1.33px;}
#t29_286{left:57px;bottom:255px;letter-spacing:0.09px;word-spacing:0.93px;}
#t2a_286{left:57px;bottom:237px;letter-spacing:0.08px;word-spacing:2.39px;}
#t2b_286{left:57px;bottom:219px;letter-spacing:0.11px;word-spacing:2.59px;}
#t2c_286{left:530px;bottom:219px;letter-spacing:0.09px;}
#t2d_286{left:580px;bottom:219px;letter-spacing:0.2px;}
#t2e_286{left:595px;bottom:219px;}
#t2f_286{left:599px;bottom:219px;}
#t2g_286{left:57px;bottom:200px;letter-spacing:0.06px;word-spacing:1.33px;}
#t2h_286{left:57px;bottom:182px;letter-spacing:0.09px;word-spacing:0.64px;}
#t2i_286{left:80px;bottom:164px;letter-spacing:0.08px;word-spacing:1.1px;}
#t2j_286{left:57px;bottom:146px;letter-spacing:0.09px;word-spacing:0.95px;}
#t2k_286{left:57px;bottom:127px;letter-spacing:0.08px;word-spacing:0.96px;}
#t2l_286{left:57px;bottom:109px;letter-spacing:0.09px;}
#t2m_286{left:124px;bottom:110px;letter-spacing:0.05px;}
#t2n_286{left:201px;bottom:109px;letter-spacing:0.07px;word-spacing:1.45px;}
#t2o_286{left:57px;bottom:91px;letter-spacing:-0.08px;word-spacing:0.98px;}

.s0_286{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s1_286{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_286{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s3_286{font-size:13px;font-family:LucidaSans_amq;color:#000;}
.s4_286{font-size:9px;font-family:LucidaSans_amq;color:#000;}
.s5_286{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s6_286{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts286" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: LucidaSans_amq;
	src: url("fonts/LucidaSans_amq.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg286Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg286" style="-webkit-user-select: none;"><object width="662" height="1017" data="286/286.svg" type="image/svg+xml" id="pdf286" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_286" class="t s0_286">12</span><span id="t2_286" class="t s1_286">.</span><span id="t3_286" class="t s0_286">2</span><span id="t4_286" class="t s1_286">. Testing for performance </span><span id="t5_286" class="t s2_286">265 </span>
<span id="t6_286" class="t s3_286">Count </span>
<span id="t7_286" class="t s3_286">of threads </span>
<span id="t8_286" class="t s3_286">0 </span><span id="t9_286" class="t s3_286">2 </span><span id="ta_286" class="t s3_286">4 </span><span id="tb_286" class="t s3_286">6 </span><span id="tc_286" class="t s3_286">8 </span><span id="td_286" class="t s3_286">10 </span>
<span id="te_286" class="t s3_286">0 </span>
<span id="tf_286" class="t s3_286">50 </span>
<span id="tg_286" class="t s3_286">100 </span>
<span id="th_286" class="t s3_286">150 </span>
<span id="ti_286" class="t s3_286">200 </span>
<span id="tj_286" class="t s4_286">nonfair </span>
<span id="tk_286" class="t s3_286">38.1 </span><span id="tl_286" class="t s3_286">38.2 </span><span id="tm_286" class="t s3_286">38.3 </span>
<span id="tn_286" class="t s4_286">fair </span>
<span id="to_286" class="t s3_286">Per-thread completion time (s) </span>
<span id="tp_286" class="t s5_286">F</span><span id="tq_286" class="t s2_286">igure 12</span><span id="tr_286" class="t s5_286">.</span><span id="ts_286" class="t s2_286">3</span><span id="tt_286" class="t s5_286">. </span><span id="tu_286" class="t s5_286">Completion time histogram for </span><span id="tv_286" class="t s6_286">TimedPutTakeTest </span><span id="tw_286" class="t s5_286">with default </span>
<span id="tx_286" class="t s5_286">(nonfair) and fair semaphores. </span>
<span id="ty_286" class="t s5_286">Figure </span><span id="tz_286" class="t s2_286">12</span><span id="t10_286" class="t s5_286">.</span><span id="t11_286" class="t s2_286">3 </span><span id="t12_286" class="t s5_286">shows the per-task completion times of a variant of </span><span id="t13_286" class="t s6_286">TimedPutTake- </span>
<span id="t14_286" class="t s6_286">Test </span><span id="t15_286" class="t s5_286">using a buffer size of </span><span id="t16_286" class="t s2_286">1000 </span><span id="t17_286" class="t s5_286">in which each of </span><span id="t18_286" class="t s2_286">256 </span><span id="t19_286" class="t s5_286">concurrent tasks iterates only </span>
<span id="t1a_286" class="t s2_286">1000 </span><span id="t1b_286" class="t s5_286">items for nonfair (shaded bars) and fair semaphores (open bars). (Section </span>
<span id="t1c_286" class="t s2_286">13</span><span id="t1d_286" class="t s5_286">.</span><span id="t1e_286" class="t s2_286">3 </span><span id="t1f_286" class="t s5_286">explains fair versus nonfair queueing for locks and semaphores.) Comple- </span>
<span id="t1g_286" class="t s5_286">tion times for nonfair semaphores range from </span><span id="t1h_286" class="t s2_286">104 </span><span id="t1i_286" class="t s5_286">to </span><span id="t1j_286" class="t s2_286">8</span><span id="t1k_286" class="t s5_286">,</span><span id="t1l_286" class="t s2_286">714 </span><span id="t1m_286" class="t s5_286">ms, a factor of over </span>
<span id="t1n_286" class="t s5_286">eighty. It is possible to reduce this range by forcing more fairness in concurrency </span>
<span id="t1o_286" class="t s5_286">control; this is easy to do in </span><span id="t1p_286" class="t s6_286">BoundedBuffer </span><span id="t1q_286" class="t s5_286">by initializing the semaphores to fair </span>
<span id="t1r_286" class="t s5_286">mode. As Figure </span><span id="t1s_286" class="t s2_286">12</span><span id="t1t_286" class="t s5_286">.</span><span id="t1u_286" class="t s2_286">3 </span><span id="t1v_286" class="t s5_286">shows, this succeeds in greatly reducing the variance (now </span>
<span id="t1w_286" class="t s5_286">ranging only from </span><span id="t1x_286" class="t s2_286">38</span><span id="t1y_286" class="t s5_286">,</span><span id="t1z_286" class="t s2_286">194 </span><span id="t20_286" class="t s5_286">to </span><span id="t21_286" class="t s2_286">38</span><span id="t22_286" class="t s5_286">,</span><span id="t23_286" class="t s2_286">207 </span><span id="t24_286" class="t s5_286">ms), but unfortunately also greatly reduces </span>
<span id="t25_286" class="t s5_286">the throughput. (A longer-running test with more typical kinds of tasks would </span>
<span id="t26_286" class="t s5_286">probably show an even larger throughput reduction.) </span>
<span id="t27_286" class="t s5_286">We saw before that very small buffer sizes cause heavy context switching and </span>
<span id="t28_286" class="t s5_286">poor throughput even in nonfair mode, because nearly every operation involves </span>
<span id="t29_286" class="t s5_286">a context switch. As an indication that the cost of fairness results primarily from </span>
<span id="t2a_286" class="t s5_286">blocking threads, we can rerun this test with a buffer size of one and see that </span>
<span id="t2b_286" class="t s5_286">nonfair semaphores now perform comparably to fair semaphores. </span><span id="t2c_286" class="t s5_286">Figure </span><span id="t2d_286" class="t s2_286">12</span><span id="t2e_286" class="t s5_286">.</span><span id="t2f_286" class="t s2_286">4 </span>
<span id="t2g_286" class="t s5_286">shows that fairness doesn’t make the average much worse or the variance much </span>
<span id="t2h_286" class="t s5_286">better in this case. </span>
<span id="t2i_286" class="t s5_286">So, unless threads are continually blocking anyway because of tight synchro- </span>
<span id="t2j_286" class="t s5_286">nization requirements, nonfair semaphores provide much better throughput and </span>
<span id="t2k_286" class="t s5_286">fair semaphores provides lower variance. Because the results are so dramatically </span>
<span id="t2l_286" class="t s5_286">different, </span><span id="t2m_286" class="t s6_286">Semaphore </span><span id="t2n_286" class="t s5_286">forces its clients to decide which of the two factors to opti- </span>
<span id="t2o_286" class="t s5_286">mize for. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
