<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p365" style="overflow: hidden; position: relative; background-color: white; width: 662px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_365{left:57px;bottom:942px;letter-spacing:0.2px;}
#t2_365{left:372px;bottom:942px;letter-spacing:0.13px;}
#t3_365{left:425px;bottom:942px;letter-spacing:0.2px;}
#t4_365{left:440px;bottom:942px;letter-spacing:0.13px;word-spacing:1.58px;}
#t5_365{left:80px;bottom:893px;letter-spacing:0.07px;word-spacing:3.11px;}
#t6_365{left:551px;bottom:893px;letter-spacing:0.12px;}
#t7_365{left:57px;bottom:875px;letter-spacing:0.01px;}
#t8_365{left:98px;bottom:875px;letter-spacing:0.08px;word-spacing:1.4px;}
#t9_365{left:57px;bottom:857px;letter-spacing:0.08px;}
#ta_365{left:101px;bottom:857px;}
#tb_365{left:113px;bottom:857px;letter-spacing:0.11px;word-spacing:0.67px;}
#tc_365{left:272px;bottom:857px;letter-spacing:0.08px;}
#td_365{left:367px;bottom:857px;letter-spacing:0.09px;word-spacing:0.72px;}
#te_365{left:57px;bottom:839px;}
#tf_365{left:69px;bottom:839px;}
#tg_365{left:80px;bottom:820px;letter-spacing:0.03px;word-spacing:1px;}
#th_365{left:343px;bottom:821px;letter-spacing:0.05px;}
#ti_365{left:427px;bottom:820px;letter-spacing:0.08px;word-spacing:0.9px;}
#tj_365{left:57px;bottom:802px;letter-spacing:0.03px;word-spacing:2.55px;}
#tk_365{left:259px;bottom:802px;letter-spacing:0.03px;word-spacing:2.64px;}
#tl_365{left:57px;bottom:784px;letter-spacing:0.11px;word-spacing:2.33px;}
#tm_365{left:389px;bottom:784px;letter-spacing:0.08px;}
#tn_365{left:486px;bottom:784px;letter-spacing:0.06px;word-spacing:2.26px;}
#to_365{left:57px;bottom:766px;letter-spacing:0.1px;word-spacing:0.59px;}
#tp_365{left:559px;bottom:767px;letter-spacing:0.05px;}
#tq_365{left:57px;bottom:748px;letter-spacing:0.05px;}
#tr_365{left:126px;bottom:747px;letter-spacing:0.11px;word-spacing:2.45px;}
#ts_365{left:57px;bottom:729px;letter-spacing:0.09px;word-spacing:0.05px;}
#tt_365{left:57px;bottom:711px;letter-spacing:0.1px;word-spacing:1.25px;}
#tu_365{left:503px;bottom:712px;letter-spacing:0.05px;}
#tv_365{left:57px;bottom:693px;letter-spacing:0.1px;word-spacing:0.65px;}
#tw_365{left:354px;bottom:693px;letter-spacing:0.08px;}
#tx_365{left:449px;bottom:693px;letter-spacing:0.11px;word-spacing:0.81px;}
#ty_365{left:80px;bottom:674px;letter-spacing:0.09px;}
#tz_365{left:123px;bottom:674px;letter-spacing:0.08px;}
#t10_365{left:218px;bottom:674px;letter-spacing:0.09px;word-spacing:0.59px;}
#t11_365{left:78px;bottom:642px;letter-spacing:0.11px;word-spacing:1.45px;}
#t12_365{left:387px;bottom:642px;letter-spacing:0.08px;}
#t13_365{left:482px;bottom:642px;letter-spacing:0.11px;word-spacing:1.05px;}
#t14_365{left:95px;bottom:624px;letter-spacing:0.05px;word-spacing:0.72px;}
#t15_365{left:78px;bottom:594px;letter-spacing:0.06px;word-spacing:2.34px;}
#t16_365{left:244px;bottom:595px;letter-spacing:0.05px;}
#t17_365{left:361px;bottom:594px;letter-spacing:0.08px;}
#t18_365{left:457px;bottom:594px;letter-spacing:0.11px;word-spacing:1.54px;}
#t19_365{left:95px;bottom:577px;letter-spacing:0.05px;}
#t1a_365{left:139px;bottom:576px;letter-spacing:0.09px;word-spacing:0.65px;}
#t1b_365{left:78px;bottom:546px;letter-spacing:0.1px;word-spacing:2.58px;}
#t1c_365{left:264px;bottom:547px;letter-spacing:0.05px;}
#t1d_365{left:342px;bottom:546px;letter-spacing:0.08px;}
#t1e_365{left:438px;bottom:546px;letter-spacing:0.1px;word-spacing:2.3px;}
#t1f_365{left:95px;bottom:528px;letter-spacing:0.11px;word-spacing:0.59px;}
#t1g_365{left:165px;bottom:529px;letter-spacing:0.05px;}
#t1h_365{left:236px;bottom:528px;}
#t1i_365{left:78px;bottom:498px;letter-spacing:0.06px;word-spacing:2.79px;}
#t1j_365{left:403px;bottom:499px;letter-spacing:0.05px;}
#t1k_365{left:458px;bottom:498px;letter-spacing:0.08px;}
#t1l_365{left:554px;bottom:498px;letter-spacing:0.1px;}
#t1m_365{left:95px;bottom:480px;letter-spacing:0.11px;word-spacing:0.52px;}
#t1n_365{left:319px;bottom:481px;letter-spacing:0.05px;}
#t1o_365{left:398px;bottom:480px;}
#t1p_365{left:78px;bottom:450px;letter-spacing:0.09px;word-spacing:2.8px;}
#t1q_365{left:188px;bottom:451px;letter-spacing:0.05px;}
#t1r_365{left:258px;bottom:450px;letter-spacing:0.04px;}
#t1s_365{left:277px;bottom:451px;letter-spacing:0.05px;}
#t1t_365{left:347px;bottom:450px;letter-spacing:0.14px;word-spacing:1.56px;}
#t1u_365{left:387px;bottom:451px;letter-spacing:0.05px;}
#t1v_365{left:456px;bottom:450px;letter-spacing:0.08px;}
#t1w_365{left:552px;bottom:450px;letter-spacing:0.09px;word-spacing:1.56px;}
#t1x_365{left:95px;bottom:432px;letter-spacing:0.09px;word-spacing:0.72px;}
#t1y_365{left:78px;bottom:402px;letter-spacing:0.13px;word-spacing:1.13px;}
#t1z_365{left:248px;bottom:403px;letter-spacing:0.05px;}
#t20_365{left:355px;bottom:402px;letter-spacing:0.04px;}
#t21_365{left:374px;bottom:403px;letter-spacing:0.05px;}
#t22_365{left:450px;bottom:402px;letter-spacing:0.08px;}
#t23_365{left:545px;bottom:402px;letter-spacing:0.08px;word-spacing:0.66px;}
#t24_365{left:95px;bottom:384px;letter-spacing:0.11px;word-spacing:1.76px;}
#t25_365{left:551px;bottom:385px;letter-spacing:0.05px;}
#t26_365{left:95px;bottom:366px;letter-spacing:0.05px;}
#t27_365{left:156px;bottom:365px;letter-spacing:0.11px;word-spacing:1.19px;}
#t28_365{left:458px;bottom:365px;letter-spacing:0.08px;}
#t29_365{left:553px;bottom:365px;letter-spacing:0.08px;word-spacing:1.4px;}
#t2a_365{left:95px;bottom:347px;letter-spacing:0.1px;word-spacing:-0.19px;}
#t2b_365{left:265px;bottom:347px;letter-spacing:0.08px;}
#t2c_365{left:360px;bottom:347px;letter-spacing:0.07px;word-spacing:-0.32px;}
#t2d_365{left:57px;bottom:301px;letter-spacing:0.17px;}
#t2e_365{left:75px;bottom:301px;}
#t2f_365{left:80px;bottom:301px;}
#t2g_365{left:107px;bottom:301px;letter-spacing:0.11px;}
#t2h_365{left:57px;bottom:269px;letter-spacing:0.13px;}
#t2i_365{left:117px;bottom:269px;}
#t2j_365{left:129px;bottom:269px;letter-spacing:0.09px;word-spacing:1.39px;}
#t2k_365{left:57px;bottom:251px;letter-spacing:0.1px;word-spacing:2.17px;}
#t2l_365{left:57px;bottom:233px;letter-spacing:0.07px;word-spacing:1.17px;}
#t2m_365{left:57px;bottom:214px;letter-spacing:0.11px;word-spacing:1.71px;}
#t2n_365{left:147px;bottom:214px;letter-spacing:0.08px;}
#t2o_365{left:243px;bottom:214px;letter-spacing:0.08px;word-spacing:1.73px;}
#t2p_365{left:57px;bottom:196px;letter-spacing:0.09px;word-spacing:0.67px;}
#t2q_365{left:57px;bottom:154px;letter-spacing:-0.25px;}
#t2r_365{left:73px;bottom:154px;}
#t2s_365{left:78px;bottom:154px;}
#t2t_365{left:86px;bottom:154px;}
#t2u_365{left:90px;bottom:154px;}
#t2v_365{left:115px;bottom:154px;letter-spacing:-0.17px;word-spacing:0.72px;}
#t2w_365{left:57px;bottom:126px;letter-spacing:0.09px;word-spacing:2.54px;}
#t2x_365{left:402px;bottom:126px;letter-spacing:0.08px;}
#t2y_365{left:499px;bottom:126px;letter-spacing:0.09px;word-spacing:2.64px;}
#t2z_365{left:57px;bottom:108px;letter-spacing:0.09px;word-spacing:0.71px;}
#t30_365{left:57px;bottom:90px;letter-spacing:0.1px;word-spacing:0.41px;}
#t31_365{left:199px;bottom:90px;letter-spacing:0.08px;word-spacing:0.27px;}
#t32_365{left:371px;bottom:90px;letter-spacing:0.15px;word-spacing:0.16px;}
#t33_365{left:455px;bottom:90px;}
#t34_365{left:462px;bottom:90px;}
#t35_365{left:466px;bottom:90px;}
#t36_365{left:474px;bottom:90px;letter-spacing:0.08px;word-spacing:0.76px;}
#t37_365{left:57px;bottom:72px;letter-spacing:0.04px;word-spacing:0.71px;}
#t38_365{left:57px;bottom:53px;letter-spacing:0.07px;word-spacing:0.87px;}

.s0_365{font-size:15px;font-family:TeXPalladioL-SC_amc;color:#000;}
.s1_365{font-size:15px;font-family:Palatino-Italic_amd;color:#000;}
.s2_365{font-size:15px;font-family:TeXPalladioL-ItalicOsF_amn;color:#000;}
.s3_365{font-size:15px;font-family:Palatino-Roman_ame;color:#000;}
.s4_365{font-size:13px;font-family:LucidaSansTypewriter_amm;color:#000;}
.s5_365{font-size:18px;font-family:TeXPalladioL-BoldOsF_aml;color:#000;}
.s6_365{font-size:18px;font-family:Palatino-Bold_amf;color:#000;}
.s7_365{font-size:17px;font-family:TeXPalladioL-BoldOsF_aml;color:#000;}
.s8_365{font-size:17px;font-family:Palatino-Bold_amf;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts365" type="text/css" >

@font-face {
	font-family: LucidaSansTypewriter_amm;
	src: url("fonts/LucidaSansTypewriter_amm.woff") format("woff");
}

@font-face {
	font-family: Palatino-Bold_amf;
	src: url("fonts/Palatino-Bold_amf.woff") format("woff");
}

@font-face {
	font-family: Palatino-Italic_amd;
	src: url("fonts/Palatino-Italic_amd.woff") format("woff");
}

@font-face {
	font-family: Palatino-Roman_ame;
	src: url("fonts/Palatino-Roman_ame.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-BoldOsF_aml;
	src: url("fonts/TeXPalladioL-BoldOsF_aml.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-ItalicOsF_amn;
	src: url("fonts/TeXPalladioL-ItalicOsF_amn.woff") format("woff");
}

@font-face {
	font-family: TeXPalladioL-SC_amc;
	src: url("fonts/TeXPalladioL-SC_amc.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg365Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg365" style="-webkit-user-select: none;"><object width="662" height="1017" data="365/365.svg" type="image/svg+xml" id="pdf365" style="width:662px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_365" class="t s0_365">344 </span><span id="t2_365" class="t s1_365">Chapter </span><span id="t3_365" class="t s2_365">16</span><span id="t4_365" class="t s1_365">. The Java Memory Model </span>
<span id="t5_365" class="t s3_365">We call this technique “piggybacking” because it uses an existing </span><span id="t6_365" class="t s1_365">happens- </span>
<span id="t7_365" class="t s1_365">before </span><span id="t8_365" class="t s3_365">ordering that was created for some other reason to ensure the visibility of </span>
<span id="t9_365" class="t s3_365">object </span><span id="ta_365" class="t s1_365">X</span><span id="tb_365" class="t s3_365">, rather than creating a </span><span id="tc_365" class="t s1_365">happens-before </span><span id="td_365" class="t s3_365" data-mappings='[[14,"fi"]]'>ordering speciﬁcally for publishing </span>
<span id="te_365" class="t s1_365">X</span><span id="tf_365" class="t s3_365">. </span>
<span id="tg_365" class="t s3_365">Piggybacking of the sort employed by </span><span id="th_365" class="t s4_365">FutureTask </span><span id="ti_365" class="t s3_365">is quite fragile and should </span>
<span id="tj_365" class="t s3_365">not be undertaken casually. </span><span id="tk_365" class="t s3_365">However, in some cases piggybacking is perfectly </span>
<span id="tl_365" class="t s3_365">reasonable, such as when a class commits to a </span><span id="tm_365" class="t s1_365">happens-before </span><span id="tn_365" class="t s3_365">ordering between </span>
<span id="to_365" class="t s3_365" data-mappings='[[28,"fi"]]'>methods as part of its speciﬁcation. For example, safe publication using a </span><span id="tp_365" class="t s4_365">Block- </span>
<span id="tq_365" class="t s4_365">ingQueue </span><span id="tr_365" class="t s3_365">is a form of piggybacking. One thread putting an object on a queue </span>
<span id="ts_365" class="t s3_365">and another thread subsequently retrieving it constitutes safe publication because </span>
<span id="tt_365" class="t s3_365" data-mappings='[[29,"fi"]]'>there is guaranteed to be sufﬁcient internal synchronization in a </span><span id="tu_365" class="t s4_365">BlockingQueue </span>
<span id="tv_365" class="t s3_365">implementation to ensure that the enqueue </span><span id="tw_365" class="t s1_365">happens-before </span><span id="tx_365" class="t s3_365">the dequeue. </span>
<span id="ty_365" class="t s3_365">Other </span><span id="tz_365" class="t s1_365">happens-before </span><span id="t10_365" class="t s3_365">orderings guaranteed by the class library include: </span>
<span id="t11_365" class="t s3_365">• Placing an item in a thread-safe collection </span><span id="t12_365" class="t s1_365">happens-before </span><span id="t13_365" class="t s3_365">another thread re- </span>
<span id="t14_365" class="t s3_365">trieves that item from the collection; </span>
<span id="t15_365" class="t s3_365">• Counting down on a </span><span id="t16_365" class="t s4_365">CountDownLatch </span><span id="t17_365" class="t s1_365">happens-before </span><span id="t18_365" class="t s3_365">a thread returns from </span>
<span id="t19_365" class="t s4_365">await </span><span id="t1a_365" class="t s3_365">on that latch; </span>
<span id="t1b_365" class="t s3_365">• Releasing a permit to a </span><span id="t1c_365" class="t s4_365">Semaphore </span><span id="t1d_365" class="t s1_365">happens-before </span><span id="t1e_365" class="t s3_365">acquiring a permit from </span>
<span id="t1f_365" class="t s3_365">that same </span><span id="t1g_365" class="t s4_365">Semaphore</span><span id="t1h_365" class="t s3_365">; </span>
<span id="t1i_365" class="t s3_365">• Actions taken by the task represented by a </span><span id="t1j_365" class="t s4_365">Future </span><span id="t1k_365" class="t s1_365">happens-before </span><span id="t1l_365" class="t s3_365">another </span>
<span id="t1m_365" class="t s3_365">thread successfully returns from </span><span id="t1n_365" class="t s4_365">Future.get</span><span id="t1o_365" class="t s3_365">; </span>
<span id="t1p_365" class="t s3_365">• Submitting a </span><span id="t1q_365" class="t s4_365">Runnable </span><span id="t1r_365" class="t s3_365">or </span><span id="t1s_365" class="t s4_365">Callable </span><span id="t1t_365" class="t s3_365">to an </span><span id="t1u_365" class="t s4_365">Executor </span><span id="t1v_365" class="t s1_365">happens-before </span><span id="t1w_365" class="t s3_365">the task </span>
<span id="t1x_365" class="t s3_365">begins execution; and </span>
<span id="t1y_365" class="t s3_365">• A thread arriving at a </span><span id="t1z_365" class="t s4_365">CyclicBarrier </span><span id="t20_365" class="t s3_365">or </span><span id="t21_365" class="t s4_365">Exchanger </span><span id="t22_365" class="t s1_365">happens-before </span><span id="t23_365" class="t s3_365">the other </span>
<span id="t24_365" class="t s3_365">threads are released from that same barrier or exchange point. If </span><span id="t25_365" class="t s4_365">Cyclic- </span>
<span id="t26_365" class="t s4_365">Barrier </span><span id="t27_365" class="t s3_365">uses a barrier action, arriving at the barrier </span><span id="t28_365" class="t s1_365">happens-before </span><span id="t29_365" class="t s3_365">the bar- </span>
<span id="t2a_365" class="t s3_365">rier action, which in turn </span><span id="t2b_365" class="t s1_365">happens-before </span><span id="t2c_365" class="t s3_365">threads are released from the barrier. </span>
<span id="t2d_365" class="t s5_365">16</span><span id="t2e_365" class="t s6_365">.</span><span id="t2f_365" class="t s5_365">2 </span><span id="t2g_365" class="t s6_365">Publication </span>
<span id="t2h_365" class="t s3_365">Chapter </span><span id="t2i_365" class="t s0_365">3 </span><span id="t2j_365" class="t s3_365">explored how an object could be safely or improperly published. The </span>
<span id="t2k_365" class="t s3_365">safe publication techniques described there derive their safety from guarantees </span>
<span id="t2l_365" class="t s3_365">provided by the JMM; the risks of improper publication are consequences of the </span>
<span id="t2m_365" class="t s3_365">absence of a </span><span id="t2n_365" class="t s1_365">happens-before </span><span id="t2o_365" class="t s3_365">ordering between publishing a shared object and ac- </span>
<span id="t2p_365" class="t s3_365">cessing it from another thread. </span>
<span id="t2q_365" class="t s7_365">16</span><span id="t2r_365" class="t s8_365">.</span><span id="t2s_365" class="t s7_365">2</span><span id="t2t_365" class="t s8_365">.</span><span id="t2u_365" class="t s7_365">1 </span><span id="t2v_365" class="t s8_365">Unsafe publication </span>
<span id="t2w_365" class="t s3_365">The possibility of reordering in the absence of a </span><span id="t2x_365" class="t s1_365">happens-before </span><span id="t2y_365" class="t s3_365">relationship ex- </span>
<span id="t2z_365" class="t s3_365">plains why publishing an object without adequate synchronization can allow an- </span>
<span id="t30_365" class="t s3_365">other thread to see a </span><span id="t31_365" class="t s1_365">partially constructed object </span><span id="t32_365" class="t s3_365">(see Section </span><span id="t33_365" class="t s0_365">3</span><span id="t34_365" class="t s3_365">.</span><span id="t35_365" class="t s0_365">5</span><span id="t36_365" class="t s3_365">). Initializing a new </span>
<span id="t37_365" class="t s3_365" data-mappings='[[54,"fi"]]'>object involves writing to variables—the new object’s ﬁelds. Similarly, publishing </span>
<span id="t38_365" class="t s3_365">a reference involves writing to another variable—the reference to the new object. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
