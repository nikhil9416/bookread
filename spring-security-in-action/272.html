<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p272" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_272{left:87px;bottom:960px;letter-spacing:-0.13px;}
#t2_272{left:260px;bottom:961px;}
#t3_272{left:268px;bottom:962px;letter-spacing:-0.14px;}
#t4_272{left:308px;bottom:961px;letter-spacing:0.13px;}
#t5_272{left:335px;bottom:960px;letter-spacing:-0.12px;word-spacing:-0.02px;}
#t6_272{left:142px;bottom:917px;letter-spacing:0.1px;word-spacing:0.15px;}
#t7_272{left:142px;bottom:898px;letter-spacing:0.13px;word-spacing:0.84px;}
#t8_272{left:142px;bottom:878px;letter-spacing:0.1px;word-spacing:-0.04px;}
#t9_272{left:167px;bottom:859px;letter-spacing:0.13px;word-spacing:2.29px;}
#ta_272{left:142px;bottom:839px;letter-spacing:0.12px;word-spacing:1.47px;}
#tb_272{left:142px;bottom:820px;letter-spacing:0.12px;word-spacing:1.52px;}
#tc_272{left:142px;bottom:800px;letter-spacing:0.12px;word-spacing:0.63px;}
#td_272{left:142px;bottom:781px;letter-spacing:0.12px;word-spacing:0.59px;}
#te_272{left:142px;bottom:761px;letter-spacing:0.1px;word-spacing:1.4px;}
#tf_272{left:142px;bottom:741px;letter-spacing:0.12px;word-spacing:4.61px;}
#tg_272{left:142px;bottom:722px;letter-spacing:0.06px;}
#th_272{left:165px;bottom:702px;letter-spacing:0.11px;word-spacing:-0.16px;}
#ti_272{left:323px;bottom:703px;letter-spacing:0.3px;}
#tj_272{left:431px;bottom:702px;letter-spacing:0.11px;word-spacing:-0.14px;}
#tk_272{left:142px;bottom:683px;letter-spacing:0.12px;word-spacing:-0.4px;}
#tl_272{left:142px;bottom:663px;letter-spacing:0.12px;word-spacing:0.59px;}
#tm_272{left:142px;bottom:644px;letter-spacing:0.12px;word-spacing:1.99px;}
#tn_272{left:142px;bottom:624px;letter-spacing:0.11px;word-spacing:0.51px;}
#to_272{left:142px;bottom:605px;letter-spacing:0.12px;word-spacing:-0.04px;}
#tp_272{left:87px;bottom:570px;letter-spacing:-0.47px;}
#tq_272{left:142px;bottom:570px;letter-spacing:0.03px;word-spacing:0.02px;}
#tr_272{left:142px;bottom:545px;letter-spacing:0.13px;word-spacing:3.53px;}
#ts_272{left:285px;bottom:546px;letter-spacing:0.3px;}
#tt_272{left:397px;bottom:545px;letter-spacing:0.1px;word-spacing:3.57px;}
#tu_272{left:142px;bottom:525px;letter-spacing:0.11px;word-spacing:-0.04px;}
#tv_272{left:142px;bottom:506px;letter-spacing:0.12px;word-spacing:1.35px;}
#tw_272{left:142px;bottom:486px;letter-spacing:0.12px;word-spacing:-0.22px;}
#tx_272{left:676px;bottom:486px;letter-spacing:0.3px;}
#ty_272{left:142px;bottom:466px;letter-spacing:0.29px;}
#tz_272{left:203px;bottom:466px;letter-spacing:0.11px;word-spacing:-0.08px;}
#t10_272{left:142px;bottom:446px;letter-spacing:0.08px;word-spacing:0.01px;}
#t11_272{left:142px;bottom:376px;letter-spacing:0.13px;}
#t12_272{left:142px;bottom:361px;letter-spacing:0.14px;}
#t13_272{left:157px;bottom:333px;letter-spacing:0.13px;}
#t14_272{left:157px;bottom:318px;letter-spacing:0.13px;}
#t15_272{left:172px;bottom:303px;letter-spacing:0.13px;word-spacing:0.01px;}
#t16_272{left:186px;bottom:288px;letter-spacing:0.13px;}
#t17_272{left:201px;bottom:272px;letter-spacing:0.14px;word-spacing:-0.02px;}
#t18_272{left:201px;bottom:257px;letter-spacing:0.14px;}
#t19_272{left:230px;bottom:242px;letter-spacing:0.14px;}
#t1a_272{left:201px;bottom:226px;letter-spacing:0.14px;}
#t1b_272{left:230px;bottom:211px;letter-spacing:0.14px;}
#t1c_272{left:201px;bottom:196px;letter-spacing:0.14px;}
#t1d_272{left:186px;bottom:181px;letter-spacing:0.14px;}
#t1e_272{left:186px;bottom:165px;letter-spacing:0.13px;}
#t1f_272{left:172px;bottom:150px;letter-spacing:0.14px;}
#t1g_272{left:172px;bottom:123px;letter-spacing:0.14px;}
#t1h_272{left:172px;bottom:95px;letter-spacing:0.14px;}
#t1i_272{left:208px;bottom:80px;letter-spacing:0.14px;}
#t1j_272{left:157px;bottom:65px;}
#t1k_272{left:161px;bottom:404px;letter-spacing:-0.12px;word-spacing:0.02px;}
#t1l_272{left:257px;bottom:404px;letter-spacing:-0.12px;word-spacing:0.01px;}
#t1m_272{left:609px;bottom:296px;letter-spacing:-0.09px;word-spacing:-0.03px;}
#t1n_272{left:649px;bottom:296px;}
#t1o_272{left:654px;bottom:296px;letter-spacing:-0.08px;word-spacing:-0.04px;}
#t1p_272{left:609px;bottom:281px;letter-spacing:-0.09px;}
#t1q_272{left:628px;bottom:281px;}
#t1r_272{left:635px;bottom:281px;letter-spacing:-0.1px;word-spacing:-0.03px;}
#t1s_272{left:609px;bottom:267px;letter-spacing:-0.11px;}
#t1t_272{left:621px;bottom:267px;}
#t1u_272{left:628px;bottom:267px;letter-spacing:-0.07px;}
#t1v_272{left:647px;bottom:267px;}
#t1w_272{left:653px;bottom:267px;letter-spacing:-0.09px;}
#t1x_272{left:673px;bottom:267px;}
#t1y_272{left:680px;bottom:267px;}
#t1z_272{left:609px;bottom:252px;letter-spacing:-0.06px;}
#t20_272{left:639px;bottom:252px;}
#t21_272{left:649px;bottom:252px;letter-spacing:-0.09px;word-spacing:-0.03px;}
#t22_272{left:688px;bottom:252px;}
#t23_272{left:693px;bottom:252px;letter-spacing:-0.1px;}
#t24_272{left:609px;bottom:238px;letter-spacing:-0.08px;word-spacing:-0.06px;}
#t25_272{left:632px;bottom:238px;}
#t26_272{left:637px;bottom:238px;letter-spacing:-0.13px;}
#t27_272{left:656px;bottom:238px;}
#t28_272{left:662px;bottom:238px;letter-spacing:-0.1px;}
#t29_272{left:682px;bottom:238px;}
#t2a_272{left:687px;bottom:238px;letter-spacing:-0.09px;}
#t2b_272{left:708px;bottom:238px;}
#t2c_272{left:609px;bottom:223px;letter-spacing:-0.11px;word-spacing:-0.03px;}
#t2d_272{left:667px;bottom:223px;}
#t2e_272{left:672px;bottom:223px;letter-spacing:-0.1px;word-spacing:0.02px;}
#t2f_272{left:609px;bottom:209px;letter-spacing:-0.1px;word-spacing:-0.04px;}
#t2g_272{left:681px;bottom:209px;}
#t2h_272{left:686px;bottom:209px;letter-spacing:-0.08px;}
#t2i_272{left:699px;bottom:209px;}
#t2j_272{left:706px;bottom:209px;}
#t2k_272{left:609px;bottom:194px;}
#t2l_272{left:615px;bottom:194px;}
#t2m_272{left:622px;bottom:194px;}
#t2n_272{left:632px;bottom:194px;}
#t2o_272{left:642px;bottom:194px;letter-spacing:-0.12px;}

.s1_272{font-size:14px;font-family:NewBaskerville-Bold_w3;color:#252525;}
.s2_272{font-size:12px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s3_272{font-size:10px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s4_272{font-size:14px;font-family:NewBaskerville-BoldItalic_zn;color:#656565;}
.s5_272{font-size:15px;font-family:NewBaskerville-Roman_xo;color:#252525;}
.s6_272{font-size:14px;font-family:Courier_166;color:#252525;}
.s7_272{font-size:16px;font-family:FranklinGothic-DemiItal_15g;color:#476B85;}
.s8_272{font-size:12px;font-family:Courier_166;color:#252525;}
.s9_272{font-size:14px;font-family:FranklinGothic-Demi_yq;color:#FFF;}
.sa_272{font-size:14px;font-family:Humanist521BT-BoldCondensed_wh;color:#656565;}
.sb_272{font-size:14px;font-family:Humanist521BT-BoldCondensed_1b1;color:#656565;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts272" type="text/css" >

@font-face {
	font-family: Courier_166;
	src: url("fonts/Courier_166.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-DemiItal_15g;
	src: url("fonts/FranklinGothic-DemiItal_15g.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_yq;
	src: url("fonts/FranklinGothic-Demi_yq.woff") format("woff");
}

@font-face {
	font-family: Humanist521BT-BoldCondensed_1b1;
	src: url("fonts/Humanist521BT-BoldCondensed_1b1.woff") format("woff");
}

@font-face {
	font-family: Humanist521BT-BoldCondensed_wh;
	src: url("fonts/Humanist521BT-BoldCondensed_wh.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_zn;
	src: url("fonts/NewBaskerville-BoldItalic_zn.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_w3;
	src: url("fonts/NewBaskerville-Bold_w3.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_xo;
	src: url("fonts/NewBaskerville-Roman_xo.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg272Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg272" style="-webkit-user-select: none;"><object width="811" height="1017" data="272/272.svg" type="image/svg+xml" id="pdf272" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_272" class="t s1_272">242 </span><span id="t2_272" class="t s2_272">C</span><span id="t3_272" class="t s3_272">HAPTER </span><span id="t4_272" class="t s2_272">10 </span><span id="t5_272" class="t s4_272">Applying CSRF protection and CORS </span>
<span id="t6_272" class="t s5_272">cise caution with this approach. It’s always better to filter the origins and headers that </span>
<span id="t7_272" class="t s5_272">you want to allow and never allow any domain to implement code that accesses your </span>
<span id="t8_272" class="t s5_272">applications’ resources. </span>
<span id="t9_272" class="t s5_272">By allowing all origins, you expose the application to cross-site scripting (XSS) </span>
<span id="ta_272" class="t s5_272">requests, which eventually can lead to DDoS attacks, as we discussed in chapter 1. I </span>
<span id="tb_272" class="t s5_272">personally avoid allowing all origins even in test environments. I know that applica- </span>
<span id="tc_272" class="t s5_272">tions sometimes happen to run on wrongly defined infrastructures that use the same </span>
<span id="td_272" class="t s5_272">data centers for both test and production. It is wiser to treat all layers on which secu- </span>
<span id="te_272" class="t s5_272">rity applies independently, as we discussed in chapter 1, and to avoid assuming that </span>
<span id="tf_272" class="t s5_272">the application doesn’t have particular vulnerabilities because the infrastructure </span>
<span id="tg_272" class="t s5_272">doesn’t allow it. </span>
<span id="th_272" class="t s5_272">The advantage of using </span><span id="ti_272" class="t s6_272">@CrossOrigin </span><span id="tj_272" class="t s5_272">to specify the rules directly where the end- </span>
<span id="tk_272" class="t s5_272">points are defined is that it creates good transparency of the rules. The disadvantage is </span>
<span id="tl_272" class="t s5_272">that it might become verbose, forcing you to repeat a lot of code. It also imposes the </span>
<span id="tm_272" class="t s5_272">risk that the developer might forget to add the annotation for newly implemented </span>
<span id="tn_272" class="t s5_272">endpoints. In section 10.2.3, we discuss applying the CORS configuration centralized </span>
<span id="to_272" class="t s5_272">within the configuration class. </span>
<span id="tp_272" class="t s7_272">10.2.3 </span><span id="tq_272" class="t s7_272">Applying CORS using a CorsConfigurer </span>
<span id="tr_272" class="t s5_272">Although using the </span><span id="ts_272" class="t s6_272">@CrossOrigin </span><span id="tt_272" class="t s5_272">annotation is easy, as you learned in section </span>
<span id="tu_272" class="t s5_272">10.2.2, you might find it more comfortable in a lot of cases to define CORS configura- </span>
<span id="tv_272" class="t s5_272">tion in one place. In this section, we change the example we worked on in sections </span>
<span id="tw_272" class="t s5_272">10.2.1 and 10.2.2 to apply CORS configuration in the configuration class using a </span><span id="tx_272" class="t s6_272">Cus- </span>
<span id="ty_272" class="t s6_272">tomizer</span><span id="tz_272" class="t s5_272">. In the next listing, you can find the changes we need to make in the config- </span>
<span id="t10_272" class="t s5_272">uration class to define the origins we want to allow. </span>
<span id="t11_272" class="t s8_272">@Configuration </span>
<span id="t12_272" class="t s8_272">public class ProjectConfig extends WebSecurityConfigurerAdapter { </span>
<span id="t13_272" class="t s8_272">@Override </span>
<span id="t14_272" class="t s8_272">protected void configure(HttpSecurity http) throws Exception { </span>
<span id="t15_272" class="t s8_272">http.cors(c -&gt; { </span>
<span id="t16_272" class="t s8_272">CorsConfigurationSource source = request -&gt; { </span>
<span id="t17_272" class="t s8_272">CorsConfiguration config = new CorsConfiguration(); </span>
<span id="t18_272" class="t s8_272">config.setAllowedOrigins( </span>
<span id="t19_272" class="t s8_272">List.of("example.com", "example.org")); </span>
<span id="t1a_272" class="t s8_272">config.setAllowedMethods( </span>
<span id="t1b_272" class="t s8_272">List.of("GET", "POST", "PUT", "DELETE")); </span>
<span id="t1c_272" class="t s8_272">return config; </span>
<span id="t1d_272" class="t s8_272">}; </span>
<span id="t1e_272" class="t s8_272">c.configurationSource(source); </span>
<span id="t1f_272" class="t s8_272">}); </span>
<span id="t1g_272" class="t s8_272">http.csrf().disable(); </span>
<span id="t1h_272" class="t s8_272">http.authorizeRequests() </span>
<span id="t1i_272" class="t s8_272">.anyRequest().permitAll(); </span>
<span id="t1j_272" class="t s8_272">} </span>
<span id="t1k_272" class="t s9_272">Listing 10.23 </span><span id="t1l_272" class="t s9_272">Defining CORS configurations centralized in the configuration class </span>
<span id="t1m_272" class="t sa_272">Calls co</span><span id="t1n_272" class="t sb_272">r</span><span id="t1o_272" class="t sa_272">s() to </span>
<span id="t1p_272" class="t sa_272">defi</span><span id="t1q_272" class="t sb_272">n</span><span id="t1r_272" class="t sa_272">e the CORS </span>
<span id="t1s_272" class="t sa_272">co</span><span id="t1t_272" class="t sb_272">n</span><span id="t1u_272" class="t sa_272">figu</span><span id="t1v_272" class="t sb_272">r</span><span id="t1w_272" class="t sa_272">atio</span><span id="t1x_272" class="t sb_272">n</span><span id="t1y_272" class="t sa_272">. </span>
<span id="t1z_272" class="t sa_272">Withi</span><span id="t20_272" class="t sb_272">n </span><span id="t21_272" class="t sa_272">it, we c</span><span id="t22_272" class="t sb_272">r</span><span id="t23_272" class="t sa_272">eate </span>
<span id="t24_272" class="t sa_272">a Co</span><span id="t25_272" class="t sb_272">r</span><span id="t26_272" class="t sa_272">sCo</span><span id="t27_272" class="t sb_272">n</span><span id="t28_272" class="t sa_272">figu</span><span id="t29_272" class="t sb_272">r</span><span id="t2a_272" class="t sa_272">atio</span><span id="t2b_272" class="t sb_272">n </span>
<span id="t2c_272" class="t sa_272">object whe</span><span id="t2d_272" class="t sb_272">r</span><span id="t2e_272" class="t sa_272">e we set </span>
<span id="t2f_272" class="t sa_272">the allowed o</span><span id="t2g_272" class="t sb_272">r</span><span id="t2h_272" class="t sa_272">igi</span><span id="t2i_272" class="t sb_272">n</span><span id="t2j_272" class="t sa_272">s </span>
<span id="t2k_272" class="t sa_272">a</span><span id="t2l_272" class="t sb_272">n</span><span id="t2m_272" class="t sa_272">d </span><span id="t2n_272" class="t sb_272">m</span><span id="t2o_272" class="t sa_272">ethods. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
