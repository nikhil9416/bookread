<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p378" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_378{left:87px;bottom:960px;letter-spacing:-0.13px;}
#t2_378{left:245px;bottom:961px;}
#t3_378{left:253px;bottom:962px;letter-spacing:-0.14px;}
#t4_378{left:293px;bottom:961px;letter-spacing:0.13px;}
#t5_378{left:320px;bottom:960px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t6_378{left:161px;bottom:919px;letter-spacing:-0.03px;}
#t7_378{left:208px;bottom:917px;letter-spacing:0.14px;word-spacing:4.93px;}
#t8_378{left:161px;bottom:899px;letter-spacing:0.11px;word-spacing:0.03px;}
#t9_378{left:161px;bottom:880px;letter-spacing:0.11px;word-spacing:3.15px;}
#ta_378{left:161px;bottom:862px;letter-spacing:0.13px;word-spacing:1.23px;}
#tb_378{left:161px;bottom:843px;letter-spacing:0.12px;word-spacing:0.01px;}
#tc_378{left:142px;bottom:806px;letter-spacing:0.09px;word-spacing:-0.54px;}
#td_378{left:142px;bottom:786px;letter-spacing:0.11px;word-spacing:0.79px;}
#te_378{left:359px;bottom:786px;letter-spacing:0.3px;}
#tf_378{left:459px;bottom:786px;letter-spacing:0.1px;word-spacing:0.8px;}
#tg_378{left:142px;bottom:766px;letter-spacing:0.11px;word-spacing:-0.04px;}
#th_378{left:165px;bottom:745px;letter-spacing:0.12px;word-spacing:0.55px;}
#ti_378{left:142px;bottom:725px;letter-spacing:0.09px;word-spacing:0.07px;}
#tj_378{left:447px;bottom:726px;letter-spacing:0.3px;}
#tk_378{left:564px;bottom:725px;letter-spacing:0.12px;word-spacing:0.02px;}
#tl_378{left:142px;bottom:705px;letter-spacing:0.11px;word-spacing:0.11px;}
#tm_378{left:451px;bottom:705px;letter-spacing:0.04px;}
#tn_378{left:486px;bottom:705px;letter-spacing:0.11px;word-spacing:0.13px;}
#to_378{left:142px;bottom:685px;letter-spacing:0.12px;word-spacing:0.01px;}
#tp_378{left:142px;bottom:653px;letter-spacing:0.14px;word-spacing:-0.02px;}
#tq_378{left:179px;bottom:638px;letter-spacing:0.14px;}
#tr_378{left:227px;bottom:638px;}
#ts_378{left:232px;bottom:638px;letter-spacing:0.14px;}
#tt_378{left:142px;bottom:601px;letter-spacing:0.13px;word-spacing:-0.01px;}
#tu_378{left:142px;bottom:572px;letter-spacing:0.14px;}
#tv_378{left:142px;bottom:535px;letter-spacing:0.13px;word-spacing:2.44px;}
#tw_378{left:142px;bottom:515px;letter-spacing:0.13px;word-spacing:1.48px;}
#tx_378{left:142px;bottom:495px;letter-spacing:0.12px;word-spacing:0.03px;}
#ty_378{left:142px;bottom:466px;letter-spacing:0.14px;word-spacing:-0.05px;}
#tz_378{left:249px;bottom:466px;}
#t10_378{left:254px;bottom:466px;letter-spacing:0.14px;}
#t11_378{left:142px;bottom:430px;letter-spacing:0.12px;}
#t12_378{left:142px;bottom:401px;letter-spacing:0.14px;}
#t13_378{left:142px;bottom:386px;letter-spacing:0.13px;word-spacing:0.01px;}
#t14_378{left:142px;bottom:370px;letter-spacing:0.14px;}
#t15_378{left:142px;bottom:355px;}
#t16_378{left:157px;bottom:340px;letter-spacing:0.14px;}
#t17_378{left:157px;bottom:324px;letter-spacing:0.13px;}
#t18_378{left:172px;bottom:309px;letter-spacing:0.13px;word-spacing:0.01px;}
#t19_378{left:142px;bottom:294px;}
#t1a_378{left:161px;bottom:233px;letter-spacing:0.02px;}
#t1b_378{left:161px;bottom:213px;letter-spacing:0.23px;word-spacing:-0.09px;}
#t1c_378{left:161px;bottom:195px;letter-spacing:0.23px;word-spacing:1.13px;}
#t1d_378{left:161px;bottom:178px;letter-spacing:0.22px;word-spacing:0.2px;}
#t1e_378{left:161px;bottom:161px;letter-spacing:0.2px;word-spacing:-0.72px;}
#t1f_378{left:161px;bottom:144px;letter-spacing:0.23px;word-spacing:-0.21px;}
#t1g_378{left:161px;bottom:127px;letter-spacing:0.22px;word-spacing:0.12px;}
#t1h_378{left:161px;bottom:110px;letter-spacing:0.22px;word-spacing:-0.64px;}
#t1i_378{left:161px;bottom:93px;letter-spacing:0.22px;word-spacing:-0.03px;}

.s1_378{font-size:14px;font-family:NewBaskerville-Bold_w3;color:#252525;}
.s2_378{font-size:12px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s3_378{font-size:10px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s4_378{font-size:14px;font-family:NewBaskerville-BoldItalic_zn;color:#656565;}
.s5_378{font-size:13px;font-family:FranklinGothic-Demi_yq;color:#476B85;}
.s6_378{font-size:15px;font-family:NewBaskerville-Roman_xo;color:#252525;}
.s7_378{font-size:14px;font-family:Courier_166;color:#252525;}
.s8_378{font-size:15px;font-family:NewBaskerville-Italic_vq;color:#252525;}
.s9_378{font-size:12px;font-family:Courier_166;color:#252525;}
.sa_378{font-size:12px;font-family:Courier_166;color:#FFF;}
.sb_378{font-size:16px;font-family:FranklinGothic-Demi_yq;color:#476B85;}
.sc_378{font-size:14px;font-family:FranklinGothic-Book_16l;color:#252525;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts378" type="text/css" >

@font-face {
	font-family: Courier_166;
	src: url("fonts/Courier_166.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Book_16l;
	src: url("fonts/FranklinGothic-Book_16l.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_yq;
	src: url("fonts/FranklinGothic-Demi_yq.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_zn;
	src: url("fonts/NewBaskerville-BoldItalic_zn.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_w3;
	src: url("fonts/NewBaskerville-Bold_w3.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Italic_vq;
	src: url("fonts/NewBaskerville-Italic_vq.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_xo;
	src: url("fonts/NewBaskerville-Roman_xo.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg378Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg378" style="-webkit-user-select: none;"><object width="811" height="1017" data="378/378.svg" type="image/svg+xml" id="pdf378" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_378" class="t s1_378">348 </span><span id="t2_378" class="t s2_378">C</span><span id="t3_378" class="t s3_378">HAPTER </span><span id="t4_378" class="t s2_378">14 </span><span id="t5_378" class="t s4_378">OAuth 2: Implementing the resource server </span>
<span id="t6_378" class="t s5_378">NOTE </span><span id="t7_378" class="t s6_378">When we use authentication for the /oauth/check_token (token </span>
<span id="t8_378" class="t s6_378">introspection) endpoint, the resource server acts as a client for the authoriza- </span>
<span id="t9_378" class="t s6_378">tion server. For this reason, it needs to have some credentials registered, </span>
<span id="ta_378" class="t s6_378">which it uses to authenticate using HTTP Basic authentication when calling </span>
<span id="tb_378" class="t s6_378">the introspection endpoint. </span>
<span id="tc_378" class="t s6_378">By the way, if you plan to run both applications on the same system as I do, don’t forget </span>
<span id="td_378" class="t s6_378">to set a different port using the </span><span id="te_378" class="t s7_378">server.port </span><span id="tf_378" class="t s6_378">property. I use port 8080 (the default </span>
<span id="tg_378" class="t s6_378">one) for running the authorization server and port 9090 for the resource server. </span>
<span id="th_378" class="t s6_378">You can run both applications and test the whole setup by calling the /hello end- </span>
<span id="ti_378" class="t s6_378">point. You need to set the access token in the </span><span id="tj_378" class="t s7_378">Authorization </span><span id="tk_378" class="t s6_378">header of the request, </span>
<span id="tl_378" class="t s6_378">and you need to prefix its value with the word </span><span id="tm_378" class="t s8_378">bearer</span><span id="tn_378" class="t s6_378">. For this word, the case is insensi- </span>
<span id="to_378" class="t s6_378">tive. That means that you can also write “Bearer” or “BEARER.” </span>
<span id="tp_378" class="t s9_378">curl -H "Authorization: bearer 4f2b7a6d-ced2-43dc-86d7-cbe844d3e16b" </span>
<span id="tq_378" class="t s9_378">"http:/ </span><span id="tr_378" class="t sa_378">. </span><span id="ts_378" class="t s9_378">/localhost:9090/hello" </span>
<span id="tt_378" class="t s6_378">The response body is </span>
<span id="tu_378" class="t s9_378">Hello! </span>
<span id="tv_378" class="t s6_378">If you had called the endpoint without a token or with the wrong one, the result </span>
<span id="tw_378" class="t s6_378">would have been a 401 Unauthorized status on the HTTP response. The next code </span>
<span id="tx_378" class="t s6_378">snippet presents the response: </span>
<span id="ty_378" class="t s9_378">curl -v "http:/ </span><span id="tz_378" class="t sa_378">. </span><span id="t10_378" class="t s9_378">/localhost:9090/hello" </span>
<span id="t11_378" class="t s6_378">The (truncated) response is </span>
<span id="t12_378" class="t s9_378">... </span>
<span id="t13_378" class="t s9_378">&lt; HTTP/1.1 401 </span>
<span id="t14_378" class="t s9_378">... </span>
<span id="t15_378" class="t s9_378">{ </span>
<span id="t16_378" class="t s9_378">"error":"unauthorized", </span>
<span id="t17_378" class="t s9_378">"error_description":"Full authentication is </span>
<span id="t18_378" class="t s9_378">required to access this resource" </span>
<span id="t19_378" class="t s9_378">} </span>
<span id="t1a_378" class="t sb_378">Using token introspection without Spring Security OAuth </span>
<span id="t1b_378" class="t sc_378">A common concern nowadays is how to implement a resource server as in the previ- </span>
<span id="t1c_378" class="t sc_378">ous example without Spring Security OAuth. Although it’s said that Spring Security </span>
<span id="t1d_378" class="t sc_378">OAuth is deprecated, in my opinion you should still understand it because there’s a </span>
<span id="t1e_378" class="t sc_378">good chance you’ll find these classes in existing projects. To clarify this aspect, I add </span>
<span id="t1f_378" class="t sc_378">a comparison where relevant with a way to implement the same thing without Spring </span>
<span id="t1g_378" class="t sc_378">Security OAuth. In this sidebar, we discuss the implementation of a resource server </span>
<span id="t1h_378" class="t sc_378">using token introspection without using Spring Security OAuth but directly with Spring </span>
<span id="t1i_378" class="t sc_378">Security configurations. Fortunately, it’s easier than you might imagine. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
