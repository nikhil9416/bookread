<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p386" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_386{left:87px;bottom:960px;letter-spacing:-0.13px;}
#t2_386{left:245px;bottom:961px;}
#t3_386{left:253px;bottom:962px;letter-spacing:-0.14px;}
#t4_386{left:293px;bottom:961px;letter-spacing:0.13px;}
#t5_386{left:320px;bottom:960px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t6_386{left:142px;bottom:917px;letter-spacing:0.1px;word-spacing:1.71px;}
#t7_386{left:142px;bottom:898px;letter-spacing:0.1px;word-spacing:-0.11px;}
#t8_386{left:142px;bottom:878px;letter-spacing:0.09px;word-spacing:-0.18px;}
#t9_386{left:142px;bottom:859px;letter-spacing:0.13px;word-spacing:-0.01px;}
#ta_386{left:142px;bottom:830px;letter-spacing:0.14px;word-spacing:-0.01px;}
#tb_386{left:179px;bottom:815px;letter-spacing:0.14px;}
#tc_386{left:142px;bottom:781px;letter-spacing:0.13px;word-spacing:-0.01px;}
#td_386{left:142px;bottom:753px;}
#te_386{left:157px;bottom:737px;letter-spacing:0.14px;}
#tf_386{left:157px;bottom:722px;letter-spacing:0.14px;}
#tg_386{left:157px;bottom:707px;letter-spacing:0.14px;}
#th_386{left:157px;bottom:691px;letter-spacing:0.13px;}
#ti_386{left:157px;bottom:676px;letter-spacing:0.13px;}
#tj_386{left:142px;bottom:661px;}
#tk_386{left:142px;bottom:627px;letter-spacing:0.14px;word-spacing:3px;}
#tl_386{left:142px;bottom:607px;letter-spacing:0.11px;word-spacing:-0.48px;}
#tm_386{left:142px;bottom:587px;letter-spacing:0.13px;word-spacing:3.54px;}
#tn_386{left:142px;bottom:566px;letter-spacing:0.12px;word-spacing:1px;}
#to_386{left:142px;bottom:546px;letter-spacing:0.12px;word-spacing:-1.06px;}
#tp_386{left:166px;bottom:526px;letter-spacing:0.11px;word-spacing:1.39px;}
#tq_386{left:142px;bottom:506px;letter-spacing:0.12px;word-spacing:1.71px;}
#tr_386{left:142px;bottom:486px;letter-spacing:0.11px;word-spacing:1.04px;}
#ts_386{left:142px;bottom:466px;letter-spacing:0.14px;word-spacing:2.75px;}
#tt_386{left:142px;bottom:445px;letter-spacing:0.12px;word-spacing:0.68px;}
#tu_386{left:537px;bottom:446px;letter-spacing:0.29px;}
#tv_386{left:142px;bottom:426px;letter-spacing:0.3px;}
#tw_386{left:182px;bottom:425px;letter-spacing:0.11px;word-spacing:0.8px;}
#tx_386{left:142px;bottom:405px;letter-spacing:0.11px;word-spacing:0.04px;}
#ty_386{left:142px;bottom:373px;letter-spacing:0.13px;}
#tz_386{left:157px;bottom:358px;letter-spacing:0.14px;}
#t10_386{left:157px;bottom:342px;letter-spacing:0.14px;}
#t11_386{left:142px;bottom:327px;letter-spacing:0.13px;}
#t12_386{left:142px;bottom:312px;letter-spacing:0.13px;}
#t13_386{left:157px;bottom:297px;letter-spacing:0.14px;}
#t14_386{left:157px;bottom:281px;letter-spacing:0.14px;}
#t15_386{left:142px;bottom:266px;letter-spacing:0.13px;}
#t16_386{left:142px;bottom:251px;letter-spacing:0.13px;}
#t17_386{left:157px;bottom:235px;letter-spacing:0.14px;}
#t18_386{left:157px;bottom:220px;letter-spacing:0.14px;}
#t19_386{left:142px;bottom:205px;letter-spacing:0.13px;}
#t1a_386{left:142px;bottom:190px;letter-spacing:0.13px;}
#t1b_386{left:157px;bottom:174px;letter-spacing:0.14px;}
#t1c_386{left:157px;bottom:159px;letter-spacing:0.14px;}
#t1d_386{left:142px;bottom:144px;letter-spacing:0.13px;}
#t1e_386{left:142px;bottom:129px;letter-spacing:0.13px;}
#t1f_386{left:157px;bottom:113px;letter-spacing:0.14px;}
#t1g_386{left:157px;bottom:98px;letter-spacing:0.14px;}
#t1h_386{left:142px;bottom:83px;letter-spacing:0.13px;}

.s1_386{font-size:14px;font-family:NewBaskerville-Bold_w3;color:#252525;}
.s2_386{font-size:12px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s3_386{font-size:10px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s4_386{font-size:14px;font-family:NewBaskerville-BoldItalic_zn;color:#656565;}
.s5_386{font-size:15px;font-family:NewBaskerville-Roman_xo;color:#252525;}
.s6_386{font-size:12px;font-family:Courier_166;color:#252525;}
.s7_386{font-size:14px;font-family:Courier_166;color:#252525;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts386" type="text/css" >

@font-face {
	font-family: Courier_166;
	src: url("fonts/Courier_166.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_yq;
	src: url("fonts/FranklinGothic-Demi_yq.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_zn;
	src: url("fonts/NewBaskerville-BoldItalic_zn.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_w3;
	src: url("fonts/NewBaskerville-Bold_w3.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_xo;
	src: url("fonts/NewBaskerville-Roman_xo.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg386Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg386" style="-webkit-user-select: none;"><object width="811" height="1017" data="386/386.svg" type="image/svg+xml" id="pdf386" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_386" class="t s1_386">356 </span><span id="t2_386" class="t s2_386">C</span><span id="t3_386" class="t s3_386">HAPTER </span><span id="t4_386" class="t s2_386">14 </span><span id="t5_386" class="t s4_386">OAuth 2: Implementing the resource server </span>
<span id="t6_386" class="t s5_386">We can now start our authorization server and issue tokens. We issue tokens in the </span>
<span id="t7_386" class="t s5_386">same way we did in chapter 13 and earlier in this chapter. From this perspective, noth- </span>
<span id="t8_386" class="t s5_386">ing’s changed. But now, we can see our tokens stored in the database as well. The next </span>
<span id="t9_386" class="t s5_386">code snippet shows the cURL command you use to issue a token: </span>
<span id="ta_386" class="t s6_386">curl -v -XPOST -u client:secret "http://localhost:8080/oauth/ </span>
<span id="tb_386" class="t s6_386">token?grant_type=password&amp;username=john&amp;password=12345&amp;scope=read" </span>
<span id="tc_386" class="t s5_386">The response body is </span>
<span id="td_386" class="t s6_386">{ </span>
<span id="te_386" class="t s6_386">"access_token":"009549ee-fd3e-40b0-a56c-6d28836c4384", </span>
<span id="tf_386" class="t s6_386">"token_type":"bearer", </span>
<span id="tg_386" class="t s6_386">"refresh_token":"fd44d772-18b3-4668-9981-86373017e12d", </span>
<span id="th_386" class="t s6_386">"expires_in":43199, </span>
<span id="ti_386" class="t s6_386">"scope":"read" </span>
<span id="tj_386" class="t s6_386">} </span>
<span id="tk_386" class="t s5_386">The access token returned in the response can also be found as a record in the </span>
<span id="tl_386" class="t s5_386">oauth_access_token table. Because I configure the refresh token grant type, I receive a </span>
<span id="tm_386" class="t s5_386">refresh token. For this reason, I also find a record for the refresh token in the </span>
<span id="tn_386" class="t s5_386">oauth_refresh_token table. Because the database persists tokens, the resource server </span>
<span id="to_386" class="t s5_386">can validate the issued tokens even if the authorization server is down or after its restart. </span>
<span id="tp_386" class="t s5_386">It’s time now to configure the resource server so that it also uses the same data- </span>
<span id="tq_386" class="t s5_386">base. For this purpose, I work in the project ssia-ch14-ex2-rs. I start with the imple- </span>
<span id="tr_386" class="t s5_386">mentation we worked on in section 14.1. As for the authorization server, we need to </span>
<span id="ts_386" class="t s5_386">add the necessary dependencies in the pom.xml file. Because the resource server </span>
<span id="tt_386" class="t s5_386">needs to connect to the database, we also need to add the </span><span id="tu_386" class="t s7_386">spring-boot-starter- </span>
<span id="tv_386" class="t s7_386">jdbc </span><span id="tw_386" class="t s5_386">dependency and the JDBC driver. The next code snippet shows the dependen- </span>
<span id="tx_386" class="t s5_386">cies in the pom.xml file: </span>
<span id="ty_386" class="t s6_386">&lt;dependency&gt; </span>
<span id="tz_386" class="t s6_386">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; </span>
<span id="t10_386" class="t s6_386">&lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt; </span>
<span id="t11_386" class="t s6_386">&lt;/dependency&gt; </span>
<span id="t12_386" class="t s6_386">&lt;dependency&gt; </span>
<span id="t13_386" class="t s6_386">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; </span>
<span id="t14_386" class="t s6_386">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; </span>
<span id="t15_386" class="t s6_386">&lt;/dependency&gt; </span>
<span id="t16_386" class="t s6_386">&lt;dependency&gt; </span>
<span id="t17_386" class="t s6_386">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; </span>
<span id="t18_386" class="t s6_386">&lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt; </span>
<span id="t19_386" class="t s6_386">&lt;/dependency&gt; </span>
<span id="t1a_386" class="t s6_386">&lt;dependency&gt; </span>
<span id="t1b_386" class="t s6_386">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; </span>
<span id="t1c_386" class="t s6_386">&lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; </span>
<span id="t1d_386" class="t s6_386">&lt;/dependency&gt; </span>
<span id="t1e_386" class="t s6_386">&lt;dependency&gt; </span>
<span id="t1f_386" class="t s6_386">&lt;groupId&gt;mysql&lt;/groupId&gt; </span>
<span id="t1g_386" class="t s6_386">&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; </span>
<span id="t1h_386" class="t s6_386">&lt;/dependency&gt; </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
