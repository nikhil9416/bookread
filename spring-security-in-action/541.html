<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p541" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_541{left:703px;bottom:960px;letter-spacing:-0.13px;}
#t2_541{left:334px;bottom:960px;letter-spacing:-0.11px;word-spacing:-0.04px;}
#t3_541{left:101px;bottom:913px;letter-spacing:-0.53px;}
#t4_541{left:156px;bottom:913px;letter-spacing:-0.03px;word-spacing:0.07px;}
#t5_541{left:156px;bottom:892px;letter-spacing:0.12px;word-spacing:2.62px;}
#t6_541{left:156px;bottom:871px;letter-spacing:0.1px;word-spacing:0.09px;}
#t7_541{left:156px;bottom:851px;letter-spacing:0.11px;word-spacing:0.37px;}
#t8_541{left:156px;bottom:831px;letter-spacing:0.09px;word-spacing:3.69px;}
#t9_541{left:156px;bottom:811px;letter-spacing:0.09px;word-spacing:0.34px;}
#ta_541{left:156px;bottom:791px;letter-spacing:0.12px;word-spacing:1.65px;}
#tb_541{left:156px;bottom:771px;letter-spacing:0.13px;word-spacing:3.51px;}
#tc_541{left:156px;bottom:750px;letter-spacing:0.11px;word-spacing:1.16px;}
#td_541{left:156px;bottom:730px;letter-spacing:0.12px;word-spacing:2.34px;}
#te_541{left:458px;bottom:731px;letter-spacing:0.3px;}
#tf_541{left:699px;bottom:730px;letter-spacing:0.11px;}
#tg_541{left:156px;bottom:710px;letter-spacing:0.29px;}
#th_541{left:400px;bottom:710px;letter-spacing:0.09px;word-spacing:0.89px;}
#ti_541{left:156px;bottom:690px;letter-spacing:0.11px;}
#tj_541{left:180px;bottom:670px;letter-spacing:0.13px;word-spacing:1.51px;}
#tk_541{left:156px;bottom:650px;letter-spacing:0.12px;word-spacing:-0.22px;}
#tl_541{left:156px;bottom:629px;letter-spacing:0.11px;word-spacing:1.09px;}
#tm_541{left:156px;bottom:609px;letter-spacing:0.1px;word-spacing:0.12px;}
#tn_541{left:156px;bottom:589px;letter-spacing:0.12px;word-spacing:0.01px;}
#to_541{left:156px;bottom:569px;letter-spacing:0.11px;word-spacing:0.92px;}
#tp_541{left:156px;bottom:549px;letter-spacing:0.11px;word-spacing:-0.04px;}
#tq_541{left:156px;bottom:479px;letter-spacing:0.13px;}
#tr_541{left:156px;bottom:463px;letter-spacing:0.14px;}
#ts_541{left:156px;bottom:447px;letter-spacing:0.14px;}
#tt_541{left:171px;bottom:416px;letter-spacing:0.13px;}
#tu_541{left:171px;bottom:401px;letter-spacing:0.13px;word-spacing:0.01px;}
#tv_541{left:171px;bottom:369px;letter-spacing:0.14px;}
#tw_541{left:171px;bottom:354px;letter-spacing:0.14px;word-spacing:-0.01px;}
#tx_541{left:185px;bottom:338px;letter-spacing:0.13px;}
#ty_541{left:244px;bottom:323px;letter-spacing:0.14px;}
#tz_541{left:244px;bottom:307px;letter-spacing:0.14px;}
#t10_541{left:200px;bottom:292px;}
#t11_541{left:200px;bottom:276px;letter-spacing:0.13px;}
#t12_541{left:200px;bottom:260px;letter-spacing:0.14px;}
#t13_541{left:200px;bottom:245px;letter-spacing:0.13px;}
#t14_541{left:200px;bottom:229px;letter-spacing:0.14px;}
#t15_541{left:200px;bottom:214px;letter-spacing:0.13px;}
#t16_541{left:171px;bottom:198px;}
#t17_541{left:156px;bottom:167px;}
#t18_541{left:174px;bottom:507px;letter-spacing:-0.12px;word-spacing:0.02px;}
#t19_541{left:271px;bottom:507px;letter-spacing:-0.12px;word-spacing:-0.02px;}
#t1a_541{left:524px;bottom:408px;letter-spacing:-0.68px;}
#t1b_541{left:537px;bottom:408px;}
#t1c_541{left:542px;bottom:408px;letter-spacing:-0.05px;}
#t1d_541{left:553px;bottom:408px;letter-spacing:-0.1px;}
#t1e_541{left:568px;bottom:408px;letter-spacing:-0.12px;word-spacing:-0.01px;}
#t1f_541{left:583px;bottom:408px;}
#t1g_541{left:593px;bottom:408px;letter-spacing:-0.11px;word-spacing:-0.03px;}
#t1h_541{left:675px;bottom:408px;}
#t1i_541{left:680px;bottom:408px;letter-spacing:-0.12px;}
#t1j_541{left:548px;bottom:394px;}
#t1k_541{left:555px;bottom:394px;}
#t1l_541{left:565px;bottom:394px;letter-spacing:-0.1px;word-spacing:-0.03px;}
#t1m_541{left:592px;bottom:394px;}
#t1n_541{left:599px;bottom:394px;letter-spacing:-0.13px;}
#t1o_541{left:623px;bottom:394px;}
#t1p_541{left:630px;bottom:394px;}
#t1q_541{left:638px;bottom:394px;}
#t1r_541{left:643px;bottom:394px;letter-spacing:-0.1px;}
#t1s_541{left:682px;bottom:394px;}
#t1t_541{left:689px;bottom:394px;letter-spacing:-0.11px;word-spacing:-0.02px;}
#t1u_541{left:571px;bottom:379px;letter-spacing:-0.09px;word-spacing:-0.04px;}
#t1v_541{left:612px;bottom:379px;}
#t1w_541{left:621px;bottom:379px;letter-spacing:-0.12px;word-spacing:0.02px;}
#t1x_541{left:705px;bottom:379px;}
#t1y_541{left:711px;bottom:379px;}
#t1z_541{left:572px;bottom:197px;letter-spacing:-0.14px;word-spacing:0.07px;}
#t20_541{left:691px;bottom:197px;}
#t21_541{left:700px;bottom:197px;letter-spacing:-0.15px;}
#t22_541{left:584px;bottom:183px;letter-spacing:-0.13px;}
#t23_541{left:616px;bottom:183px;}
#t24_541{left:621px;bottom:183px;letter-spacing:-0.1px;word-spacing:-0.03px;}
#t25_541{left:653px;bottom:183px;}
#t26_541{left:659px;bottom:183px;letter-spacing:-0.01px;}
#t27_541{left:669px;bottom:183px;}
#t28_541{left:676px;bottom:183px;letter-spacing:-0.12px;word-spacing:-0.02px;}
#t29_541{left:537px;bottom:168px;letter-spacing:-0.11px;}
#t2a_541{left:549px;bottom:168px;}
#t2b_541{left:556px;bottom:168px;letter-spacing:-0.1px;}
#t2c_541{left:576px;bottom:168px;}
#t2d_541{left:581px;bottom:168px;letter-spacing:-0.09px;}
#t2e_541{left:601px;bottom:168px;}
#t2f_541{left:612px;bottom:168px;letter-spacing:-0.1px;}
#t2g_541{left:630px;bottom:168px;}
#t2h_541{left:640px;bottom:168px;letter-spacing:-0.11px;word-spacing:0.07px;}
#t2i_541{left:666px;bottom:168px;}
#t2j_541{left:677px;bottom:168px;letter-spacing:-0.12px;word-spacing:-0.03px;}

.s1_541{font-size:14px;font-family:NewBaskerville-Bold_w3;color:#252525;}
.s2_541{font-size:14px;font-family:NewBaskerville-BoldItalic_zn;color:#656565;}
.s3_541{font-size:19px;font-family:FranklinGothic-DemiItal_15g;color:#476B85;}
.s4_541{font-size:15px;font-family:NewBaskerville-Roman_xo;color:#252525;}
.s5_541{font-size:14px;font-family:Courier_166;color:#252525;}
.s6_541{font-size:12px;font-family:Courier_166;color:#252525;}
.s7_541{font-size:14px;font-family:FranklinGothic-Demi_yq;color:#FFF;}
.s8_541{font-size:14px;font-family:Humanist521BT-BoldCondensed_wh;color:#656565;}
.s9_541{font-size:14px;font-family:Humanist521BT-BoldCondensed_1b1;color:#656565;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts541" type="text/css" >

@font-face {
	font-family: Courier_166;
	src: url("fonts/Courier_166.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-DemiItal_15g;
	src: url("fonts/FranklinGothic-DemiItal_15g.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_yq;
	src: url("fonts/FranklinGothic-Demi_yq.woff") format("woff");
}

@font-face {
	font-family: Humanist521BT-BoldCondensed_1b1;
	src: url("fonts/Humanist521BT-BoldCondensed_1b1.woff") format("woff");
}

@font-face {
	font-family: Humanist521BT-BoldCondensed_wh;
	src: url("fonts/Humanist521BT-BoldCondensed_wh.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_zn;
	src: url("fonts/NewBaskerville-BoldItalic_zn.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_w3;
	src: url("fonts/NewBaskerville-Bold_w3.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_xo;
	src: url("fonts/NewBaskerville-Roman_xo.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg541Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg541" style="-webkit-user-select: none;"><object width="811" height="1017" data="541/541.svg" type="image/svg+xml" id="pdf541" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_541" class="t s1_541">511 </span><span id="t2_541" class="t s2_541">Testing CORS configurations </span>
<span id="t3_541" class="t s3_541">20.7 </span><span id="t4_541" class="t s3_541">Testing CORS configurations </span>
<span id="t5_541" class="t s4_541">In this section, we discuss testing cross-origin resource sharing (CORS) configura- </span>
<span id="t6_541" class="t s4_541">tions. As you learned in chapter 10, if a browser loads a web app from one origin (say, </span>
<span id="t7_541" class="t s4_541">example.com), the browser won’t allow the app to use an HTTP response that comes </span>
<span id="t8_541" class="t s4_541">from a different origin (say, example.org). We use CORS policies to relax these </span>
<span id="t9_541" class="t s4_541">restrictions. This way, we can configure our application to work with multiple origins. </span>
<span id="ta_541" class="t s4_541">Of course, as for any other security configurations, you need to also test the CORS </span>
<span id="tb_541" class="t s4_541">policies. In chapter 10, you learned that CORS is about specific headers on the </span>
<span id="tc_541" class="t s4_541">response whose values define whether the HTTP response is accepted. Two of these </span>
<span id="td_541" class="t s4_541">headers related to CORS specifications are </span><span id="te_541" class="t s5_541">Access-Control-Allow-Origin </span><span id="tf_541" class="t s4_541">and </span>
<span id="tg_541" class="t s5_541">Access-Control-Allow-Methods</span><span id="th_541" class="t s4_541">. We used these headers in chapter 10 to config- </span>
<span id="ti_541" class="t s4_541">ure multiple origins for our app. </span>
<span id="tj_541" class="t s4_541">All we need to do when writing tests for the CORS policies is to make sure that </span>
<span id="tk_541" class="t s4_541">these headers (and maybe other CORS-related headers, depending on the complexity </span>
<span id="tl_541" class="t s4_541">of your configurations) exist and have the correct values. For this validation, we can </span>
<span id="tm_541" class="t s4_541">act precisely as the browser does when making a preflight request. We make a request </span>
<span id="tn_541" class="t s4_541">using the HTTP OPTIONS method, requesting the value for the CORS headers. Let’s </span>
<span id="to_541" class="t s4_541">open project ssia-ch10-ex4 and write a test to validate the values for the CORS head- </span>
<span id="tp_541" class="t s4_541">ers. The following listing shows the definition of the test. </span>
<span id="tq_541" class="t s6_541">@SpringBootTest </span>
<span id="tr_541" class="t s6_541">@AutoConfigureMockMvc </span>
<span id="ts_541" class="t s6_541">public class MainTests { </span>
<span id="tt_541" class="t s6_541">@Autowired </span>
<span id="tu_541" class="t s6_541">private MockMvc mvc; </span>
<span id="tv_541" class="t s6_541">@Test </span>
<span id="tw_541" class="t s6_541">public void testCORSForTestEndpoint() throws Exception { </span>
<span id="tx_541" class="t s6_541">mvc.perform(options("/test") </span>
<span id="ty_541" class="t s6_541">.header("Access-Control-Request-Method", "POST") </span>
<span id="tz_541" class="t s6_541">.header("Origin", "http://www.example.com") </span>
<span id="t10_541" class="t s6_541">) </span>
<span id="t11_541" class="t s6_541">.andExpect(header().exists("Access-Control-Allow-Origin")) </span>
<span id="t12_541" class="t s6_541">.andExpect(header().string("Access-Control-Allow-Origin", "*")) </span>
<span id="t13_541" class="t s6_541">.andExpect(header().exists("Access-Control-Allow-Methods")) </span>
<span id="t14_541" class="t s6_541">.andExpect(header().string("Access-Control-Allow-Methods", "POST")) </span>
<span id="t15_541" class="t s6_541">.andExpect(status().isOk()); </span>
<span id="t16_541" class="t s6_541">} </span>
<span id="t17_541" class="t s6_541">} </span>
<span id="t18_541" class="t s7_541">Listing 20.17 </span><span id="t19_541" class="t s7_541">Test implementation for CORS policies </span>
<span id="t1a_541" class="t s8_541">Pe</span><span id="t1b_541" class="t s9_541">r</span><span id="t1c_541" class="t s8_541">fo</span><span id="t1d_541" class="t s9_541">rm</span><span id="t1e_541" class="t s8_541">s a</span><span id="t1f_541" class="t s9_541">n </span><span id="t1g_541" class="t s8_541">HTTP OPTIONS </span><span id="t1h_541" class="t s9_541">r</span><span id="t1i_541" class="t s8_541">equest </span>
<span id="t1j_541" class="t s8_541">o</span><span id="t1k_541" class="t s9_541">n </span><span id="t1l_541" class="t s8_541">the e</span><span id="t1m_541" class="t s9_541">n</span><span id="t1n_541" class="t s8_541">dpoi</span><span id="t1o_541" class="t s9_541">n</span><span id="t1p_541" class="t s8_541">t </span><span id="t1q_541" class="t s9_541">r</span><span id="t1r_541" class="t s8_541">equesti</span><span id="t1s_541" class="t s9_541">n</span><span id="t1t_541" class="t s8_541">g the </span>
<span id="t1u_541" class="t s8_541">value fo</span><span id="t1v_541" class="t s9_541">r </span><span id="t1w_541" class="t s8_541">the CORS heade</span><span id="t1x_541" class="t s9_541">r</span><span id="t1y_541" class="t s8_541">s </span>
<span id="t1z_541" class="t s8_541">Validates the values fo</span><span id="t20_541" class="t s9_541">r </span><span id="t21_541" class="t s8_541">the </span>
<span id="t22_541" class="t s8_541">heade</span><span id="t23_541" class="t s9_541">r</span><span id="t24_541" class="t s8_541">s acco</span><span id="t25_541" class="t s9_541">r</span><span id="t26_541" class="t s8_541">di</span><span id="t27_541" class="t s9_541">n</span><span id="t28_541" class="t s8_541">g to the </span>
<span id="t29_541" class="t s8_541">co</span><span id="t2a_541" class="t s9_541">n</span><span id="t2b_541" class="t s8_541">figu</span><span id="t2c_541" class="t s9_541">r</span><span id="t2d_541" class="t s8_541">atio</span><span id="t2e_541" class="t s9_541">n </span><span id="t2f_541" class="t s8_541">we </span><span id="t2g_541" class="t s9_541">m</span><span id="t2h_541" class="t s8_541">ade i</span><span id="t2i_541" class="t s9_541">n </span><span id="t2j_541" class="t s8_541">the app </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
