<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p532" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_532{left:87px;bottom:960px;letter-spacing:-0.13px;}
#t2_532{left:301px;bottom:961px;}
#t3_532{left:309px;bottom:962px;letter-spacing:-0.14px;}
#t4_532{left:349px;bottom:961px;letter-spacing:0.13px;}
#t5_532{left:376px;bottom:960px;letter-spacing:-0.1px;word-spacing:0.01px;}
#t6_532{left:142px;bottom:346px;letter-spacing:0.08px;word-spacing:-0.22px;}
#t7_532{left:142px;bottom:326px;letter-spacing:0.11px;word-spacing:-0.01px;}
#t8_532{left:165px;bottom:302px;}
#t9_532{left:185px;bottom:300px;letter-spacing:0.1px;word-spacing:-0.32px;}
#ta_532{left:624px;bottom:300px;letter-spacing:0.29px;}
#tb_532{left:185px;bottom:280px;letter-spacing:0.3px;}
#tc_532{left:223px;bottom:280px;letter-spacing:0.12px;}
#td_532{left:242px;bottom:280px;letter-spacing:0.3px;}
#te_532{left:381px;bottom:280px;}
#tf_532{left:165px;bottom:261px;}
#tg_532{left:185px;bottom:258px;letter-spacing:0.1px;word-spacing:1.3px;}
#th_532{left:416px;bottom:259px;letter-spacing:0.3px;}
#ti_532{left:647px;bottom:258px;letter-spacing:0.2px;}
#tj_532{left:185px;bottom:239px;letter-spacing:0.12px;word-spacing:1.8px;}
#tk_532{left:366px;bottom:239px;letter-spacing:0.3px;}
#tl_532{left:572px;bottom:239px;letter-spacing:0.13px;word-spacing:1.79px;}
#tm_532{left:185px;bottom:219px;letter-spacing:0.11px;word-spacing:0.07px;}
#tn_532{left:251px;bottom:219px;letter-spacing:0.3px;}
#to_532{left:385px;bottom:219px;letter-spacing:0.12px;word-spacing:0.02px;}
#tp_532{left:165px;bottom:199px;}
#tq_532{left:185px;bottom:197px;letter-spacing:0.13px;word-spacing:1.16px;}
#tr_532{left:185px;bottom:177px;letter-spacing:0.11px;word-spacing:-0.05px;}
#ts_532{left:275px;bottom:178px;letter-spacing:0.29px;}
#tt_532{left:453px;bottom:177px;letter-spacing:0.12px;}
#tu_532{left:158px;bottom:724px;letter-spacing:-0.12px;}
#tv_532{left:147px;bottom:644px;letter-spacing:-0.15px;}
#tw_532{left:149px;bottom:555px;letter-spacing:-0.14px;}
#tx_532{left:322px;bottom:590px;letter-spacing:-0.13px;}
#ty_532{left:326px;bottom:515px;letter-spacing:-0.16px;}
#tz_532{left:335px;bottom:727px;letter-spacing:-0.14px;}
#t10_532{left:509px;bottom:642px;letter-spacing:-0.15px;}
#t11_532{left:315px;bottom:916px;letter-spacing:-0.09px;}
#t12_532{left:315px;bottom:901px;letter-spacing:-0.1px;}
#t13_532{left:315px;bottom:887px;letter-spacing:-0.1px;}
#t14_532{left:442px;bottom:786px;letter-spacing:-0.1px;}
#t15_532{left:442px;bottom:771px;letter-spacing:-0.09px;}
#t16_532{left:442px;bottom:757px;letter-spacing:-0.1px;}
#t17_532{left:203px;bottom:830px;letter-spacing:-0.15px;}
#t18_532{left:142px;bottom:471px;letter-spacing:0.11px;word-spacing:-1.1px;}
#t19_532{left:217px;bottom:471px;letter-spacing:0.1px;word-spacing:-1.12px;}
#t1a_532{left:387px;bottom:470px;letter-spacing:-0.2px;}
#t1b_532{left:504px;bottom:471px;letter-spacing:0.08px;word-spacing:-1.1px;}
#t1c_532{left:142px;bottom:455px;letter-spacing:0.09px;word-spacing:-0.54px;}
#t1d_532{left:503px;bottom:455px;letter-spacing:-0.21px;}
#t1e_532{left:617px;bottom:455px;}
#t1f_532{left:142px;bottom:440px;letter-spacing:0.09px;word-spacing:-0.48px;}
#t1g_532{left:142px;bottom:425px;letter-spacing:0.1px;}
#t1h_532{left:199px;bottom:425px;letter-spacing:-0.21px;}
#t1i_532{left:309px;bottom:425px;letter-spacing:0.09px;}
#t1j_532{left:142px;bottom:409px;letter-spacing:0.1px;word-spacing:-0.02px;}

.s1_532{font-size:14px;font-family:NewBaskerville-Bold_w3;color:#252525;}
.s2_532{font-size:12px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s3_532{font-size:10px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s4_532{font-size:14px;font-family:NewBaskerville-BoldItalic_zn;color:#656565;}
.s5_532{font-size:15px;font-family:NewBaskerville-Roman_xo;color:#252525;}
.s6_532{font-size:11px;font-family:FranklinGothic-Demi_yq;color:#CCA659;}
.s7_532{font-size:14px;font-family:Courier_166;color:#252525;}
.s8_532{font-size:11px;font-family:Helvetica_wf;color:#231F20;}
.s9_532{font-size:14px;font-family:Humanist521BT-BoldCondensed_wh;color:#231F20;}
.sa_532{font-size:13px;font-family:Courier-Bold_194;color:#656565;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts532" type="text/css" >

@font-face {
	font-family: Courier-Bold_194;
	src: url("fonts/Courier-Bold_194.woff") format("woff");
}

@font-face {
	font-family: Courier_166;
	src: url("fonts/Courier_166.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_yq;
	src: url("fonts/FranklinGothic-Demi_yq.woff") format("woff");
}

@font-face {
	font-family: Helvetica_wf;
	src: url("fonts/Helvetica_wf.woff") format("woff");
}

@font-face {
	font-family: Humanist521BT-BoldCondensed_wh;
	src: url("fonts/Humanist521BT-BoldCondensed_wh.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_zn;
	src: url("fonts/NewBaskerville-BoldItalic_zn.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_w3;
	src: url("fonts/NewBaskerville-Bold_w3.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_xo;
	src: url("fonts/NewBaskerville-Roman_xo.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg532Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg532" style="-webkit-user-select: none;"><object width="811" height="1017" data="532/532.svg" type="image/svg+xml" id="pdf532" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_532" class="t s1_532">502 </span><span id="t2_532" class="t s2_532">C</span><span id="t3_532" class="t s3_532">HAPTER </span><span id="t4_532" class="t s2_532">20 </span><span id="t5_532" class="t s4_532">Spring Security testing </span>
<span id="t6_532" class="t s5_532">see at the end of the example that we can actually give any name to our mock user. We </span>
<span id="t7_532" class="t s5_532">follow three steps to achieve this behavior (figure 20.8): </span>
<span id="t8_532" class="t s6_532">1 </span><span id="t9_532" class="t s5_532">Write an annotation to use over the test similarly to the way we use </span><span id="ta_532" class="t s7_532">@WithMock- </span>
<span id="tb_532" class="t s7_532">User </span><span id="tc_532" class="t s5_532">or </span><span id="td_532" class="t s7_532">@WithUserDetails</span><span id="te_532" class="t s5_532">. </span>
<span id="tf_532" class="t s6_532">2 </span><span id="tg_532" class="t s5_532">Write a class that implements the </span><span id="th_532" class="t s7_532">WithSecurityContextFactory </span><span id="ti_532" class="t s5_532">interface. </span>
<span id="tj_532" class="t s5_532">This class implements the </span><span id="tk_532" class="t s7_532">createSecurityContext() </span><span id="tl_532" class="t s5_532">method that returns </span>
<span id="tm_532" class="t s5_532">the mock </span><span id="tn_532" class="t s7_532">SecurityContext </span><span id="to_532" class="t s5_532">the framework uses for the test. </span>
<span id="tp_532" class="t s6_532">3 </span><span id="tq_532" class="t s5_532">Link the custom annotation created in step 1 with the factory class created in </span>
<span id="tr_532" class="t s5_532">step 2 via the </span><span id="ts_532" class="t s7_532">@WithSecurityContext </span><span id="tt_532" class="t s5_532">annotation. </span>
<span id="tu_532" class="t s8_532">Authentication filter </span>
<span id="tv_532" class="t s8_532">Authentication manager </span>
<span id="tw_532" class="t s8_532">Authentication provider </span>
<span id="tx_532" class="t s8_532">User details service </span>
<span id="ty_532" class="t s8_532">Password encoder </span>
<span id="tz_532" class="t s8_532">Security context </span>
<span id="t10_532" class="t s8_532">Test </span>
<span id="t11_532" class="t s9_532">You define a factory class to instruct </span>
<span id="t12_532" class="t s9_532">the framework how to build the </span>
<span id="t13_532" class="t s9_532">SecurityContext used for the test. </span>
<span id="t14_532" class="t s9_532">The test uses the mock user from </span>
<span id="t15_532" class="t s9_532">the security context when calling </span>
<span id="t16_532" class="t s9_532">the app functionality. </span>
<span id="t17_532" class="t s8_532">WithSecurityContextFactory </span>
<span id="t18_532" class="t s2_532">Figure 20.7 </span><span id="t19_532" class="t s2_532">To obtain full control of how the </span><span id="t1a_532" class="t sa_532">SecurityContext </span><span id="t1b_532" class="t s2_532">for the test is defined, </span>
<span id="t1c_532" class="t s2_532">we build a factory class that instructs the test on how to build the </span><span id="t1d_532" class="t sa_532">SecurityContext</span><span id="t1e_532" class="t s2_532">. </span>
<span id="t1f_532" class="t s2_532">This way, we gain greater flexibility, and we can choose details like the kind of object to </span>
<span id="t1g_532" class="t s2_532">use as an </span><span id="t1h_532" class="t sa_532">Authentication </span><span id="t1i_532" class="t s2_532">object. In the figure, I shaded the components skipped </span>
<span id="t1j_532" class="t s2_532">from the flow during the test. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
