<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p292" style="overflow: hidden; position: relative; background-color: white; width: 811px; height: 1017px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_292{left:87px;bottom:960px;letter-spacing:-0.13px;}
#t2_292{left:248px;bottom:961px;}
#t3_292{left:256px;bottom:962px;letter-spacing:-0.14px;}
#t4_292{left:296px;bottom:961px;letter-spacing:0.13px;}
#t5_292{left:323px;bottom:960px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t6_292{left:142px;bottom:917px;letter-spacing:0.11px;word-spacing:0.2px;}
#t7_292{left:246px;bottom:918px;letter-spacing:0.3px;}
#t8_292{left:285px;bottom:917px;letter-spacing:0.1px;word-spacing:0.2px;}
#t9_292{left:142px;bottom:898px;letter-spacing:0.1px;word-spacing:1.38px;}
#ta_292{left:142px;bottom:878px;letter-spacing:0.1px;word-spacing:0.04px;}
#tb_292{left:142px;bottom:846px;letter-spacing:0.13px;word-spacing:0.01px;}
#tc_292{left:142px;bottom:831px;letter-spacing:0.14px;}
#td_292{left:142px;bottom:797px;letter-spacing:0.12px;word-spacing:1.46px;}
#te_292{left:142px;bottom:777px;letter-spacing:0.03px;word-spacing:0.28px;}
#tf_292{left:409px;bottom:777px;letter-spacing:0.3px;}
#tg_292{left:596px;bottom:777px;letter-spacing:0.11px;word-spacing:0.14px;}
#th_292{left:142px;bottom:757px;letter-spacing:0.1px;word-spacing:-0.01px;}
#ti_292{left:161px;bottom:726px;letter-spacing:-0.03px;}
#tj_292{left:208px;bottom:725px;letter-spacing:0.13px;word-spacing:0.5px;}
#tk_292{left:543px;bottom:725px;letter-spacing:0.3px;}
#tl_292{left:161px;bottom:707px;letter-spacing:0.29px;}
#tm_292{left:225px;bottom:707px;letter-spacing:0.11px;word-spacing:-0.31px;}
#tn_292{left:161px;bottom:688px;letter-spacing:0.12px;word-spacing:1.33px;}
#to_292{left:161px;bottom:670px;letter-spacing:0.11px;word-spacing:0.71px;}
#tp_292{left:161px;bottom:652px;letter-spacing:0.12px;word-spacing:0.79px;}
#tq_292{left:161px;bottom:633px;letter-spacing:0.12px;word-spacing:1.08px;}
#tr_292{left:370px;bottom:633px;letter-spacing:0.14px;word-spacing:1.03px;}
#ts_292{left:526px;bottom:633px;letter-spacing:0.14px;word-spacing:1.05px;}
#tt_292{left:161px;bottom:615px;letter-spacing:0.11px;word-spacing:0.06px;}
#tu_292{left:246px;bottom:615px;letter-spacing:-0.03px;}
#tv_292{left:388px;bottom:615px;}
#tw_292{left:142px;bottom:584px;letter-spacing:0.08px;word-spacing:0.88px;}
#tx_292{left:142px;bottom:565px;letter-spacing:0.12px;word-spacing:-0.02px;}
#ty_292{left:142px;bottom:536px;letter-spacing:0.12px;word-spacing:0.01px;}
#tz_292{left:142px;bottom:521px;letter-spacing:0.13px;word-spacing:0.01px;}
#t10_292{left:142px;bottom:505px;letter-spacing:0.13px;}
#t11_292{left:142px;bottom:490px;letter-spacing:0.14px;}
#t12_292{left:182px;bottom:490px;}
#t13_292{left:186px;bottom:490px;letter-spacing:0.14px;}
#t14_292{left:142px;bottom:456px;letter-spacing:0.12px;word-spacing:0.52px;}
#t15_292{left:142px;bottom:436px;letter-spacing:0.11px;word-spacing:0.01px;}
#t16_292{left:166px;bottom:416px;letter-spacing:0.12px;word-spacing:1.28px;}
#t17_292{left:142px;bottom:397px;letter-spacing:0.13px;word-spacing:-0.04px;}
#t18_292{left:142px;bottom:377px;letter-spacing:0.13px;word-spacing:0.86px;}
#t19_292{left:142px;bottom:357px;letter-spacing:0.12px;word-spacing:0.12px;}
#t1a_292{left:142px;bottom:337px;letter-spacing:0.12px;}
#t1b_292{left:142px;bottom:308px;letter-spacing:0.14px;word-spacing:-0.03px;}
#t1c_292{left:179px;bottom:293px;letter-spacing:0.13px;}
#t1d_292{left:179px;bottom:278px;letter-spacing:0.14px;}
#t1e_292{left:216px;bottom:278px;}
#t1f_292{left:222px;bottom:278px;letter-spacing:0.14px;}
#t1g_292{left:142px;bottom:244px;letter-spacing:0.11px;}
#t1h_292{left:142px;bottom:215px;letter-spacing:0.14px;}
#t1i_292{left:142px;bottom:200px;letter-spacing:0.13px;word-spacing:0.01px;}
#t1j_292{left:142px;bottom:184px;letter-spacing:0.14px;}
#t1k_292{left:142px;bottom:151px;letter-spacing:0.12px;}
#t1l_292{left:142px;bottom:119px;letter-spacing:0.14px;word-spacing:-0.03px;}
#t1m_292{left:179px;bottom:103px;letter-spacing:0.13px;}
#t1n_292{left:179px;bottom:88px;letter-spacing:0.14px;}
#t1o_292{left:216px;bottom:88px;}
#t1p_292{left:222px;bottom:88px;letter-spacing:0.14px;}

.s1_292{font-size:14px;font-family:NewBaskerville-Bold_w3;color:#252525;}
.s2_292{font-size:12px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s3_292{font-size:10px;font-family:FranklinGothic-Demi_yq;color:#656565;}
.s4_292{font-size:14px;font-family:NewBaskerville-BoldItalic_zn;color:#656565;}
.s5_292{font-size:15px;font-family:NewBaskerville-Roman_xo;color:#252525;}
.s6_292{font-size:14px;font-family:Courier_166;color:#252525;}
.s7_292{font-size:12px;font-family:Courier_166;color:#252525;}
.s8_292{font-size:13px;font-family:FranklinGothic-Demi_yq;color:#476B85;}
.s9_292{font-size:15px;font-family:NewBaskerville-Italic_vq;color:#252525;}
.sa_292{font-size:15px;font-family:NewBaskerville-Roman_xo;color:#001CA6;}
.sb_292{font-size:12px;font-family:Courier_166;color:#FFF;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts292" type="text/css" >

@font-face {
	font-family: Courier_166;
	src: url("fonts/Courier_166.woff") format("woff");
}

@font-face {
	font-family: FranklinGothic-Demi_yq;
	src: url("fonts/FranklinGothic-Demi_yq.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-BoldItalic_zn;
	src: url("fonts/NewBaskerville-BoldItalic_zn.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Bold_w3;
	src: url("fonts/NewBaskerville-Bold_w3.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Italic_vq;
	src: url("fonts/NewBaskerville-Italic_vq.woff") format("woff");
}

@font-face {
	font-family: NewBaskerville-Roman_xo;
	src: url("fonts/NewBaskerville-Roman_xo.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg292Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg292" style="-webkit-user-select: none;"><object width="811" height="1017" data="292/292.svg" type="image/svg+xml" id="pdf292" style="width:811px; height:1017px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_292" class="t s1_292">262 </span><span id="t2_292" class="t s2_292">C</span><span id="t3_292" class="t s3_292">HAPTER </span><span id="t4_292" class="t s2_292">11 </span><span id="t5_292" class="t s4_292">Hands-on: A separation of responsibilities </span>
<span id="t6_292" class="t s5_292">After using the </span><span id="t7_292" class="t s6_292">curl </span><span id="t8_292" class="t s5_292">command presented by the previous code snippet to add a user, </span>
<span id="t9_292" class="t s5_292">we check the database to validate that the record was added correctly. In my case, I </span>
<span id="ta_292" class="t s5_292">can see the following details: </span>
<span id="tb_292" class="t s7_292">Username: danielle </span>
<span id="tc_292" class="t s7_292">Password: $2a$10$.bI9ix.Y0m70iZitP.RdSuwzSqgqPJKnKpRUBQPGhoRvHA.1INYmy </span>
<span id="td_292" class="t s5_292">The application hashed the password before storing it in the database, which is the </span>
<span id="te_292" class="t s5_292">expected behavior. Remember, we used </span><span id="tf_292" class="t s6_292">BCryptPasswordEncoder </span><span id="tg_292" class="t s5_292">especially for this </span>
<span id="th_292" class="t s5_292">purpose in the authentication server. </span>
<span id="ti_292" class="t s8_292">NOTE </span><span id="tj_292" class="t s5_292">Remember that in our discussion from chapter 4, </span><span id="tk_292" class="t s6_292">BCryptPassword- </span>
<span id="tl_292" class="t s6_292">Encoder </span><span id="tm_292" class="t s5_292">uses bcrypt as the hashing algorithm. With bcrypt, the output is gen- </span>
<span id="tn_292" class="t s5_292">erated based on a salt value, which means that you obtain different outputs </span>
<span id="to_292" class="t s5_292">for the same input. For this example, the hash of the same password is a dif- </span>
<span id="tp_292" class="t s5_292">ferent one in your case. You can find more details and a great discussion on </span>
<span id="tq_292" class="t s5_292">hash functions in chapter 2 of </span><span id="tr_292" class="t s9_292">Real-World Cryptography </span><span id="ts_292" class="t s5_292">by David Wong (Man- </span>
<span id="tt_292" class="t s5_292">ning, 2020): </span><span id="tu_292" class="t sa_292">http://mng.bz/oRmy</span><span id="tv_292" class="t s5_292">. </span>
<span id="tw_292" class="t s5_292">We have a user, so letâ€™s generate an OTP for the user by calling the /user/auth end- </span>
<span id="tx_292" class="t s5_292">point. The next code snippet provides the cURL command that you can use: </span>
<span id="ty_292" class="t s7_292">curl -XPOST </span>
<span id="tz_292" class="t s7_292">-H "content-type: application/json" </span>
<span id="t10_292" class="t s7_292">-d "{\"username\":\"danielle\",\"password\":\"12345\"}" </span>
<span id="t11_292" class="t s7_292">http:/ </span><span id="t12_292" class="t sb_292">. </span><span id="t13_292" class="t s7_292">/localhost:8080/user/auth </span>
<span id="t14_292" class="t s5_292">In the otp table in our database, the application generates and stores a random four- </span>
<span id="t15_292" class="t s5_292">digit code. In my case, its value is 8173. </span>
<span id="t16_292" class="t s5_292">The last step for testing our authentication server is to call the /otp/check end- </span>
<span id="t17_292" class="t s5_292">point and verify that it returns an HTTP 200 OK status code in the response when the </span>
<span id="t18_292" class="t s5_292">OTP is correct and 403 Forbidden if the OTP is wrong. The following code snippets </span>
<span id="t19_292" class="t s5_292">show you the test for the correct OTP value, as well as the test for a wrong OTP value. </span>
<span id="t1a_292" class="t s5_292">If the OTP value is correct: </span>
<span id="t1b_292" class="t s7_292">curl -v -XPOST -H "content-type: application/json" -d </span>
<span id="t1c_292" class="t s7_292">"{\"username\":\"danielle\",\"code\":\"8173\"}" </span>
<span id="t1d_292" class="t s7_292">http:/ </span><span id="t1e_292" class="t sb_292">. </span><span id="t1f_292" class="t s7_292">/localhost:8080/otp/check </span>
<span id="t1g_292" class="t s5_292">the response status is </span>
<span id="t1h_292" class="t s7_292">... </span>
<span id="t1i_292" class="t s7_292">&lt; HTTP/1.1 200 </span>
<span id="t1j_292" class="t s7_292">... </span>
<span id="t1k_292" class="t s5_292">If the OTP value is wrong: </span>
<span id="t1l_292" class="t s7_292">curl -v -XPOST -H "content-type: application/json" -d </span>
<span id="t1m_292" class="t s7_292">"{\"username\":\"danielle\",\"code\":\"9999\"}" </span>
<span id="t1n_292" class="t s7_292">http:/ </span><span id="t1o_292" class="t sb_292">. </span><span id="t1p_292" class="t s7_292">/localhost:8080/otp/check </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
